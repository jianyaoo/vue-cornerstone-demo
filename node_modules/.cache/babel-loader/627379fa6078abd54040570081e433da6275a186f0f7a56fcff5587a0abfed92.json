{"ast":null,"code":"import { utilities as csUtils, StackViewport } from '@cornerstonejs/core';\nimport { getBoundingBoxAroundShapeIJK, getBoundingBoxAroundShapeWorld } from '../../../utilities/boundingBox';\nimport { pointInShapeCallback } from '../../../utilities';\nimport { triggerSegmentationDataModified } from '../../../stateManagement/segmentation/triggerSegmentationEvents';\nimport { getStrategyData } from './utils/getStrategyData';\nimport { isAxisAlignedRectangle } from '../../../utilities/rectangleROITool/isAxisAlignedRectangle';\nconst {\n  transformWorldToIndex\n} = csUtils;\nfunction fillRectangle(enabledElement, operationData, inside = true) {\n  const {\n    points,\n    segmentsLocked,\n    segmentIndex,\n    segmentationId\n  } = operationData;\n  const {\n    viewport\n  } = enabledElement;\n  const strategyData = getStrategyData({\n    operationData,\n    viewport: enabledElement.viewport\n  });\n  if (!strategyData) {\n    console.warn('No data found for fillRectangle');\n    return;\n  }\n  const {\n    segmentationImageData,\n    segmentationScalarData\n  } = strategyData;\n  let rectangleCornersIJK = points.map(world => {\n    return transformWorldToIndex(segmentationImageData, world);\n  });\n  rectangleCornersIJK = rectangleCornersIJK.map(point => {\n    return point.map(coord => {\n      return Math.round(coord);\n    });\n  });\n  const boundsIJK = getBoundingBoxAroundShapeIJK(rectangleCornersIJK, segmentationImageData.getDimensions());\n  const isStackViewport = viewport instanceof StackViewport;\n  const isAligned = isStackViewport || isAxisAlignedRectangle(rectangleCornersIJK);\n  const direction = segmentationImageData.getDirection();\n  const spacing = segmentationImageData.getSpacing();\n  const {\n    viewPlaneNormal\n  } = viewport.getCamera();\n  const EPS = csUtils.getSpacingInNormalDirection({\n    direction,\n    spacing\n  }, viewPlaneNormal);\n  const pointsBoundsLPS = getBoundingBoxAroundShapeWorld(points);\n  let [[xMin, xMax], [yMin, yMax], [zMin, zMax]] = pointsBoundsLPS;\n  xMin -= EPS;\n  xMax += EPS;\n  yMin -= EPS;\n  yMax += EPS;\n  zMin -= EPS;\n  zMax += EPS;\n  const pointInShapeFn = isAligned ? () => true : pointLPS => {\n    const [x, y, z] = pointLPS;\n    const xInside = x >= xMin && x <= xMax;\n    const yInside = y >= yMin && y <= yMax;\n    const zInside = z >= zMin && z <= zMax;\n    return xInside && yInside && zInside;\n  };\n  const callback = ({\n    value,\n    index\n  }) => {\n    if (segmentsLocked.includes(value)) {\n      return;\n    }\n    segmentationScalarData[index] = segmentIndex;\n  };\n  pointInShapeCallback(segmentationImageData, pointInShapeFn, callback, boundsIJK);\n  triggerSegmentationDataModified(segmentationId);\n}\nexport function fillInsideRectangle(enabledElement, operationData) {\n  fillRectangle(enabledElement, operationData, true);\n}\nexport function fillOutsideRectangle(enabledElement, operationData) {\n  fillRectangle(enabledElement, operationData, false);\n}","map":{"version":3,"names":["utilities","csUtils","StackViewport","getBoundingBoxAroundShapeIJK","getBoundingBoxAroundShapeWorld","pointInShapeCallback","triggerSegmentationDataModified","getStrategyData","isAxisAlignedRectangle","transformWorldToIndex","fillRectangle","enabledElement","operationData","inside","points","segmentsLocked","segmentIndex","segmentationId","viewport","strategyData","console","warn","segmentationImageData","segmentationScalarData","rectangleCornersIJK","map","world","point","coord","Math","round","boundsIJK","getDimensions","isStackViewport","isAligned","direction","getDirection","spacing","getSpacing","viewPlaneNormal","getCamera","EPS","getSpacingInNormalDirection","pointsBoundsLPS","xMin","xMax","yMin","yMax","zMin","zMax","pointInShapeFn","pointLPS","x","y","z","xInside","yInside","zInside","callback","value","index","includes","fillInsideRectangle","fillOutsideRectangle"],"sources":["../../../../../src/tools/segmentation/strategies/fillRectangle.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}