{"ast":null,"code":"import { cache } from '@cornerstonejs/core';\nimport { vec3 } from 'gl-matrix';\nexport default function isLineInSegment(point1, point2, isInSegment) {\n  const ijk1 = isInSegment.toIJK(point1);\n  const ijk2 = isInSegment.toIJK(point2);\n  const testPoint = vec3.create();\n  const {\n    testIJK\n  } = isInSegment;\n  const delta = vec3.sub(vec3.create(), ijk1, ijk2);\n  const testSize = Math.round(Math.max(...delta.map(Math.abs)));\n  if (testSize < 2) {\n    return true;\n  }\n  const unitDelta = vec3.scale(vec3.create(), delta, 1 / testSize);\n  for (let i = 1; i < testSize; i++) {\n    vec3.scaleAndAdd(testPoint, ijk2, unitDelta, i);\n    if (!testIJK(testPoint)) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction createIsInSegment(segVolumeId, segmentIndex, containedSegmentIndices) {\n  const vol = cache.getVolume(segVolumeId);\n  if (!vol) {\n    console.warn(`No volume found for ${segVolumeId}`);\n    return;\n  }\n  const segData = vol.imageData.getPointData().getScalars().getData();\n  const width = vol.dimensions[0];\n  const pixelsPerSlice = width * vol.dimensions[1];\n  return {\n    testCenter: (point1, point2) => {\n      const point = vec3.add(vec3.create(), point1, point2).map(it => it / 2);\n      const ijk = vol.imageData.worldToIndex(point).map(Math.round);\n      const [i, j, k] = ijk;\n      const index = i + j * width + k * pixelsPerSlice;\n      const value = segData[index];\n      return value === segmentIndex || containedSegmentIndices?.has(value);\n    },\n    toIJK: point => vol.imageData.worldToIndex(point),\n    testIJK: ijk => {\n      const [i, j, k] = ijk;\n      const index = Math.round(i) + Math.round(j) * width + Math.round(k) * pixelsPerSlice;\n      const value = segData[index];\n      return value === segmentIndex || containedSegmentIndices?.has(value);\n    }\n  };\n}\nexport { createIsInSegment, isLineInSegment };","map":{"version":3,"names":["cache","vec3","isLineInSegment","point1","point2","isInSegment","ijk1","toIJK","ijk2","testPoint","create","testIJK","delta","sub","testSize","Math","round","max","map","abs","unitDelta","scale","i","scaleAndAdd","createIsInSegment","segVolumeId","segmentIndex","containedSegmentIndices","vol","getVolume","console","warn","segData","imageData","getPointData","getScalars","getData","width","dimensions","pixelsPerSlice","testCenter","point","add","it","ijk","worldToIndex","j","k","index","value","has"],"sources":["../../../../src/utilities/segmentation/isLineInSegment.ts"],"sourcesContent":[null],"mappings":"AACA,SAASA,KAAK,QAAQ,qBAAqB;AAC3C,SAASC,IAAI,QAAQ,WAAW;AAMhC,eAAc,SAAUC,eAAeA,CACrCC,MAAoB,EACpBC,MAAoB,EACpBC,WAAW;EAEX,MAAMC,IAAI,GAAGD,WAAW,CAACE,KAAK,CAACJ,MAAM,CAAC;EACtC,MAAMK,IAAI,GAAGH,WAAW,CAACE,KAAK,CAACH,MAAM,CAAC;EACtC,MAAMK,SAAS,GAAGR,IAAI,CAACS,MAAM,EAAE;EAC/B,MAAM;IAAEC;EAAO,CAAE,GAAGN,WAAW;EAC/B,MAAMO,KAAK,GAAGX,IAAI,CAACY,GAAG,CAACZ,IAAI,CAACS,MAAM,EAAE,EAAEJ,IAAI,EAAEE,IAAI,CAAC;EAIjD,MAAMM,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,GAAG,CAAC,GAAGL,KAAK,CAACM,GAAG,CAACH,IAAI,CAACI,GAAG,CAAC,CAAC,CAAC;EAC7D,IAAIL,QAAQ,GAAG,CAAC,EAAE;IAEhB,OAAO,IAAI;;EAEb,MAAMM,SAAS,GAAGnB,IAAI,CAACoB,KAAK,CAACpB,IAAI,CAACS,MAAM,EAAE,EAAEE,KAAK,EAAE,CAAC,GAAGE,QAAQ,CAAC;EAEhE,KAAK,IAAIQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,QAAQ,EAAEQ,CAAC,EAAE,EAAE;IACjCrB,IAAI,CAACsB,WAAW,CAACd,SAAS,EAAED,IAAI,EAAEY,SAAS,EAAEE,CAAC,CAAC;IAC/C,IAAI,CAACX,OAAO,CAACF,SAAS,CAAC,EAAE;MACvB,OAAO,KAAK;;;EAGhB,OAAO,IAAI;AACb;AAMA,SAASe,iBAAiBA,CACxBC,WAAmB,EACnBC,YAAoB,EACpBC,uBAAqC;EAGrC,MAAMC,GAAG,GAAG5B,KAAK,CAAC6B,SAAS,CAACJ,WAAW,CAAC;EACxC,IAAI,CAACG,GAAG,EAAE;IACRE,OAAO,CAACC,IAAI,CAAC,uBAAuBN,WAAW,EAAE,CAAC;IAClD;;EAGF,MAAMO,OAAO,GAAGJ,GAAG,CAACK,SAAS,CAACC,YAAY,EAAE,CAACC,UAAU,EAAE,CAACC,OAAO,EAAE;EACnE,MAAMC,KAAK,GAAGT,GAAG,CAACU,UAAU,CAAC,CAAC,CAAC;EAC/B,MAAMC,cAAc,GAAGF,KAAK,GAAGT,GAAG,CAACU,UAAU,CAAC,CAAC,CAAC;EAEhD,OAAO;IAKLE,UAAU,EAAEA,CAACrC,MAAM,EAAEC,MAAM,KAAI;MAC7B,MAAMqC,KAAK,GAAGxC,IAAI,CAACyC,GAAG,CAACzC,IAAI,CAACS,MAAM,EAAE,EAAEP,MAAM,EAAEC,MAAM,CAAC,CAACc,GAAG,CAAEyB,EAAE,IAAKA,EAAE,GAAG,CAAC,CAAC;MACzE,MAAMC,GAAG,GAAGhB,GAAG,CAACK,SAAS,CAACY,YAAY,CAACJ,KAAa,CAAC,CAACvB,GAAG,CAACH,IAAI,CAACC,KAAK,CAAC;MACrE,MAAM,CAACM,CAAC,EAAEwB,CAAC,EAAEC,CAAC,CAAC,GAAGH,GAAG;MACrB,MAAMI,KAAK,GAAG1B,CAAC,GAAGwB,CAAC,GAAGT,KAAK,GAAGU,CAAC,GAAGR,cAAc;MAChD,MAAMU,KAAK,GAAGjB,OAAO,CAACgB,KAAK,CAAC;MAC5B,OAAOC,KAAK,KAAKvB,YAAY,IAAIC,uBAAuB,EAAEuB,GAAG,CAACD,KAAK,CAAC;IACtE,CAAC;IAED1C,KAAK,EAAGkC,KAAK,IAAKb,GAAG,CAACK,SAAS,CAACY,YAAY,CAACJ,KAAa,CAAC;IAE3D9B,OAAO,EAAGiC,GAAG,IAAI;MACf,MAAM,CAACtB,CAAC,EAAEwB,CAAC,EAAEC,CAAC,CAAC,GAAGH,GAAG;MACrB,MAAMI,KAAK,GACTjC,IAAI,CAACC,KAAK,CAACM,CAAC,CAAC,GAAGP,IAAI,CAACC,KAAK,CAAC8B,CAAC,CAAC,GAAGT,KAAK,GAAGtB,IAAI,CAACC,KAAK,CAAC+B,CAAC,CAAC,GAAGR,cAAc;MACxE,MAAMU,KAAK,GAAGjB,OAAO,CAACgB,KAAK,CAAC;MAC5B,OAAOC,KAAK,KAAKvB,YAAY,IAAIC,uBAAuB,EAAEuB,GAAG,CAACD,KAAK,CAAC;IACtE;GACD;AACH;AAEA,SAASzB,iBAAiB,EAAEtB,eAAe"},"metadata":{},"sourceType":"module","externalDependencies":[]}