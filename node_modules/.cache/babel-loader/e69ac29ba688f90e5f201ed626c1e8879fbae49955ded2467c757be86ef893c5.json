{"ast":null,"code":"import _cloneDeep from 'lodash.clonedeep';\nimport { getEnabledElement, triggerEvent } from '@cornerstonejs/core';\nimport Events from '../../enums/Events';\nconst defaultState = {\n  renderingEngineId: undefined,\n  viewportId: undefined,\n  key: undefined,\n  keyCode: undefined,\n  element: null\n};\nlet state = {\n  renderingEngineId: undefined,\n  viewportId: undefined,\n  key: undefined,\n  keyCode: undefined,\n  element: null\n};\nfunction keyListener(evt) {\n  state.element = evt.currentTarget;\n  const enabledElement = getEnabledElement(state.element);\n  const {\n    renderingEngineId,\n    viewportId\n  } = enabledElement;\n  state.renderingEngineId = renderingEngineId;\n  state.viewportId = viewportId;\n  state.key = evt.key;\n  state.keyCode = evt.keyCode;\n  evt.preventDefault();\n  const eventDetail = {\n    renderingEngineId: state.renderingEngineId,\n    viewportId: state.viewportId,\n    element: state.element,\n    key: state.key,\n    keyCode: state.keyCode\n  };\n  triggerEvent(eventDetail.element, Events.KEY_DOWN, eventDetail);\n  document.addEventListener('keyup', _onKeyUp);\n  document.addEventListener('visibilitychange', _onVisibilityChange);\n  state.element.removeEventListener('keydown', keyListener);\n}\nfunction _onVisibilityChange() {\n  document.removeEventListener('visibilitychange', _onVisibilityChange);\n  if (document.visibilityState === 'hidden') {\n    resetModifierKey();\n  }\n}\nfunction _onKeyUp(evt) {\n  const eventDetail = {\n    renderingEngineId: state.renderingEngineId,\n    viewportId: state.viewportId,\n    element: state.element,\n    key: state.key,\n    keyCode: state.keyCode\n  };\n  document.removeEventListener('keyup', _onKeyUp);\n  document.removeEventListener('visibilitychange', _onVisibilityChange);\n  state.element.addEventListener('keydown', keyListener);\n  state = _cloneDeep(defaultState);\n  triggerEvent(eventDetail.element, Events.KEY_UP, eventDetail);\n}\nexport function getModifierKey() {\n  return state.keyCode;\n}\nexport function resetModifierKey() {\n  state.keyCode = undefined;\n}\nexport default keyListener;","map":{"version":3,"names":["_cloneDeep","getEnabledElement","triggerEvent","Events","defaultState","renderingEngineId","undefined","viewportId","key","keyCode","element","state","keyListener","evt","currentTarget","enabledElement","preventDefault","eventDetail","KEY_DOWN","document","addEventListener","_onKeyUp","_onVisibilityChange","removeEventListener","visibilityState","resetModifierKey","KEY_UP","getModifierKey"],"sources":["../../../../src/eventListeners/keyboard/keyDownListener.ts"],"sourcesContent":[null],"mappings":"AAAA,OAAOA,UAAU,MAAM,kBAAkB;AACzC,SAASC,iBAAiB,EAAEC,YAAY,QAAQ,qBAAqB;AACrE,OAAOC,MAAM,MAAM,oBAAoB;AAWvC,MAAMC,YAAY,GAA0B;EAE1CC,iBAAiB,EAAEC,SAAS;EAC5BC,UAAU,EAAED,SAAS;EAErBE,GAAG,EAAEF,SAAS;EACdG,OAAO,EAAEH,SAAS;EAClBI,OAAO,EAAE;CACV;AAED,IAAIC,KAAK,GAA0B;EAEjCN,iBAAiB,EAAEC,SAAS;EAC5BC,UAAU,EAAED,SAAS;EAErBE,GAAG,EAAEF,SAAS;EACdG,OAAO,EAAEH,SAAS;EAClBI,OAAO,EAAE;CACV;AAMD,SAASE,WAAWA,CAACC,GAAkB;EACrCF,KAAK,CAACD,OAAO,GAAmBG,GAAG,CAACC,aAAa;EAEjD,MAAMC,cAAc,GAAGd,iBAAiB,CAACU,KAAK,CAACD,OAAO,CAAC;EACvD,MAAM;IAAEL,iBAAiB;IAAEE;EAAU,CAAE,GAAGQ,cAAc;EAExDJ,KAAK,CAACN,iBAAiB,GAAGA,iBAAiB;EAC3CM,KAAK,CAACJ,UAAU,GAAGA,UAAU;EAC7BI,KAAK,CAACH,GAAG,GAAGK,GAAG,CAACL,GAAG;EACnBG,KAAK,CAACF,OAAO,GAAGI,GAAG,CAACJ,OAAO;EAE3BI,GAAG,CAACG,cAAc,EAAE;EACpB,MAAMC,WAAW,GAAuB;IACtCZ,iBAAiB,EAAEM,KAAK,CAACN,iBAAiB;IAC1CE,UAAU,EAAEI,KAAK,CAACJ,UAAU;IAC5BG,OAAO,EAAEC,KAAK,CAACD,OAAO;IACtBF,GAAG,EAAEG,KAAK,CAACH,GAAG;IACdC,OAAO,EAAEE,KAAK,CAACF;GAOhB;EAEDP,YAAY,CAACe,WAAW,CAACP,OAAO,EAAEP,MAAM,CAACe,QAAQ,EAAED,WAAW,CAAC;EAE/DE,QAAQ,CAACC,gBAAgB,CAAC,OAAO,EAAEC,QAAQ,CAAC;EAC5CF,QAAQ,CAACC,gBAAgB,CAAC,kBAAkB,EAAEE,mBAAmB,CAAC;EAGlEX,KAAK,CAACD,OAAO,CAACa,mBAAmB,CAAC,SAAS,EAAEX,WAAW,CAAC;AAC3D;AAMA,SAASU,mBAAmBA,CAAA;EAC1BH,QAAQ,CAACI,mBAAmB,CAAC,kBAAkB,EAAED,mBAAmB,CAAC;EACrE,IAAIH,QAAQ,CAACK,eAAe,KAAK,QAAQ,EAAE;IACzCC,gBAAgB,EAAE;;AAEtB;AAEA,SAASJ,QAAQA,CAACR,GAAkB;EAClC,MAAMI,WAAW,GAAqB;IACpCZ,iBAAiB,EAAEM,KAAK,CAACN,iBAAiB;IAC1CE,UAAU,EAAEI,KAAK,CAACJ,UAAU;IAC5BG,OAAO,EAAEC,KAAK,CAACD,OAAO;IACtBF,GAAG,EAAEG,KAAK,CAACH,GAAG;IACdC,OAAO,EAAEE,KAAK,CAACF;GAEhB;EAGDU,QAAQ,CAACI,mBAAmB,CAAC,OAAO,EAAEF,QAAQ,CAAC;EAC/CF,QAAQ,CAACI,mBAAmB,CAAC,kBAAkB,EAAED,mBAAmB,CAAC;EACrEX,KAAK,CAACD,OAAO,CAACU,gBAAgB,CAAC,SAAS,EAAER,WAAW,CAAC;EAGtDD,KAAK,GAAGX,UAAU,CAACI,YAAY,CAAC;EAChCF,YAAY,CAACe,WAAW,CAACP,OAAO,EAAEP,MAAM,CAACuB,MAAM,EAAET,WAAW,CAAC;AAC/D;AAEA,OAAM,SAAUU,cAAcA,CAAA;EAC5B,OAAOhB,KAAK,CAACF,OAAO;AACtB;AAEA,OAAM,SAAUgB,gBAAgBA,CAAA;EAC9Bd,KAAK,CAACF,OAAO,GAAGH,SAAS;AAC3B;AAEA,eAAeM,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}