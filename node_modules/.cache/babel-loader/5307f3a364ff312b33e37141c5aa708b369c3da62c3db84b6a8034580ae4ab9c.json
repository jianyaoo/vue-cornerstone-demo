{"ast":null,"code":"import _getHash from './_getHash';\nimport setAttributesIfNecessary from './setAttributesIfNecessary';\nfunction drawTextBox(svgDrawingHelper, annotationUID, textUID, textLines, position, options = {}) {\n  const mergedOptions = Object.assign({\n    fontFamily: 'Helvetica, Arial, sans-serif',\n    fontSize: '14px',\n    color: 'rgb(255, 255, 0)',\n    background: '',\n    padding: 25,\n    centerX: false,\n    centerY: true\n  }, options);\n  const textGroupBoundingBox = _drawTextGroup(svgDrawingHelper, annotationUID, textUID, textLines, position, mergedOptions);\n  return textGroupBoundingBox;\n}\nfunction _drawTextGroup(svgDrawingHelper, annotationUID, textUID, textLines = [''], position, options) {\n  const {\n    padding,\n    color,\n    fontFamily,\n    fontSize,\n    background\n  } = options;\n  let textGroupBoundingBox;\n  const [x, y] = [position[0] + padding, position[1] + padding];\n  const svgns = 'http://www.w3.org/2000/svg';\n  const svgNodeHash = _getHash(annotationUID, 'text', textUID);\n  const existingTextGroup = svgDrawingHelper.getSvgNode(svgNodeHash);\n  if (existingTextGroup) {\n    const textElement = existingTextGroup.querySelector('text');\n    const textSpans = Array.from(textElement.children);\n    for (let i = 0; i < textSpans.length; i++) {\n      const textSpanElement = textSpans[i];\n      const text = textLines[i] || '';\n      textSpanElement.textContent = text;\n    }\n    if (textLines.length > textSpans.length) {\n      for (let i = 0; i < textLines.length - textSpans.length; i++) {\n        const textLine = textLines[i + textSpans.length];\n        const textSpan = _createTextSpan(textLine);\n        textElement.appendChild(textSpan);\n      }\n      existingTextGroup.appendChild(textElement);\n      svgDrawingHelper.appendNode(existingTextGroup, svgNodeHash);\n    }\n    const textAttributes = {\n      fill: color,\n      'font-size': fontSize,\n      'font-family': fontFamily\n    };\n    const textGroupAttributes = {\n      transform: `translate(${x} ${y})`\n    };\n    setAttributesIfNecessary(textAttributes, textElement);\n    setAttributesIfNecessary(textGroupAttributes, existingTextGroup);\n    textGroupBoundingBox = _drawTextBackground(existingTextGroup, background);\n    svgDrawingHelper.setNodeTouched(svgNodeHash);\n  } else {\n    const textGroup = document.createElementNS(svgns, 'g');\n    textGroup.setAttribute('transform', `translate(${x} ${y})`);\n    const textElement = _createTextElement(svgDrawingHelper, options);\n    for (let i = 0; i < textLines.length; i++) {\n      const textLine = textLines[i];\n      const textSpan = _createTextSpan(textLine);\n      textElement.appendChild(textSpan);\n    }\n    textGroup.appendChild(textElement);\n    svgDrawingHelper.appendNode(textGroup, svgNodeHash);\n    textGroupBoundingBox = _drawTextBackground(textGroup, background);\n  }\n  return Object.assign({}, textGroupBoundingBox, {\n    x,\n    y,\n    height: textGroupBoundingBox.height + padding,\n    width: textGroupBoundingBox.width + padding\n  });\n}\nfunction _createTextElement(svgDrawingHelper, options) {\n  const {\n    color,\n    fontFamily,\n    fontSize\n  } = options;\n  const svgns = 'http://www.w3.org/2000/svg';\n  const textElement = document.createElementNS(svgns, 'text');\n  const noSelectStyle = 'user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);';\n  const dropShadowStyle = `filter:url(#shadow-${svgDrawingHelper.svgLayerElement.id});`;\n  const combinedStyle = `${noSelectStyle}${dropShadowStyle}`;\n  textElement.setAttribute('x', '0');\n  textElement.setAttribute('y', '0');\n  textElement.setAttribute('fill', color);\n  textElement.setAttribute('font-family', fontFamily);\n  textElement.setAttribute('font-size', fontSize);\n  textElement.setAttribute('style', combinedStyle);\n  return textElement;\n}\nfunction _createTextSpan(text) {\n  const svgns = 'http://www.w3.org/2000/svg';\n  const textSpanElement = document.createElementNS(svgns, 'tspan');\n  textSpanElement.setAttribute('x', '0');\n  textSpanElement.setAttribute('dy', '1.2em');\n  textSpanElement.textContent = text;\n  return textSpanElement;\n}\nfunction _drawTextBackground(group, color) {\n  let element = group.querySelector('rect.background');\n  if (!color) {\n    if (element) {\n      group.removeChild(element);\n    }\n    return group.getBBox();\n  }\n  if (!element) {\n    element = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n    element.setAttribute('class', 'background');\n    group.insertBefore(element, group.firstChild);\n  }\n  const bBox = group.getBBox();\n  const attributes = {\n    x: `${bBox.x}`,\n    y: `${bBox.y}`,\n    width: `${bBox.width}`,\n    height: `${bBox.height}`,\n    fill: color\n  };\n  setAttributesIfNecessary(attributes, element);\n  return bBox;\n}\nexport default drawTextBox;","map":{"version":3,"names":["_getHash","setAttributesIfNecessary","drawTextBox","svgDrawingHelper","annotationUID","textUID","textLines","position","options","mergedOptions","Object","assign","fontFamily","fontSize","color","background","padding","centerX","centerY","textGroupBoundingBox","_drawTextGroup","x","y","svgns","svgNodeHash","existingTextGroup","getSvgNode","textElement","querySelector","textSpans","Array","from","children","i","length","textSpanElement","text","textContent","textLine","textSpan","_createTextSpan","appendChild","appendNode","textAttributes","fill","textGroupAttributes","transform","_drawTextBackground","setNodeTouched","textGroup","document","createElementNS","setAttribute","_createTextElement","height","width","noSelectStyle","dropShadowStyle","svgLayerElement","id","combinedStyle","group","element","removeChild","getBBox","insertBefore","firstChild","bBox","attributes"],"sources":["../../../src/drawingSvg/drawTextBox.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}