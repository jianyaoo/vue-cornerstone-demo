{"ast":null,"code":"import { utilities, getEnabledElement, StackViewport, cache, VideoViewport } from '@cornerstonejs/core';\nimport BaseTool from './BaseTool';\nimport { getAnnotationManager } from '../../stateManagement/annotation/annotationState';\nimport triggerAnnotationRender from '../../utilities/triggerAnnotationRender';\nimport filterAnnotationsForDisplay from '../../utilities/planar/filterAnnotationsForDisplay';\nimport { getStyleProperty } from '../../stateManagement/annotation/config/helpers';\nimport { getState } from '../../stateManagement/annotation/config';\nclass AnnotationDisplayTool extends BaseTool {\n  constructor() {\n    super(...arguments);\n    this.onImageSpacingCalibrated = evt => {\n      const {\n        element,\n        imageId\n      } = evt.detail;\n      const imageURI = utilities.imageIdToURI(imageId);\n      const annotationManager = getAnnotationManager();\n      const framesOfReference = annotationManager.getFramesOfReference();\n      framesOfReference.forEach(frameOfReference => {\n        const frameOfReferenceSpecificAnnotations = annotationManager.getAnnotations(frameOfReference);\n        const toolSpecificAnnotations = frameOfReferenceSpecificAnnotations[this.getToolName()];\n        if (!toolSpecificAnnotations || !toolSpecificAnnotations.length) {\n          return;\n        }\n        toolSpecificAnnotations.forEach(annotation => {\n          if (!annotation.metadata?.referencedImageId) {\n            return;\n          }\n          const referencedImageURI = utilities.imageIdToURI(annotation.metadata.referencedImageId);\n          if (referencedImageURI === imageURI) {\n            annotation.invalidated = true;\n            annotation.data.cachedStats = {};\n          }\n        });\n        triggerAnnotationRender(element);\n      });\n    };\n  }\n  filterInteractableAnnotationsForElement(element, annotations) {\n    if (!annotations || !annotations.length) {\n      return;\n    }\n    const enabledElement = getEnabledElement(element);\n    const {\n      viewport\n    } = enabledElement;\n    return filterAnnotationsForDisplay(viewport, annotations);\n  }\n  getReferencedImageId(viewport, worldPos, viewPlaneNormal, viewUp) {\n    const targetId = this.getTargetId(viewport);\n    let referencedImageId;\n    if (viewport instanceof StackViewport) {\n      referencedImageId = targetId.split('imageId:')[1];\n    } else if (viewport instanceof VideoViewport) {\n      referencedImageId = targetId.split('videoId:')[1];\n    } else {\n      const volumeId = targetId.split('volumeId:')[1];\n      const imageVolume = cache.getVolume(volumeId);\n      referencedImageId = utilities.getClosestImageId(imageVolume, worldPos, viewPlaneNormal);\n    }\n    return referencedImageId;\n  }\n  getStyle(property, specifications, annotation) {\n    return getStyleProperty(property, specifications, getState(annotation), this.mode);\n  }\n}\nAnnotationDisplayTool.toolName = 'AnnotationDisplayTool';\nexport default AnnotationDisplayTool;","map":{"version":3,"names":["utilities","getEnabledElement","StackViewport","cache","VideoViewport","BaseTool","getAnnotationManager","triggerAnnotationRender","filterAnnotationsForDisplay","getStyleProperty","getState","AnnotationDisplayTool","constructor","onImageSpacingCalibrated","evt","element","imageId","detail","imageURI","imageIdToURI","annotationManager","framesOfReference","getFramesOfReference","forEach","frameOfReference","frameOfReferenceSpecificAnnotations","getAnnotations","toolSpecificAnnotations","getToolName","length","annotation","metadata","referencedImageId","referencedImageURI","invalidated","data","cachedStats","filterInteractableAnnotationsForElement","annotations","enabledElement","viewport","getReferencedImageId","worldPos","viewPlaneNormal","viewUp","targetId","getTargetId","split","volumeId","imageVolume","getVolume","getClosestImageId","getStyle","property","specifications","mode","toolName"],"sources":["../../../../src/tools/base/AnnotationDisplayTool.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}