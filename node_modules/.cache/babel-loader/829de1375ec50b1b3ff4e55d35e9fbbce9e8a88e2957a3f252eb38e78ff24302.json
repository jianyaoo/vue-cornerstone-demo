{"ast":null,"code":"import { state } from '../../store';\nimport { ToolModes } from '../../enums';\nimport { setAnnotationSelected, isAnnotationSelected } from '../../stateManagement/annotation/annotationSelection';\nimport { isAnnotationLocked } from '../../stateManagement/annotation/annotationLocking';\nimport { isAnnotationVisible } from '../../stateManagement/annotation/annotationVisibility';\nimport filterToolsWithMoveableHandles from '../../store/filterToolsWithMoveableHandles';\nimport filterToolsWithAnnotationsForElement from '../../store/filterToolsWithAnnotationsForElement';\nimport filterMoveableAnnotationTools from '../../store/filterMoveableAnnotationTools';\nimport getActiveToolForTouchEvent from '../shared/getActiveToolForTouchEvent';\nimport getToolsWithModesForTouchEvent from '../shared/getToolsWithModesForTouchEvent';\nconst {\n  Active,\n  Passive\n} = ToolModes;\nexport default function touchStart(evt) {\n  if (state.isInteractingWithTool) {\n    return;\n  }\n  const activeTool = getActiveToolForTouchEvent(evt);\n  if (activeTool && typeof activeTool.preTouchStartCallback === 'function') {\n    const consumedEvent = activeTool.preTouchStartCallback(evt);\n    if (consumedEvent) {\n      return;\n    }\n  }\n  const isPrimaryClick = Object.keys(evt.detail.event.touches).length === 1;\n  const activeToolsWithEventBinding = getToolsWithModesForTouchEvent(evt, [Active], Object.keys(evt.detail.event.touches).length);\n  const passiveToolsIfEventWasPrimaryTouchButton = isPrimaryClick ? getToolsWithModesForTouchEvent(evt, [Passive]) : undefined;\n  const applicableTools = [...(activeToolsWithEventBinding || []), ...(passiveToolsIfEventWasPrimaryTouchButton || []), activeTool];\n  const eventDetail = evt.detail;\n  const {\n    element\n  } = eventDetail;\n  const annotationToolsWithAnnotations = filterToolsWithAnnotationsForElement(element, applicableTools);\n  const canvasCoords = eventDetail.currentPoints.canvas;\n  const annotationToolsWithMoveableHandles = filterToolsWithMoveableHandles(element, annotationToolsWithAnnotations, canvasCoords, 'touch');\n  const isMultiSelect = false;\n  if (annotationToolsWithMoveableHandles.length > 0) {\n    const {\n      tool,\n      annotation,\n      handle\n    } = getAnnotationForSelection(annotationToolsWithMoveableHandles);\n    toggleAnnotationSelection(annotation.annotationUID, isMultiSelect);\n    tool.handleSelectedCallback(evt, annotation, handle, 'Touch');\n    return;\n  }\n  const moveableAnnotationTools = filterMoveableAnnotationTools(element, annotationToolsWithAnnotations, canvasCoords, 'touch');\n  if (moveableAnnotationTools.length > 0) {\n    const {\n      tool,\n      annotation\n    } = getAnnotationForSelection(moveableAnnotationTools);\n    toggleAnnotationSelection(annotation.annotationUID, isMultiSelect);\n    tool.toolSelectedCallback(evt, annotation, 'Touch');\n    return;\n  }\n  if (activeTool && typeof activeTool.postTouchStartCallback === 'function') {\n    const consumedEvent = activeTool.postTouchStartCallback(evt);\n    if (consumedEvent) {\n      return;\n    }\n  }\n}\nfunction getAnnotationForSelection(toolsWithMovableHandles) {\n  return toolsWithMovableHandles.length > 1 && toolsWithMovableHandles.find(item => !isAnnotationLocked(item.annotation) && isAnnotationVisible(item.annotation.annotationUID)) || toolsWithMovableHandles[0];\n}\nfunction toggleAnnotationSelection(annotationUID, isMultiSelect = false) {\n  if (isMultiSelect) {\n    if (isAnnotationSelected(annotationUID)) {\n      setAnnotationSelected(annotationUID, false);\n    } else {\n      const preserveSelected = true;\n      setAnnotationSelected(annotationUID, true, preserveSelected);\n    }\n  } else {\n    const preserveSelected = false;\n    setAnnotationSelected(annotationUID, true, preserveSelected);\n  }\n}","map":{"version":3,"names":["state","ToolModes","setAnnotationSelected","isAnnotationSelected","isAnnotationLocked","isAnnotationVisible","filterToolsWithMoveableHandles","filterToolsWithAnnotationsForElement","filterMoveableAnnotationTools","getActiveToolForTouchEvent","getToolsWithModesForTouchEvent","Active","Passive","touchStart","evt","isInteractingWithTool","activeTool","preTouchStartCallback","consumedEvent","isPrimaryClick","Object","keys","detail","event","touches","length","activeToolsWithEventBinding","passiveToolsIfEventWasPrimaryTouchButton","undefined","applicableTools","eventDetail","element","annotationToolsWithAnnotations","canvasCoords","currentPoints","canvas","annotationToolsWithMoveableHandles","isMultiSelect","tool","annotation","handle","getAnnotationForSelection","toggleAnnotationSelection","annotationUID","handleSelectedCallback","moveableAnnotationTools","toolSelectedCallback","postTouchStartCallback","toolsWithMovableHandles","find","item","preserveSelected"],"sources":["../../../../src/eventDispatchers/touchEventHandlers/touchStart.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}