{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { vec3 } from 'gl-matrix';\nimport { getEnabledElement, eventTarget, triggerEvent, utilities as csUtils, StackViewport, VolumeViewport } from '@cornerstonejs/core';\nimport { removeAnnotation } from '../../stateManagement/annotation/annotationState';\nimport { drawHandles as drawHandlesSvg } from '../../drawingSvg';\nimport { state } from '../../store';\nimport { Events } from '../../enums';\nimport { resetElementCursor } from '../../cursors/elementCursor';\nimport { math, triggerAnnotationRenderForViewportIds } from '../../utilities';\nimport { LivewireScissors } from '../../utilities/livewire/LivewireScissors';\nimport { LivewirePath } from '../../utilities/livewire/LiveWirePath';\nimport { getViewportIdsWithToolToRender } from '../../utilities/viewportFilters';\nimport ContourSegmentationBaseTool from '../base/ContourSegmentationBaseTool';\nconst CLICK_CLOSE_CURVE_SQR_DIST = 10 ** 2;\nclass LivewireContourTool extends ContourSegmentationBaseTool {\n  constructor(toolProps = {}, defaultToolProps = {\n    supportedInteractionTypes: ['Mouse', 'Touch'],\n    configuration: {\n      preventHandleOutsideImage: false\n    }\n  }) {\n    super(toolProps, defaultToolProps);\n    this.isHandleOutsideImage = false;\n    this.isPointNearTool = (element, annotation, canvasCoords, proximity) => {\n      const enabledElement = getEnabledElement(element);\n      const {\n        viewport\n      } = enabledElement;\n      const proximitySquared = proximity * proximity;\n      const canvasPoints = annotation.data.contour.polyline.map(p => viewport.worldToCanvas(p));\n      let startPoint = canvasPoints[canvasPoints.length - 1];\n      for (let i = 0; i < canvasPoints.length; i++) {\n        const endPoint = canvasPoints[i];\n        const distanceToPointSquared = math.lineSegment.distanceToPointSquared(startPoint, endPoint, canvasCoords);\n        if (distanceToPointSquared <= proximitySquared) {\n          return true;\n        }\n        startPoint = endPoint;\n      }\n      return false;\n    };\n    this.toolSelectedCallback = (evt, annotation) => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      annotation.highlighted = true;\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      this.editData = {\n        annotation,\n        viewportIdsToRender\n      };\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      this._activateModify(element);\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      evt.preventDefault();\n    };\n    this.handleSelectedCallback = (evt, annotation, handle) => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const {\n        data\n      } = annotation;\n      annotation.highlighted = true;\n      const {\n        points\n      } = data.handles;\n      const handleIndex = points.findIndex(p => p === handle);\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      this.editData = {\n        annotation,\n        viewportIdsToRender,\n        handleIndex\n      };\n      this._activateModify(element);\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      evt.preventDefault();\n    };\n    this._endCallback = evt => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const {\n        annotation,\n        viewportIdsToRender,\n        newAnnotation\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      data.handles.activeHandleIndex = null;\n      this._deactivateModify(element);\n      this._deactivateDraw(element);\n      resetElementCursor(element);\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      if (this.isHandleOutsideImage && this.configuration.preventHandleOutsideImage) {\n        removeAnnotation(annotation.annotationUID);\n      }\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      if (newAnnotation) {\n        const eventType = Events.ANNOTATION_COMPLETED;\n        const eventDetail = {\n          annotation\n        };\n        triggerEvent(eventTarget, eventType, eventDetail);\n      }\n      this.editData = null;\n      this.scissors = null;\n      this.isDrawing = false;\n    };\n    this._mouseDownCallback = evt => {\n      const doubleClick = evt.type === Events.MOUSE_DOUBLE_CLICK;\n      const {\n        annotation,\n        viewportIdsToRender,\n        worldToSlice,\n        sliceToWorld\n      } = this.editData;\n      if (this.editData.closed) {\n        return;\n      }\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const {\n        currentPoints\n      } = eventDetail;\n      const {\n        canvas: canvasPos,\n        world: worldPos\n      } = currentPoints;\n      const enabledElement = getEnabledElement(element);\n      const {\n        viewport,\n        renderingEngine\n      } = enabledElement;\n      const controlPoints = this.editData.currentPath.getControlPoints();\n      let closePath = controlPoints.length >= 2 && doubleClick;\n      if (controlPoints.length >= 2) {\n        const closestHandlePoint = {\n          index: -1,\n          distSquared: Infinity\n        };\n        for (let i = 0, len = controlPoints.length; i < len; i++) {\n          const controlPoint = controlPoints[i];\n          const worldControlPoint = sliceToWorld(controlPoint);\n          const canvasControlPoint = viewport.worldToCanvas(worldControlPoint);\n          const distSquared = math.point.distanceToPointSquared(canvasPos, canvasControlPoint);\n          if (distSquared <= CLICK_CLOSE_CURVE_SQR_DIST && distSquared < closestHandlePoint.distSquared) {\n            closestHandlePoint.distSquared = distSquared;\n            closestHandlePoint.index = i;\n          }\n        }\n        if (closestHandlePoint.index === 0) {\n          closePath = true;\n        }\n      }\n      this.editData.closed = this.editData.closed || closePath;\n      this.editData.confirmedPath = this.editData.currentPath;\n      this.editData.confirmedPath.addControlPoint(this.editData.currentPath.getLastPoint());\n      this.scissors.startSearch(worldToSlice(worldPos));\n      annotation.invalidated = true;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      if (this.editData.closed) {\n        this._updateAnnotation(element, this.editData.confirmedPath);\n        this._endCallback(evt);\n      }\n      evt.preventDefault();\n    };\n    this._mouseMoveCallback = evt => {\n      const {\n        element,\n        currentPoints\n      } = evt.detail;\n      const {\n        world: worldPos,\n        canvas: canvasPos\n      } = currentPoints;\n      const {\n        renderingEngine\n      } = getEnabledElement(element);\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      this.editData.lastCanvasPoint = canvasPos;\n      const {\n        width: imgWidth,\n        height: imgHeight\n      } = this.scissors;\n      const {\n        worldToSlice\n      } = this.editData;\n      const slicePoint = worldToSlice(worldPos);\n      if (slicePoint[0] < 0 || slicePoint[1] < 0 || slicePoint[0] >= imgWidth || slicePoint[1] >= imgHeight) {\n        return;\n      }\n      const pathPoints = this.scissors.findPathToPoint(slicePoint);\n      const currentPath = new LivewirePath();\n      for (let i = 0, len = pathPoints.length; i < len; i++) {\n        currentPath.addPoint(pathPoints[i]);\n      }\n      currentPath.prependPath(this.editData.confirmedPath);\n      this.editData.currentPath = currentPath;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      evt.preventDefault();\n    };\n    this._dragCallback = evt => {\n      this.isDrawing = true;\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const {\n        annotation,\n        viewportIdsToRender,\n        handleIndex\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      if (handleIndex === undefined) {\n        const {\n          deltaPoints\n        } = eventDetail;\n        const worldPosDelta = deltaPoints.world;\n        const points = data.contour.polyline;\n        points.forEach(point => {\n          point[0] += worldPosDelta[0];\n          point[1] += worldPosDelta[1];\n          point[2] += worldPosDelta[2];\n        });\n        annotation.invalidated = true;\n      } else {\n        const {\n          currentPoints\n        } = eventDetail;\n        const worldPos = currentPoints.world;\n        data.handles.points[handleIndex] = [...worldPos];\n        annotation.invalidated = true;\n      }\n      this.editData.hasMoved = true;\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n    };\n    this.cancel = element => {\n      if (!this.isDrawing) {\n        return;\n      }\n      this.isDrawing = false;\n      this._deactivateDraw(element);\n      this._deactivateModify(element);\n      resetElementCursor(element);\n      const {\n        annotation,\n        viewportIdsToRender,\n        newAnnotation\n      } = this.editData;\n      if (newAnnotation) {\n        removeAnnotation(annotation.annotationUID);\n      }\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      this.editData = null;\n      this.scissors = null;\n      return annotation.annotationUID;\n    };\n    this.triggerAnnotationModified = (annotation, enabledElement) => {\n      const {\n        viewportId,\n        renderingEngineId\n      } = enabledElement;\n      const eventType = Events.ANNOTATION_MODIFIED;\n      const eventDetail = {\n        annotation,\n        viewportId,\n        renderingEngineId\n      };\n      triggerEvent(eventTarget, eventType, eventDetail);\n    };\n    this._activateModify = element => {\n      state.isInteractingWithTool = true;\n      element.addEventListener(Events.MOUSE_UP, this._endCallback);\n      element.addEventListener(Events.MOUSE_DRAG, this._dragCallback);\n      element.addEventListener(Events.MOUSE_CLICK, this._endCallback);\n      element.addEventListener(Events.TOUCH_END, this._endCallback);\n      element.addEventListener(Events.TOUCH_DRAG, this._dragCallback);\n      element.addEventListener(Events.TOUCH_TAP, this._endCallback);\n    };\n    this._deactivateModify = element => {\n      state.isInteractingWithTool = false;\n      element.removeEventListener(Events.MOUSE_UP, this._endCallback);\n      element.removeEventListener(Events.MOUSE_DRAG, this._dragCallback);\n      element.removeEventListener(Events.MOUSE_CLICK, this._endCallback);\n      element.removeEventListener(Events.TOUCH_END, this._endCallback);\n      element.removeEventListener(Events.TOUCH_DRAG, this._dragCallback);\n      element.removeEventListener(Events.TOUCH_TAP, this._endCallback);\n    };\n    this._activateDraw = element => {\n      state.isInteractingWithTool = true;\n      element.addEventListener(Events.MOUSE_MOVE, this._mouseMoveCallback);\n      element.addEventListener(Events.MOUSE_DOWN, this._mouseDownCallback);\n      element.addEventListener(Events.MOUSE_DOUBLE_CLICK, this._mouseDownCallback);\n      element.addEventListener(Events.TOUCH_TAP, this._mouseDownCallback);\n    };\n    this._deactivateDraw = element => {\n      state.isInteractingWithTool = false;\n      element.removeEventListener(Events.MOUSE_MOVE, this._mouseMoveCallback);\n      element.removeEventListener(Events.MOUSE_DOWN, this._mouseDownCallback);\n      element.removeEventListener(Events.MOUSE_DOUBLE_CLICK, this._mouseDownCallback);\n      element.removeEventListener(Events.TOUCH_TAP, this._mouseDownCallback);\n    };\n  }\n  addNewAnnotation(evt) {\n    const eventDetail = evt.detail;\n    const {\n      currentPoints,\n      element\n    } = eventDetail;\n    const {\n      world: worldPos,\n      canvas: canvasPos\n    } = currentPoints;\n    const enabledElement = getEnabledElement(element);\n    const {\n      viewport,\n      renderingEngine\n    } = enabledElement;\n    this.isDrawing = true;\n    const defaultActor = viewport.getDefaultActor();\n    if (!defaultActor || !csUtils.isImageActor(defaultActor)) {\n      throw new Error('Default actor must be an image actor');\n    }\n    const viewportImageData = viewport.getImageData();\n    const {\n      imageData: vtkImageData\n    } = viewportImageData;\n    let worldToSlice;\n    let sliceToWorld;\n    let scalarData;\n    let width;\n    let height;\n    if (viewport instanceof StackViewport) {\n      scalarData = viewportImageData.scalarData;\n      width = viewportImageData.dimensions[0];\n      height = viewportImageData.dimensions[1];\n      worldToSlice = point => {\n        const ijkPoint = csUtils.transformWorldToIndex(vtkImageData, point);\n        return [ijkPoint[0], ijkPoint[1]];\n      };\n      sliceToWorld = point => csUtils.transformIndexToWorld(vtkImageData, [point[0], point[1], 0]);\n    } else if (viewport instanceof VolumeViewport) {\n      const sliceImageData = csUtils.getCurrentVolumeViewportSlice(viewport);\n      const {\n        sliceToIndexMatrix,\n        indexToSliceMatrix\n      } = sliceImageData;\n      worldToSlice = point => {\n        const ijkPoint = csUtils.transformWorldToIndex(vtkImageData, point);\n        const slicePoint = vec3.transformMat4([0, 0, 0], ijkPoint, indexToSliceMatrix);\n        return [slicePoint[0], slicePoint[1]];\n      };\n      sliceToWorld = point => {\n        const ijkPoint = vec3.transformMat4([0, 0, 0], [point[0], point[1], 0], sliceToIndexMatrix);\n        return csUtils.transformIndexToWorld(vtkImageData, ijkPoint);\n      };\n      scalarData = sliceImageData.scalarData;\n      width = sliceImageData.width;\n      height = sliceImageData.height;\n    } else {\n      throw new Error('Viewport not supported');\n    }\n    const {\n      voiRange\n    } = viewport.getProperties();\n    const startPos = worldToSlice(worldPos);\n    this.scissors = LivewireScissors.createInstanceFromRawPixelData(scalarData, width, height, voiRange);\n    this.scissors.startSearch(startPos);\n    const confirmedPath = new LivewirePath();\n    const currentPath = new LivewirePath();\n    confirmedPath.addPoint(startPos);\n    confirmedPath.addControlPoint(startPos);\n    const annotation = this.createAnnotation(evt);\n    this.addAnnotation(annotation, element);\n    const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n    this.editData = {\n      annotation,\n      viewportIdsToRender,\n      newAnnotation: true,\n      hasMoved: false,\n      lastCanvasPoint: canvasPos,\n      confirmedPath: confirmedPath,\n      currentPath: currentPath,\n      closed: false,\n      worldToSlice,\n      sliceToWorld\n    };\n    this._activateDraw(element);\n    evt.preventDefault();\n    triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n    return annotation;\n  }\n  renderAnnotation(enabledElement, svgDrawingHelper) {\n    const {\n      viewport\n    } = enabledElement;\n    const {\n      element\n    } = viewport;\n    this._updateAnnotation(element, this.editData?.currentPath);\n    return super.renderAnnotation(enabledElement, svgDrawingHelper);\n  }\n  isContourSegmentationTool() {\n    return false;\n  }\n  createAnnotation(evt) {\n    const contourSegmentationAnnotation = super.createAnnotation(evt);\n    const {\n      world: worldPos\n    } = evt.detail.currentPoints;\n    return csUtils.deepMerge(contourSegmentationAnnotation, {\n      data: {\n        handles: {\n          points: [[...worldPos]]\n        }\n      }\n    });\n  }\n  renderAnnotationInstance(renderContext) {\n    const {\n      enabledElement,\n      svgDrawingHelper,\n      annotationStyle\n    } = renderContext;\n    const {\n      viewport\n    } = enabledElement;\n    const {\n      worldToCanvas\n    } = viewport;\n    const annotation = renderContext.annotation;\n    const {\n      annotationUID,\n      data\n    } = annotation;\n    const {\n      handles\n    } = data;\n    const newAnnotation = this.editData?.newAnnotation;\n    const {\n      lineWidth,\n      lineDash,\n      color\n    } = annotationStyle;\n    if (newAnnotation && annotation.annotationUID === this.editData?.annotation?.annotationUID) {\n      const handleGroupUID = '0';\n      const startPoint = worldToCanvas(handles.points[0]);\n      drawHandlesSvg(svgDrawingHelper, annotationUID, handleGroupUID, [startPoint], {\n        color,\n        lineDash,\n        lineWidth\n      });\n    }\n    super.renderAnnotationInstance(renderContext);\n    return true;\n  }\n  _updateAnnotation(element, livewirePath) {\n    if (!this.editData || !livewirePath) {\n      return;\n    }\n    const {\n      pointArray: imagePoints\n    } = livewirePath;\n    const worldPolylinePoints = [];\n    const {\n      annotation,\n      sliceToWorld\n    } = this.editData;\n    for (let i = 0, len = imagePoints.length; i < len; i++) {\n      const imagePoint = imagePoints[i];\n      const worldPoint = sliceToWorld(imagePoint);\n      worldPolylinePoints.push(worldPoint);\n    }\n    if (worldPolylinePoints.length > 1) {\n      worldPolylinePoints.push([...worldPolylinePoints[0]]);\n    }\n    annotation.data.contour.polyline = worldPolylinePoints;\n  }\n}\nLivewireContourTool.toolName = 'LivewireContour';\nexport default LivewireContourTool;","map":{"version":3,"names":["vec3","getEnabledElement","eventTarget","triggerEvent","utilities","csUtils","StackViewport","VolumeViewport","removeAnnotation","drawHandles","drawHandlesSvg","state","Events","resetElementCursor","math","triggerAnnotationRenderForViewportIds","LivewireScissors","LivewirePath","getViewportIdsWithToolToRender","ContourSegmentationBaseTool","CLICK_CLOSE_CURVE_SQR_DIST","LivewireContourTool","constructor","toolProps","defaultToolProps","supportedInteractionTypes","configuration","preventHandleOutsideImage","isHandleOutsideImage","isPointNearTool","element","annotation","canvasCoords","proximity","enabledElement","viewport","proximitySquared","canvasPoints","data","contour","polyline","map","p","worldToCanvas","startPoint","length","i","endPoint","distanceToPointSquared","lineSegment","toolSelectedCallback","evt","eventDetail","detail","highlighted","viewportIdsToRender","getToolName","editData","renderingEngine","_activateModify","preventDefault","handleSelectedCallback","handle","points","handles","handleIndex","findIndex","_endCallback","newAnnotation","activeHandleIndex","_deactivateModify","_deactivateDraw","annotationUID","eventType","ANNOTATION_COMPLETED","scissors","isDrawing","_mouseDownCallback","doubleClick","type","MOUSE_DOUBLE_CLICK","worldToSlice","sliceToWorld","closed","currentPoints","canvas","canvasPos","world","worldPos","controlPoints","currentPath","getControlPoints","closePath","closestHandlePoint","index","distSquared","Infinity","len","controlPoint","worldControlPoint","canvasControlPoint","point","confirmedPath","addControlPoint","getLastPoint","startSearch","invalidated","_updateAnnotation","_mouseMoveCallback","lastCanvasPoint","width","imgWidth","height","imgHeight","slicePoint","pathPoints","findPathToPoint","addPoint","prependPath","_dragCallback","undefined","deltaPoints","worldPosDelta","forEach","hasMoved","cancel","triggerAnnotationModified","viewportId","renderingEngineId","ANNOTATION_MODIFIED","isInteractingWithTool","addEventListener","MOUSE_UP","MOUSE_DRAG","MOUSE_CLICK","TOUCH_END","TOUCH_DRAG","TOUCH_TAP","removeEventListener","_activateDraw","MOUSE_MOVE","MOUSE_DOWN","addNewAnnotation","defaultActor","getDefaultActor","isImageActor","Error","viewportImageData","getImageData","imageData","vtkImageData","scalarData","dimensions","ijkPoint","transformWorldToIndex","transformIndexToWorld","sliceImageData","getCurrentVolumeViewportSlice","sliceToIndexMatrix","indexToSliceMatrix","transformMat4","voiRange","getProperties","startPos","createInstanceFromRawPixelData","createAnnotation","addAnnotation","renderAnnotation","svgDrawingHelper","isContourSegmentationTool","contourSegmentationAnnotation","deepMerge","renderAnnotationInstance","renderContext","annotationStyle","lineWidth","lineDash","color","handleGroupUID","livewirePath","pointArray","imagePoints","worldPolylinePoints","imagePoint","worldPoint","push","toolName"],"sources":["../../../../src/tools/annotation/LivewireContourTool.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}