{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport { mat4 } from 'gl-matrix';\nimport { m as macro } from '../../macros2.js';\nimport vtkViewNode from '../SceneGraph/ViewNode.js';\nimport { registerOverride } from './ViewNodeFactory.js';\n\n// ----------------------------------------------------------------------------\n// vtkWebGPUVolume methods\n// ----------------------------------------------------------------------------\n\nfunction vtkWebGPUVolume(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkWebGPUVolume');\n\n  // Builds myself.\n  publicAPI.buildPass = prepass => {\n    if (!model.renderable || !model.renderable.getVisibility()) {\n      return;\n    }\n    if (prepass) {\n      model.WebGPURenderer = publicAPI.getFirstAncestorOfType('vtkWebGPURenderer');\n      model.WebGPURenderWindow = model.WebGPURenderer.getFirstAncestorOfType('vtkWebGPURenderWindow');\n      // for the future if we support hardware selection of volumes\n      if (model.propID === undefined) {\n        model.propID = model.WebGPURenderWindow.getUniquePropID();\n      }\n      model.renderable.getMapper().update();\n    }\n  };\n  publicAPI.queryPass = (prepass, renderPass) => {\n    if (prepass) {\n      if (!model.renderable || !model.renderable.getVisibility()) {\n        return;\n      }\n\n      // Check for the special case when the mapper's bounds are unknown\n      const bds = model.renderable.getMapper().getBounds();\n      if (!bds || bds.length !== 6 || bds[0] > bds[1]) {\n        return;\n      }\n      renderPass.addVolume(publicAPI);\n    }\n  };\n\n  // used in the method below\n  const idx = new Float64Array(3);\n  const vout = new Float64Array(3);\n  publicAPI.getBoundingCubePoints = (result, offset) => {\n    const input = model.renderable.getMapper().getInputData();\n    if (!input) {\n      return;\n    }\n    const extent = input.getExtent();\n    const m = model.renderable.getMatrix();\n    let count = 0;\n    for (let iz = 4; iz < 6; iz++) {\n      idx[2] = extent[iz];\n      for (let iy = 2; iy < 4; iy++) {\n        idx[1] = extent[iy];\n        for (let ix = 0; ix < 2; ix++) {\n          idx[0] = extent[ix];\n          input.indexToWorld(idx, vout);\n          let poffset = offset + count * 3;\n          result[poffset++] = m[0] * vout[0] + m[1] * vout[1] + m[2] * vout[2] + m[3];\n          result[poffset++] = m[4] * vout[0] + m[5] * vout[1] + m[6] * vout[2] + m[7];\n          result[poffset++] = m[8] * vout[0] + m[9] * vout[1] + m[10] * vout[2] + m[11];\n          count++;\n        }\n      }\n    }\n  };\n  publicAPI.getKeyMatrices = wgpuRen => {\n    // has the actor or stabilization center changed?\n    if (Math.max(model.renderable.getMTime(), wgpuRen.getStabilizedTime()) > model.keyMatricesTime.getMTime()) {\n      model.renderable.computeMatrix();\n      const mcwc = model.renderable.getMatrix();\n\n      // compute the net shift\n      const center = wgpuRen.getStabilizedCenterByReference();\n      mat4.transpose(model.keyMatrices.bcwc, mcwc);\n\n      // to get to stabilized we also need the center\n      mat4.translate(model.keyMatrices.bcsc, model.keyMatrices.bcwc, [-center[0], -center[1], -center[2]]);\n      model.keyMatricesTime.modified();\n    }\n    return model.keyMatrices;\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {\n  propID: undefined,\n  keyMatricesTime: null\n};\n\n// ----------------------------------------------------------------------------\n\nfunction extend(publicAPI, model) {\n  let initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  // Inheritance\n  vtkViewNode.extend(publicAPI, model, initialValues);\n  model.keyMatricesTime = {};\n  macro.obj(model.keyMatricesTime, {\n    mtime: 0\n  });\n  model.keyMatrices = {\n    bcwc: new Float64Array(16),\n    bcsc: new Float64Array(16)\n  };\n  macro.get(publicAPI, model, ['propID', 'keyMatricesTime']);\n\n  // Object methods\n  vtkWebGPUVolume(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nconst newInstance = macro.newInstance(extend, 'vtkWebGPUVolume');\n\n// ----------------------------------------------------------------------------\n\nvar index = {\n  newInstance,\n  extend\n};\n\n// Register ourself to WebGPU backend if imported\nregisterOverride('vtkVolume', newInstance);\nexport { index as default, extend, newInstance };","map":{"version":3,"names":["mat4","m","macro","vtkViewNode","registerOverride","vtkWebGPUVolume","publicAPI","model","classHierarchy","push","buildPass","prepass","renderable","getVisibility","WebGPURenderer","getFirstAncestorOfType","WebGPURenderWindow","propID","undefined","getUniquePropID","getMapper","update","queryPass","renderPass","bds","getBounds","length","addVolume","idx","Float64Array","vout","getBoundingCubePoints","result","offset","input","getInputData","extent","getExtent","getMatrix","count","iz","iy","ix","indexToWorld","poffset","getKeyMatrices","wgpuRen","Math","max","getMTime","getStabilizedTime","keyMatricesTime","computeMatrix","mcwc","center","getStabilizedCenterByReference","transpose","keyMatrices","bcwc","translate","bcsc","modified","DEFAULT_VALUES","extend","initialValues","arguments","Object","assign","obj","mtime","get","newInstance","index","default"],"sources":["/root/vue-cornerstone-demo/node_modules/@kitware/vtk.js/Rendering/WebGPU/Volume.js"],"sourcesContent":["import { mat4 } from 'gl-matrix';\nimport { m as macro } from '../../macros2.js';\nimport vtkViewNode from '../SceneGraph/ViewNode.js';\nimport { registerOverride } from './ViewNodeFactory.js';\n\n// ----------------------------------------------------------------------------\n// vtkWebGPUVolume methods\n// ----------------------------------------------------------------------------\n\nfunction vtkWebGPUVolume(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkWebGPUVolume');\n\n  // Builds myself.\n  publicAPI.buildPass = prepass => {\n    if (!model.renderable || !model.renderable.getVisibility()) {\n      return;\n    }\n    if (prepass) {\n      model.WebGPURenderer = publicAPI.getFirstAncestorOfType('vtkWebGPURenderer');\n      model.WebGPURenderWindow = model.WebGPURenderer.getFirstAncestorOfType('vtkWebGPURenderWindow');\n      // for the future if we support hardware selection of volumes\n      if (model.propID === undefined) {\n        model.propID = model.WebGPURenderWindow.getUniquePropID();\n      }\n      model.renderable.getMapper().update();\n    }\n  };\n  publicAPI.queryPass = (prepass, renderPass) => {\n    if (prepass) {\n      if (!model.renderable || !model.renderable.getVisibility()) {\n        return;\n      }\n\n      // Check for the special case when the mapper's bounds are unknown\n      const bds = model.renderable.getMapper().getBounds();\n      if (!bds || bds.length !== 6 || bds[0] > bds[1]) {\n        return;\n      }\n      renderPass.addVolume(publicAPI);\n    }\n  };\n\n  // used in the method below\n  const idx = new Float64Array(3);\n  const vout = new Float64Array(3);\n  publicAPI.getBoundingCubePoints = (result, offset) => {\n    const input = model.renderable.getMapper().getInputData();\n    if (!input) {\n      return;\n    }\n    const extent = input.getExtent();\n    const m = model.renderable.getMatrix();\n    let count = 0;\n    for (let iz = 4; iz < 6; iz++) {\n      idx[2] = extent[iz];\n      for (let iy = 2; iy < 4; iy++) {\n        idx[1] = extent[iy];\n        for (let ix = 0; ix < 2; ix++) {\n          idx[0] = extent[ix];\n          input.indexToWorld(idx, vout);\n          let poffset = offset + count * 3;\n          result[poffset++] = m[0] * vout[0] + m[1] * vout[1] + m[2] * vout[2] + m[3];\n          result[poffset++] = m[4] * vout[0] + m[5] * vout[1] + m[6] * vout[2] + m[7];\n          result[poffset++] = m[8] * vout[0] + m[9] * vout[1] + m[10] * vout[2] + m[11];\n          count++;\n        }\n      }\n    }\n  };\n  publicAPI.getKeyMatrices = wgpuRen => {\n    // has the actor or stabilization center changed?\n    if (Math.max(model.renderable.getMTime(), wgpuRen.getStabilizedTime()) > model.keyMatricesTime.getMTime()) {\n      model.renderable.computeMatrix();\n      const mcwc = model.renderable.getMatrix();\n\n      // compute the net shift\n      const center = wgpuRen.getStabilizedCenterByReference();\n      mat4.transpose(model.keyMatrices.bcwc, mcwc);\n\n      // to get to stabilized we also need the center\n      mat4.translate(model.keyMatrices.bcsc, model.keyMatrices.bcwc, [-center[0], -center[1], -center[2]]);\n      model.keyMatricesTime.modified();\n    }\n    return model.keyMatrices;\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {\n  propID: undefined,\n  keyMatricesTime: null\n};\n\n// ----------------------------------------------------------------------------\n\nfunction extend(publicAPI, model) {\n  let initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  // Inheritance\n  vtkViewNode.extend(publicAPI, model, initialValues);\n  model.keyMatricesTime = {};\n  macro.obj(model.keyMatricesTime, {\n    mtime: 0\n  });\n  model.keyMatrices = {\n    bcwc: new Float64Array(16),\n    bcsc: new Float64Array(16)\n  };\n  macro.get(publicAPI, model, ['propID', 'keyMatricesTime']);\n\n  // Object methods\n  vtkWebGPUVolume(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nconst newInstance = macro.newInstance(extend, 'vtkWebGPUVolume');\n\n// ----------------------------------------------------------------------------\n\nvar index = {\n  newInstance,\n  extend\n};\n\n// Register ourself to WebGPU backend if imported\nregisterOverride('vtkVolume', newInstance);\n\nexport { index as default, extend, newInstance };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}