{"ast":null,"code":"import { vec3 } from 'gl-matrix';\nimport { metaData } from '..';\nfunction worldToImageCoords(imageId, worldCoords) {\n  const imagePlaneModule = metaData.get('imagePlaneModule', imageId);\n  if (!imagePlaneModule) {\n    throw new Error(`No imagePlaneModule found for imageId: ${imageId}`);\n  }\n  const {\n    columnCosines,\n    rowCosines,\n    imagePositionPatient: origin\n  } = imagePlaneModule;\n  let {\n    columnPixelSpacing,\n    rowPixelSpacing\n  } = imagePlaneModule;\n  columnPixelSpacing ||= 1;\n  rowPixelSpacing ||= 1;\n  const newOrigin = vec3.create();\n  vec3.scaleAndAdd(newOrigin, origin, columnCosines, -columnPixelSpacing / 2);\n  vec3.scaleAndAdd(newOrigin, newOrigin, rowCosines, -rowPixelSpacing / 2);\n  const sub = vec3.create();\n  vec3.sub(sub, worldCoords, newOrigin);\n  const rowDistance = vec3.dot(sub, rowCosines);\n  const columnDistance = vec3.dot(sub, columnCosines);\n  const imageCoords = [rowDistance / rowPixelSpacing, columnDistance / columnPixelSpacing];\n  return imageCoords;\n}\nexport default worldToImageCoords;","map":{"version":3,"names":["vec3","metaData","worldToImageCoords","imageId","worldCoords","imagePlaneModule","get","Error","columnCosines","rowCosines","imagePositionPatient","origin","columnPixelSpacing","rowPixelSpacing","newOrigin","create","scaleAndAdd","sub","rowDistance","dot","columnDistance","imageCoords"],"sources":["../../../src/utilities/worldToImageCoords.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,IAAI,QAAQ,WAAW;AAChC,SAASC,QAAQ,QAAQ,IAAI;AAa7B,SAASC,kBAAkBA,CACzBC,OAAe,EACfC,WAAmB;EAEnB,MAAMC,gBAAgB,GAAGJ,QAAQ,CAACK,GAAG,CAAC,kBAAkB,EAAEH,OAAO,CAAC;EAElE,IAAI,CAACE,gBAAgB,EAAE;IACrB,MAAM,IAAIE,KAAK,CAAC,0CAA0CJ,OAAO,EAAE,CAAC;;EAMtE,MAAM;IACJK,aAAa;IACbC,UAAU;IACVC,oBAAoB,EAAEC;EAAM,CAC7B,GAAGN,gBAAgB;EAEpB,IAAI;IAAEO,kBAAkB;IAAEC;EAAe,CAAE,GAAGR,gBAAgB;EAE9DO,kBAAkB,KAAK,CAAC;EACxBC,eAAe,KAAK,CAAC;EAKrB,MAAMC,SAAS,GAAGd,IAAI,CAACe,MAAM,EAAE;EAE/Bf,IAAI,CAACgB,WAAW,CAACF,SAAS,EAAEH,MAAM,EAAEH,aAAa,EAAE,CAACI,kBAAkB,GAAG,CAAC,CAAC;EAC3EZ,IAAI,CAACgB,WAAW,CAACF,SAAS,EAAEA,SAAS,EAAEL,UAAU,EAAE,CAACI,eAAe,GAAG,CAAC,CAAC;EAGxE,MAAMI,GAAG,GAAGjB,IAAI,CAACe,MAAM,EAAE;EACzBf,IAAI,CAACiB,GAAG,CAACA,GAAG,EAAEb,WAAW,EAAEU,SAAS,CAAC;EAGrC,MAAMI,WAAW,GAAGlB,IAAI,CAACmB,GAAG,CAACF,GAAG,EAAER,UAAU,CAAC;EAG7C,MAAMW,cAAc,GAAGpB,IAAI,CAACmB,GAAG,CAACF,GAAG,EAAET,aAAa,CAAC;EAEnD,MAAMa,WAAW,GAAG,CAClBH,WAAW,GAAGL,eAAe,EAC7BO,cAAc,GAAGR,kBAAkB,CACpC;EAED,OAAOS,WAAqB;AAC9B;AAEA,eAAenB,kBAAkB"},"metadata":{},"sourceType":"module","externalDependencies":[]}