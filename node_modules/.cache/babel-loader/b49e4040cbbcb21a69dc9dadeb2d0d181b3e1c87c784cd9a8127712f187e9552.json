{"ast":null,"code":"import { getEnabledElement } from '@cornerstonejs/core';\nimport { drawHandles as drawHandlesSvg, drawTextBox as drawTextBoxSvg } from '../../drawingSvg';\nimport { getViewportIdsWithToolToRender } from '../../utilities/viewportFilters';\nimport { hideElementCursor } from '../../cursors/elementCursor';\nimport triggerAnnotationRenderForViewportIds from '../../utilities/triggerAnnotationRenderForViewportIds';\nimport ProbeTool from './ProbeTool';\nimport { isViewportPreScaled } from '../../utilities/viewport/isViewportPreScaled';\nclass DragProbeTool extends ProbeTool {\n  constructor(toolProps = {}, defaultToolProps = {\n    supportedInteractionTypes: ['Mouse', 'Touch'],\n    configuration: {\n      shadow: true,\n      preventHandleOutsideImage: false,\n      getTextLines: defaultGetTextLines\n    }\n  }) {\n    super(toolProps, defaultToolProps);\n    this.postMouseDownCallback = evt => {\n      const eventDetail = evt.detail;\n      const {\n        currentPoints,\n        element\n      } = eventDetail;\n      const worldPos = currentPoints.world;\n      const enabledElement = getEnabledElement(element);\n      const {\n        viewport,\n        renderingEngine\n      } = enabledElement;\n      this.isDrawing = true;\n      const camera = viewport.getCamera();\n      const {\n        viewPlaneNormal,\n        viewUp\n      } = camera;\n      const referencedImageId = this.getReferencedImageId(viewport, worldPos, viewPlaneNormal, viewUp);\n      const annotation = {\n        invalidated: true,\n        highlighted: true,\n        isVisible: true,\n        metadata: {\n          toolName: this.getToolName(),\n          viewPlaneNormal: [...viewPlaneNormal],\n          viewUp: [...viewUp],\n          FrameOfReferenceUID: viewport.getFrameOfReferenceUID(),\n          referencedImageId\n        },\n        data: {\n          label: '',\n          handles: {\n            points: [[...worldPos]]\n          },\n          cachedStats: {}\n        }\n      };\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      this.editData = {\n        annotation,\n        newAnnotation: true,\n        viewportIdsToRender\n      };\n      this._activateModify(element);\n      hideElementCursor(element);\n      evt.preventDefault();\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      return annotation;\n    };\n    this.postTouchStartCallback = evt => {\n      return this.postMouseDownCallback(evt);\n    };\n    this.renderAnnotation = (enabledElement, svgDrawingHelper) => {\n      let renderStatus = false;\n      const {\n        viewport\n      } = enabledElement;\n      if (!this.editData) {\n        return renderStatus;\n      }\n      const annotations = this.filterInteractableAnnotationsForElement(viewport.element, [this.editData.annotation]);\n      if (!annotations?.length) {\n        return renderStatus;\n      }\n      const targetId = this.getTargetId(viewport);\n      const renderingEngine = viewport.getRenderingEngine();\n      const styleSpecifier = {\n        toolGroupId: this.toolGroupId,\n        toolName: this.getToolName(),\n        viewportId: enabledElement.viewport.id\n      };\n      const annotation = this.editData.annotation;\n      const annotationUID = annotation.annotationUID;\n      const data = annotation.data;\n      const point = data.handles.points[0];\n      const canvasCoordinates = viewport.worldToCanvas(point);\n      styleSpecifier.annotationUID = annotationUID;\n      const {\n        color\n      } = this.getAnnotationStyle({\n        annotation,\n        styleSpecifier\n      });\n      const modalityUnitOptions = {\n        isPreScaled: isViewportPreScaled(viewport, targetId),\n        isSuvScaled: this.isSuvScaled(viewport, targetId, annotation.metadata.referencedImageId)\n      };\n      if (!data.cachedStats[targetId] || data.cachedStats[targetId].value == null) {\n        data.cachedStats[targetId] = {\n          Modality: null,\n          index: null,\n          value: null\n        };\n        this._calculateCachedStats(annotation, renderingEngine, enabledElement);\n      } else if (annotation.invalidated) {\n        this._calculateCachedStats(annotation, renderingEngine, enabledElement);\n      }\n      if (!viewport.getRenderingEngine()) {\n        console.warn('Rendering Engine has been destroyed');\n        return renderStatus;\n      }\n      const handleGroupUID = '0';\n      drawHandlesSvg(svgDrawingHelper, annotationUID, handleGroupUID, [canvasCoordinates], {\n        color\n      });\n      renderStatus = true;\n      const textLines = this.configuration.getTextLines(data, targetId);\n      if (textLines) {\n        const textCanvasCoordinates = [canvasCoordinates[0] + 6, canvasCoordinates[1] - 6];\n        const textUID = '0';\n        drawTextBoxSvg(svgDrawingHelper, annotationUID, textUID, textLines, [textCanvasCoordinates[0], textCanvasCoordinates[1]], this.getLinkedTextBoxStyle(styleSpecifier, annotation));\n      }\n      return renderStatus;\n    };\n  }\n}\nfunction defaultGetTextLines(data, targetId) {\n  const cachedVolumeStats = data.cachedStats[targetId];\n  const {\n    index,\n    value,\n    modalityUnit\n  } = cachedVolumeStats;\n  if (value === undefined) {\n    return;\n  }\n  const textLines = [];\n  textLines.push(`(${index[0]}, ${index[1]}, ${index[2]})`);\n  textLines.push(`${value.toFixed(2)} ${modalityUnit}`);\n  return textLines;\n}\nDragProbeTool.toolName = 'DragProbe';\nexport default DragProbeTool;","map":{"version":3,"names":["getEnabledElement","drawHandles","drawHandlesSvg","drawTextBox","drawTextBoxSvg","getViewportIdsWithToolToRender","hideElementCursor","triggerAnnotationRenderForViewportIds","ProbeTool","isViewportPreScaled","DragProbeTool","constructor","toolProps","defaultToolProps","supportedInteractionTypes","configuration","shadow","preventHandleOutsideImage","getTextLines","defaultGetTextLines","postMouseDownCallback","evt","eventDetail","detail","currentPoints","element","worldPos","world","enabledElement","viewport","renderingEngine","isDrawing","camera","getCamera","viewPlaneNormal","viewUp","referencedImageId","getReferencedImageId","annotation","invalidated","highlighted","isVisible","metadata","toolName","getToolName","FrameOfReferenceUID","getFrameOfReferenceUID","data","label","handles","points","cachedStats","viewportIdsToRender","editData","newAnnotation","_activateModify","preventDefault","postTouchStartCallback","renderAnnotation","svgDrawingHelper","renderStatus","annotations","filterInteractableAnnotationsForElement","length","targetId","getTargetId","getRenderingEngine","styleSpecifier","toolGroupId","viewportId","id","annotationUID","point","canvasCoordinates","worldToCanvas","color","getAnnotationStyle","modalityUnitOptions","isPreScaled","isSuvScaled","value","Modality","index","_calculateCachedStats","console","warn","handleGroupUID","textLines","textCanvasCoordinates","textUID","getLinkedTextBoxStyle","cachedVolumeStats","modalityUnit","undefined","push","toFixed"],"sources":["../../../../src/tools/annotation/DragProbeTool.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}