{"ast":null,"code":"import { getEnabledElement } from '@cornerstonejs/core';\nimport { resetElementCursor, hideElementCursor } from '../../../cursors/elementCursor';\nimport { Events } from '../../../enums';\nimport { state } from '../../../store';\nimport { vec3 } from 'gl-matrix';\nimport { shouldInterpolate, getInterpolatedPoints } from '../../../utilities/planarFreehandROITool/interpolatePoints';\nimport triggerAnnotationRenderForViewportIds from '../../../utilities/triggerAnnotationRenderForViewportIds';\nimport findOpenUShapedContourVectorToPeak from './findOpenUShapedContourVectorToPeak';\nimport { polyline } from '../../../utilities/math';\nimport { removeAnnotation } from '../../../stateManagement/annotation/annotationState';\nconst {\n  addCanvasPointsToArray,\n  pointsAreWithinCloseContourProximity,\n  getFirstIntersectionWithPolyline,\n  getSubPixelSpacingAndXYDirections\n} = polyline;\nfunction activateDraw(evt, annotation, viewportIdsToRender) {\n  this.isDrawing = true;\n  const eventDetail = evt.detail;\n  const {\n    currentPoints,\n    element\n  } = eventDetail;\n  const canvasPos = currentPoints.canvas;\n  const enabledElement = getEnabledElement(element);\n  const {\n    viewport\n  } = enabledElement;\n  const {\n    spacing,\n    xDir,\n    yDir\n  } = getSubPixelSpacingAndXYDirections(viewport, this.configuration.subPixelResolution);\n  this.drawData = {\n    canvasPoints: [canvasPos],\n    polylineIndex: 0\n  };\n  this.commonData = {\n    annotation,\n    viewportIdsToRender,\n    spacing,\n    xDir,\n    yDir,\n    movingTextBox: false\n  };\n  state.isInteractingWithTool = true;\n  element.addEventListener(Events.MOUSE_UP, this.mouseUpDrawCallback);\n  element.addEventListener(Events.MOUSE_DRAG, this.mouseDragDrawCallback);\n  element.addEventListener(Events.MOUSE_CLICK, this.mouseUpDrawCallback);\n  element.addEventListener(Events.TOUCH_END, this.mouseUpDrawCallback);\n  element.addEventListener(Events.TOUCH_DRAG, this.mouseDragDrawCallback);\n  element.addEventListener(Events.TOUCH_TAP, this.mouseUpDrawCallback);\n  hideElementCursor(element);\n}\nfunction deactivateDraw(element) {\n  state.isInteractingWithTool = false;\n  element.removeEventListener(Events.MOUSE_UP, this.mouseUpDrawCallback);\n  element.removeEventListener(Events.MOUSE_DRAG, this.mouseDragDrawCallback);\n  element.removeEventListener(Events.MOUSE_CLICK, this.mouseUpDrawCallback);\n  element.removeEventListener(Events.TOUCH_END, this.mouseUpDrawCallback);\n  element.removeEventListener(Events.TOUCH_DRAG, this.mouseDragDrawCallback);\n  element.removeEventListener(Events.TOUCH_TAP, this.mouseUpDrawCallback);\n  resetElementCursor(element);\n}\nfunction mouseDragDrawCallback(evt) {\n  const eventDetail = evt.detail;\n  const {\n    currentPoints,\n    element\n  } = eventDetail;\n  const worldPos = currentPoints.world;\n  const canvasPos = currentPoints.canvas;\n  const enabledElement = getEnabledElement(element);\n  const {\n    renderingEngine,\n    viewport\n  } = enabledElement;\n  const {\n    annotation,\n    viewportIdsToRender,\n    xDir,\n    yDir,\n    spacing,\n    movingTextBox\n  } = this.commonData;\n  const {\n    polylineIndex,\n    canvasPoints\n  } = this.drawData;\n  const lastCanvasPoint = canvasPoints[canvasPoints.length - 1];\n  const lastWorldPoint = viewport.canvasToWorld(lastCanvasPoint);\n  const worldPosDiff = vec3.create();\n  vec3.subtract(worldPosDiff, worldPos, lastWorldPoint);\n  const xDist = Math.abs(vec3.dot(worldPosDiff, xDir));\n  const yDist = Math.abs(vec3.dot(worldPosDiff, yDir));\n  if (xDist <= spacing[0] && yDist <= spacing[1]) {\n    return;\n  }\n  if (movingTextBox) {\n    this.isDrawing = false;\n    const {\n      deltaPoints\n    } = eventDetail;\n    const worldPosDelta = deltaPoints.world;\n    const {\n      textBox\n    } = annotation.data.handles;\n    const {\n      worldPosition\n    } = textBox;\n    worldPosition[0] += worldPosDelta[0];\n    worldPosition[1] += worldPosDelta[1];\n    worldPosition[2] += worldPosDelta[2];\n    textBox.hasMoved = true;\n  } else {\n    const crossingIndex = this.findCrossingIndexDuringCreate(evt);\n    if (crossingIndex !== undefined) {\n      this.applyCreateOnCross(evt, crossingIndex);\n    } else {\n      const numPointsAdded = addCanvasPointsToArray(element, canvasPoints, canvasPos, this.commonData);\n      this.drawData.polylineIndex = polylineIndex + numPointsAdded;\n    }\n  }\n  triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n}\nfunction mouseUpDrawCallback(evt) {\n  const {\n    allowOpenContours\n  } = this.configuration;\n  const {\n    canvasPoints\n  } = this.drawData;\n  const firstPoint = canvasPoints[0];\n  const lastPoint = canvasPoints[canvasPoints.length - 1];\n  const eventDetail = evt.detail;\n  const {\n    element\n  } = eventDetail;\n  if (allowOpenContours && !pointsAreWithinCloseContourProximity(firstPoint, lastPoint, this.configuration.closeContourProximity)) {\n    this.completeDrawOpenContour(element);\n  } else {\n    this.completeDrawClosedContour(element);\n  }\n}\nfunction completeDrawClosedContour(element) {\n  this.removeCrossedLinesOnCompleteDraw();\n  const {\n    canvasPoints\n  } = this.drawData;\n  if (this.haltDrawing(element, canvasPoints)) {\n    return false;\n  }\n  const {\n    annotation,\n    viewportIdsToRender\n  } = this.commonData;\n  const enabledElement = getEnabledElement(element);\n  const {\n    viewport,\n    renderingEngine\n  } = enabledElement;\n  addCanvasPointsToArray(element, canvasPoints, canvasPoints[0], this.commonData);\n  canvasPoints.pop();\n  const updatedPoints = shouldInterpolate(this.configuration) ? getInterpolatedPoints(this.configuration, canvasPoints) : canvasPoints;\n  const worldPoints = updatedPoints.map(canvasPoint => viewport.canvasToWorld(canvasPoint));\n  annotation.data.contour.polyline = worldPoints;\n  annotation.data.contour.closed = true;\n  const {\n    textBox\n  } = annotation.data.handles;\n  if (!textBox.hasMoved) {\n    this.triggerAnnotationCompleted(annotation);\n  }\n  this.isDrawing = false;\n  this.drawData = undefined;\n  this.commonData = undefined;\n  triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n  this.deactivateDraw(element);\n  return true;\n}\nfunction removeCrossedLinesOnCompleteDraw() {\n  const {\n    canvasPoints\n  } = this.drawData;\n  const numPoints = canvasPoints.length;\n  const endToStart = [canvasPoints[0], canvasPoints[numPoints - 1]];\n  const canvasPointsMinusEnds = canvasPoints.slice(0, -1).slice(1);\n  const lineSegment = getFirstIntersectionWithPolyline(canvasPointsMinusEnds, endToStart[0], endToStart[1], false);\n  if (lineSegment) {\n    const indexToRemoveUpTo = lineSegment[1];\n    this.drawData.canvasPoints = canvasPoints.splice(0, indexToRemoveUpTo);\n  }\n}\nfunction completeDrawOpenContour(element) {\n  const {\n    canvasPoints\n  } = this.drawData;\n  if (this.haltDrawing(element, canvasPoints)) {\n    return false;\n  }\n  const {\n    annotation,\n    viewportIdsToRender\n  } = this.commonData;\n  const enabledElement = getEnabledElement(element);\n  const {\n    viewport,\n    renderingEngine\n  } = enabledElement;\n  const updatedPoints = shouldInterpolate(this.configuration) ? getInterpolatedPoints(this.configuration, canvasPoints) : canvasPoints;\n  const worldPoints = updatedPoints.map(canvasPoint => viewport.canvasToWorld(canvasPoint));\n  annotation.data.contour.polyline = worldPoints;\n  annotation.data.contour.closed = false;\n  const {\n    textBox\n  } = annotation.data.handles;\n  annotation.data.handles.points = [worldPoints[0], worldPoints[worldPoints.length - 1]];\n  if (annotation.data.isOpenUShapeContour) {\n    annotation.data.openUShapeContourVectorToPeak = findOpenUShapedContourVectorToPeak(canvasPoints, viewport);\n  }\n  if (!textBox.hasMoved) {\n    this.triggerAnnotationCompleted(annotation);\n  }\n  this.isDrawing = false;\n  this.drawData = undefined;\n  this.commonData = undefined;\n  triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n  this.deactivateDraw(element);\n  return true;\n}\nfunction findCrossingIndexDuringCreate(evt) {\n  const eventDetail = evt.detail;\n  const {\n    currentPoints,\n    lastPoints\n  } = eventDetail;\n  const canvasPos = currentPoints.canvas;\n  const lastCanvasPoint = lastPoints.canvas;\n  const {\n    canvasPoints\n  } = this.drawData;\n  const pointsLessLastOne = canvasPoints.slice(0, -1);\n  const lineSegment = getFirstIntersectionWithPolyline(pointsLessLastOne, canvasPos, lastCanvasPoint, false);\n  if (lineSegment === undefined) {\n    return;\n  }\n  const crossingIndex = lineSegment[0];\n  return crossingIndex;\n}\nfunction applyCreateOnCross(evt, crossingIndex) {\n  const eventDetail = evt.detail;\n  const {\n    element\n  } = eventDetail;\n  const {\n    canvasPoints\n  } = this.drawData;\n  const {\n    annotation,\n    viewportIdsToRender\n  } = this.commonData;\n  addCanvasPointsToArray(element, canvasPoints, canvasPoints[crossingIndex], this.commonData);\n  canvasPoints.pop();\n  for (let i = 0; i < crossingIndex; i++) {\n    canvasPoints.shift();\n  }\n  if (this.completeDrawClosedContour(element)) {\n    this.activateClosedContourEdit(evt, annotation, viewportIdsToRender);\n  }\n}\nfunction cancelDrawing(element) {\n  const {\n    allowOpenContours\n  } = this.configuration;\n  const {\n    canvasPoints\n  } = this.drawData;\n  const firstPoint = canvasPoints[0];\n  const lastPoint = canvasPoints[canvasPoints.length - 1];\n  if (allowOpenContours && !pointsAreWithinCloseContourProximity(firstPoint, lastPoint, this.configuration.closeContourProximity)) {\n    this.completeDrawOpenContour(element);\n  } else {\n    this.completeDrawClosedContour(element);\n  }\n}\nfunction shouldHaltDrawing(canvasPoints, subPixelResolution) {\n  const minPoints = Math.max(subPixelResolution * 3, 3);\n  return canvasPoints.length < minPoints;\n}\nfunction haltDrawing(element, canvasPoints) {\n  const {\n    subPixelResolution\n  } = this.configuration;\n  if (shouldHaltDrawing(canvasPoints, subPixelResolution)) {\n    const {\n      annotation,\n      viewportIdsToRender\n    } = this.commonData;\n    const enabledElement = getEnabledElement(element);\n    const {\n      renderingEngine\n    } = enabledElement;\n    removeAnnotation(annotation.annotationUID);\n    this.isDrawing = false;\n    this.drawData = undefined;\n    this.commonData = undefined;\n    triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n    this.deactivateDraw(element);\n    return true;\n  }\n  return false;\n}\nfunction registerDrawLoop(toolInstance) {\n  toolInstance.activateDraw = activateDraw.bind(toolInstance);\n  toolInstance.deactivateDraw = deactivateDraw.bind(toolInstance);\n  toolInstance.applyCreateOnCross = applyCreateOnCross.bind(toolInstance);\n  toolInstance.findCrossingIndexDuringCreate = findCrossingIndexDuringCreate.bind(toolInstance);\n  toolInstance.completeDrawOpenContour = completeDrawOpenContour.bind(toolInstance);\n  toolInstance.removeCrossedLinesOnCompleteDraw = removeCrossedLinesOnCompleteDraw.bind(toolInstance);\n  toolInstance.mouseDragDrawCallback = mouseDragDrawCallback.bind(toolInstance);\n  toolInstance.mouseUpDrawCallback = mouseUpDrawCallback.bind(toolInstance);\n  toolInstance.completeDrawClosedContour = completeDrawClosedContour.bind(toolInstance);\n  toolInstance.cancelDrawing = cancelDrawing.bind(toolInstance);\n  toolInstance.haltDrawing = haltDrawing.bind(toolInstance);\n}\nexport default registerDrawLoop;","map":{"version":3,"names":["getEnabledElement","resetElementCursor","hideElementCursor","Events","state","vec3","shouldInterpolate","getInterpolatedPoints","triggerAnnotationRenderForViewportIds","findOpenUShapedContourVectorToPeak","polyline","removeAnnotation","addCanvasPointsToArray","pointsAreWithinCloseContourProximity","getFirstIntersectionWithPolyline","getSubPixelSpacingAndXYDirections","activateDraw","evt","annotation","viewportIdsToRender","isDrawing","eventDetail","detail","currentPoints","element","canvasPos","canvas","enabledElement","viewport","spacing","xDir","yDir","configuration","subPixelResolution","drawData","canvasPoints","polylineIndex","commonData","movingTextBox","isInteractingWithTool","addEventListener","MOUSE_UP","mouseUpDrawCallback","MOUSE_DRAG","mouseDragDrawCallback","MOUSE_CLICK","TOUCH_END","TOUCH_DRAG","TOUCH_TAP","deactivateDraw","removeEventListener","worldPos","world","renderingEngine","lastCanvasPoint","length","lastWorldPoint","canvasToWorld","worldPosDiff","create","subtract","xDist","Math","abs","dot","yDist","deltaPoints","worldPosDelta","textBox","data","handles","worldPosition","hasMoved","crossingIndex","findCrossingIndexDuringCreate","undefined","applyCreateOnCross","numPointsAdded","allowOpenContours","firstPoint","lastPoint","closeContourProximity","completeDrawOpenContour","completeDrawClosedContour","removeCrossedLinesOnCompleteDraw","haltDrawing","pop","updatedPoints","worldPoints","map","canvasPoint","contour","closed","triggerAnnotationCompleted","numPoints","endToStart","canvasPointsMinusEnds","slice","lineSegment","indexToRemoveUpTo","splice","points","isOpenUShapeContour","openUShapeContourVectorToPeak","lastPoints","pointsLessLastOne","i","shift","activateClosedContourEdit","cancelDrawing","shouldHaltDrawing","minPoints","max","annotationUID","registerDrawLoop","toolInstance","bind"],"sources":["../../../../../src/tools/annotation/planarFreehandROITool/drawLoop.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}