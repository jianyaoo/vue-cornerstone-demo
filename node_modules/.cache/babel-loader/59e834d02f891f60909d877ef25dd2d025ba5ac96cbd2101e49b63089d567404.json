{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport { VtkDataTypes } from '../../Common/Core/DataArray/Constants.js';\nimport { m as macro } from '../../macros2.js';\nimport { registerViewConstructor } from '../Core/RenderWindow.js';\nimport vtkForwardPass from './ForwardPass.js';\nimport vtkHardwareSelector from './HardwareSelector.js';\nimport vtkShaderCache from './ShaderCache.js';\nimport vtkTextureUnitManager from './TextureUnitManager.js';\nimport vtkViewNodeFactory from './ViewNodeFactory.js';\nimport vtkRenderPass from '../SceneGraph/RenderPass.js';\nimport vtkRenderWindowViewNode from '../SceneGraph/RenderWindowViewNode.js';\nimport { createContextProxyHandler } from './RenderWindow/ContextProxy.js';\nconst {\n  vtkDebugMacro,\n  vtkErrorMacro\n} = macro;\nconst SCREENSHOT_PLACEHOLDER = {\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  width: '100%',\n  height: '100%'\n};\nfunction checkRenderTargetSupport(gl, format, type) {\n  // create temporary frame buffer and texture\n  const framebuffer = gl.createFramebuffer();\n  const texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texImage2D(gl.TEXTURE_2D, 0, format, 2, 2, 0, format, type, null);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\n  // check frame buffer status\n  const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\n  // clean up\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  return status === gl.FRAMEBUFFER_COMPLETE;\n}\n\n// ----------------------------------------------------------------------------\n// Monitor the usage of GL context across vtkOpenGLRenderWindow instances\n// ----------------------------------------------------------------------------\n\nlet GL_CONTEXT_COUNT = 0;\nconst GL_CONTEXT_LISTENERS = [];\nfunction createGLContext() {\n  GL_CONTEXT_COUNT++;\n  GL_CONTEXT_LISTENERS.forEach(cb => cb(GL_CONTEXT_COUNT));\n}\nfunction deleteGLContext() {\n  GL_CONTEXT_COUNT--;\n  GL_CONTEXT_LISTENERS.forEach(cb => cb(GL_CONTEXT_COUNT));\n}\nfunction pushMonitorGLContextCount(cb) {\n  GL_CONTEXT_LISTENERS.push(cb);\n}\nfunction popMonitorGLContextCount(cb) {\n  return GL_CONTEXT_LISTENERS.pop();\n}\nfunction _preventDefault(e) {\n  e.preventDefault();\n}\n\n// ----------------------------------------------------------------------------\n// vtkOpenGLRenderWindow methods\n// ----------------------------------------------------------------------------\n\nfunction vtkOpenGLRenderWindow(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkOpenGLRenderWindow');\n  const cachingContextHandler = createContextProxyHandler();\n  publicAPI.getViewNodeFactory = () => model.myFactory;\n\n  // prevent default context lost handler\n  model.canvas.addEventListener('webglcontextlost', _preventDefault, false);\n  model.canvas.addEventListener('webglcontextrestored', publicAPI.restoreContext, false);\n\n  // Auto update style\n  const previousSize = [0, 0];\n  function updateWindow() {\n    // Canvas size\n    if (model.renderable) {\n      if (model.size[0] !== previousSize[0] || model.size[1] !== previousSize[1]) {\n        previousSize[0] = model.size[0];\n        previousSize[1] = model.size[1];\n        model.canvas.setAttribute('width', model.size[0]);\n        model.canvas.setAttribute('height', model.size[1]);\n      }\n    }\n\n    // ImageStream size\n    if (model.viewStream) {\n      // If same size that's a NoOp\n      model.viewStream.setSize(model.size[0], model.size[1]);\n    }\n\n    // Offscreen ?\n    model.canvas.style.display = model.useOffScreen ? 'none' : 'block';\n\n    // Cursor type\n    if (model.el) {\n      model.el.style.cursor = model.cursorVisibility ? model.cursor : 'none';\n    }\n\n    // Invalidate cached DOM container size\n    model.containerSize = null;\n  }\n  publicAPI.onModified(updateWindow);\n\n  // Builds myself.\n  publicAPI.buildPass = prepass => {\n    if (prepass) {\n      if (!model.renderable) {\n        return;\n      }\n      publicAPI.prepareNodes();\n      publicAPI.addMissingNodes(model.renderable.getRenderersByReference());\n      publicAPI.removeUnusedNodes();\n      publicAPI.initialize();\n      model.children.forEach(child => {\n        child.setOpenGLRenderWindow(publicAPI);\n      });\n    }\n  };\n  publicAPI.initialize = () => {\n    if (!model.initialized) {\n      model.context = publicAPI.get3DContext();\n      model.textureUnitManager = vtkTextureUnitManager.newInstance();\n      model.textureUnitManager.setContext(model.context);\n      model.shaderCache.setContext(model.context);\n      // initialize blending for transparency\n      const gl = model.context;\n      gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n      gl.depthFunc(gl.LEQUAL);\n      gl.enable(gl.BLEND);\n      model.initialized = true;\n    }\n  };\n  publicAPI.makeCurrent = () => {\n    model.context.makeCurrent();\n  };\n  publicAPI.setContainer = el => {\n    if (model.el && model.el !== el) {\n      if (model.canvas.parentNode !== model.el) {\n        vtkErrorMacro('Error: canvas parent node does not match container');\n      }\n\n      // Remove canvas from previous container\n      model.el.removeChild(model.canvas);\n\n      // If the renderer has previously added\n      // a background image, remove it from the DOM.\n      if (model.el.contains(model.bgImage)) {\n        model.el.removeChild(model.bgImage);\n      }\n    }\n    if (model.el !== el) {\n      model.el = el;\n      if (model.el) {\n        model.el.appendChild(model.canvas);\n\n        // If the renderer is set to use a background\n        // image, attach it to the DOM.\n        if (model.useBackgroundImage) {\n          model.el.appendChild(model.bgImage);\n        }\n      }\n\n      // Trigger modified()\n      publicAPI.modified();\n    }\n  };\n  publicAPI.getContainer = () => model.el;\n  publicAPI.getContainerSize = () => {\n    if (!model.containerSize && model.el) {\n      const {\n        width,\n        height\n      } = model.el.getBoundingClientRect();\n      model.containerSize = [width, height];\n    }\n    return model.containerSize || model.size;\n  };\n  publicAPI.getFramebufferSize = () => {\n    if (model.activeFramebuffer) {\n      return model.activeFramebuffer.getSize();\n    }\n    return model.size;\n  };\n  publicAPI.getPixelData = (x1, y1, x2, y2) => {\n    const pixels = new Uint8Array((x2 - x1 + 1) * (y2 - y1 + 1) * 4);\n    model.context.readPixels(x1, y1, x2 - x1 + 1, y2 - y1 + 1, model.context.RGBA, model.context.UNSIGNED_BYTE, pixels);\n    return pixels;\n  };\n  publicAPI.get3DContext = function () {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      preserveDrawingBuffer: false,\n      depth: true,\n      alpha: true,\n      powerPreference: 'high-performance'\n    };\n    let result = null;\n    const webgl2Supported = typeof WebGL2RenderingContext !== 'undefined';\n    model.webgl2 = false;\n    if (model.defaultToWebgl2 && webgl2Supported) {\n      result = model.canvas.getContext('webgl2', options);\n      if (result) {\n        model.webgl2 = true;\n        vtkDebugMacro('using webgl2');\n      }\n    }\n    if (!result) {\n      vtkDebugMacro('using webgl1');\n      result = model.canvas.getContext('webgl', options) || model.canvas.getContext('experimental-webgl', options);\n    }\n    return new Proxy(result, cachingContextHandler);\n  };\n  publicAPI.restoreContext = () => {\n    const rp = vtkRenderPass.newInstance();\n    rp.setCurrentOperation('Release');\n    rp.traverse(publicAPI, null);\n  };\n  publicAPI.activateTexture = texture => {\n    // Only add if it isn't already there\n    const result = model._textureResourceIds.get(texture);\n    if (result !== undefined) {\n      model.context.activeTexture(model.context.TEXTURE0 + result);\n      return;\n    }\n    const activeUnit = publicAPI.getTextureUnitManager().allocate();\n    if (activeUnit < 0) {\n      vtkErrorMacro('Hardware does not support the number of textures defined.');\n      return;\n    }\n    model._textureResourceIds.set(texture, activeUnit);\n    model.context.activeTexture(model.context.TEXTURE0 + activeUnit);\n  };\n  publicAPI.deactivateTexture = texture => {\n    // Only deactivate if it isn't already there\n    const result = model._textureResourceIds.get(texture);\n    if (result !== undefined) {\n      publicAPI.getTextureUnitManager().free(result);\n      model._textureResourceIds.delete(texture);\n    }\n  };\n  publicAPI.getTextureUnitForTexture = texture => {\n    const result = model._textureResourceIds.get(texture);\n    if (result !== undefined) {\n      return result;\n    }\n    return -1;\n  };\n  publicAPI.getDefaultTextureByteSize = function (vtkType) {\n    let oglNorm16Ext = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    let useHalfFloat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    if (model.webgl2) {\n      switch (vtkType) {\n        case VtkDataTypes.CHAR:\n        case VtkDataTypes.SIGNED_CHAR:\n        case VtkDataTypes.UNSIGNED_CHAR:\n          return 1;\n        case oglNorm16Ext:\n        case useHalfFloat:\n        case VtkDataTypes.UNSIGNED_SHORT:\n        case VtkDataTypes.SHORT:\n        case VtkDataTypes.VOID:\n          // Used for unsigned int depth\n          return 2;\n        default:\n          // For all other cases, assume float\n          return 4;\n      }\n    }\n\n    // webgl1 type support is limited to 1 byte\n    return 1;\n  };\n  publicAPI.getDefaultTextureInternalFormat = function (vtktype, numComps) {\n    let oglNorm16Ext = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    let useHalfFloat = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n    if (model.webgl2) {\n      switch (vtktype) {\n        case VtkDataTypes.UNSIGNED_CHAR:\n          switch (numComps) {\n            case 1:\n              return model.context.R8;\n            case 2:\n              return model.context.RG8;\n            case 3:\n              return model.context.RGB8;\n            case 4:\n            default:\n              return model.context.RGBA8;\n          }\n        case oglNorm16Ext && !useHalfFloat && VtkDataTypes.UNSIGNED_SHORT:\n          switch (numComps) {\n            case 1:\n              return oglNorm16Ext.R16_EXT;\n            case 2:\n              return oglNorm16Ext.RG16_EXT;\n            case 3:\n              return oglNorm16Ext.RGB16_EXT;\n            case 4:\n            default:\n              return oglNorm16Ext.RGBA16_EXT;\n          }\n        // prioritize norm16 over float\n        case oglNorm16Ext && !useHalfFloat && VtkDataTypes.SHORT:\n          switch (numComps) {\n            case 1:\n              return oglNorm16Ext.R16_SNORM_EXT;\n            case 2:\n              return oglNorm16Ext.RG16_SNORM_EXT;\n            case 3:\n              return oglNorm16Ext.RGB16_SNORM_EXT;\n            case 4:\n            default:\n              return oglNorm16Ext.RGBA16_SNORM_EXT;\n          }\n        case VtkDataTypes.FLOAT:\n        default:\n          switch (numComps) {\n            case 1:\n              return model.context.R16F;\n            case 2:\n              return model.context.RG16F;\n            case 3:\n              return model.context.RGB16F;\n            case 4:\n            default:\n              return model.context.RGBA16F;\n          }\n      }\n    }\n\n    // webgl1 only supports four types\n    switch (numComps) {\n      case 1:\n        return model.context.LUMINANCE;\n      case 2:\n        return model.context.LUMINANCE_ALPHA;\n      case 3:\n        return model.context.RGB;\n      case 4:\n      default:\n        return model.context.RGBA;\n    }\n  };\n  publicAPI.setBackgroundImage = img => {\n    model.bgImage.src = img.src;\n  };\n  publicAPI.setUseBackgroundImage = value => {\n    model.useBackgroundImage = value;\n\n    // Add or remove the background image from the\n    // DOM as specified.\n    if (model.useBackgroundImage && !model.el.contains(model.bgImage)) {\n      model.el.appendChild(model.bgImage);\n    } else if (!model.useBackgroundImage && model.el.contains(model.bgImage)) {\n      model.el.removeChild(model.bgImage);\n    }\n  };\n  function getCanvasDataURL() {\n    let format = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : model.imageFormat;\n    // Copy current canvas to not modify the original\n    const temporaryCanvas = document.createElement('canvas');\n    const temporaryContext = temporaryCanvas.getContext('2d');\n    temporaryCanvas.width = model.canvas.width;\n    temporaryCanvas.height = model.canvas.height;\n    temporaryContext.drawImage(model.canvas, 0, 0);\n\n    // Get current client rect to place canvas\n    const mainBoundingClientRect = model.canvas.getBoundingClientRect();\n    const renderWindow = model.renderable;\n    const renderers = renderWindow.getRenderers();\n    renderers.forEach(renderer => {\n      const viewProps = renderer.getViewProps();\n      viewProps.forEach(viewProp => {\n        // Check if the prop has a container that should have canvas\n        if (viewProp.getContainer) {\n          const container = viewProp.getContainer();\n          const canvasList = container.getElementsByTagName('canvas');\n          // Go throughout all canvas and copy it into temporary main canvas\n          for (let i = 0; i < canvasList.length; i++) {\n            const currentCanvas = canvasList[i];\n            const boundingClientRect = currentCanvas.getBoundingClientRect();\n            const newXPosition = boundingClientRect.x - mainBoundingClientRect.x;\n            const newYPosition = boundingClientRect.y - mainBoundingClientRect.y;\n            temporaryContext.drawImage(currentCanvas, newXPosition, newYPosition);\n          }\n        }\n      });\n    });\n    const screenshot = temporaryCanvas.toDataURL(format);\n    temporaryCanvas.remove();\n    publicAPI.invokeImageReady(screenshot);\n  }\n  publicAPI.captureNextImage = function () {\n    let format = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'image/png';\n    let {\n      resetCamera = false,\n      size = null,\n      scale = 1\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    if (model.deleted) {\n      return null;\n    }\n    model.imageFormat = format;\n    const previous = model.notifyStartCaptureImage;\n    model.notifyStartCaptureImage = true;\n    model._screenshot = {\n      size: !!size || scale !== 1 ? size || model.size.map(val => val * scale) : null\n    };\n    return new Promise((resolve, reject) => {\n      const subscription = publicAPI.onImageReady(imageURL => {\n        if (model._screenshot.size === null) {\n          model.notifyStartCaptureImage = previous;\n          subscription.unsubscribe();\n          if (model._screenshot.placeHolder) {\n            // resize the main canvas back to its original size and show it\n            model.size = model._screenshot.originalSize;\n\n            // process the resize\n            publicAPI.modified();\n\n            // restore the saved camera parameters, if applicable\n            if (model._screenshot.cameras) {\n              model._screenshot.cameras.forEach(_ref => {\n                let {\n                  restoreParamsFn,\n                  arg\n                } = _ref;\n                return restoreParamsFn(arg);\n              });\n            }\n\n            // Trigger a render at the original size\n            publicAPI.traverseAllPasses();\n\n            // Remove and clean up the placeholder, revealing the original\n            model.el.removeChild(model._screenshot.placeHolder);\n            model._screenshot.placeHolder.remove();\n            model._screenshot = null;\n          }\n          resolve(imageURL);\n        } else {\n          // Create a placeholder image overlay while we resize and render\n          const tmpImg = document.createElement('img');\n          tmpImg.style = SCREENSHOT_PLACEHOLDER;\n          tmpImg.src = imageURL;\n          model._screenshot.placeHolder = model.el.appendChild(tmpImg);\n\n          // hide the main canvas\n          model.canvas.style.display = 'none';\n\n          // remember the main canvas original size, then resize it\n          model._screenshot.originalSize = model.size;\n          model.size = model._screenshot.size;\n          model._screenshot.size = null;\n\n          // process the resize\n          publicAPI.modified();\n          if (resetCamera) {\n            const isUserResetCamera = resetCamera !== true;\n\n            // If resetCamera was requested, we first save camera parameters\n            // from all the renderers, so we can restore them later\n            model._screenshot.cameras = model.renderable.getRenderers().map(renderer => {\n              const camera = renderer.getActiveCamera();\n              const params = camera.get('focalPoint', 'position', 'parallelScale');\n              return {\n                resetCameraArgs: isUserResetCamera ? {\n                  renderer\n                } : undefined,\n                resetCameraFn: isUserResetCamera ? resetCamera : renderer.resetCamera,\n                restoreParamsFn: camera.set,\n                // \"clone\" the params so we don't keep refs to properties\n                arg: JSON.parse(JSON.stringify(params))\n              };\n            });\n\n            // Perform the resetCamera() on each renderer only after capturing\n            // the params from all active cameras, in case there happen to be\n            // linked cameras among the renderers.\n            model._screenshot.cameras.forEach(_ref2 => {\n              let {\n                resetCameraFn,\n                resetCameraArgs\n              } = _ref2;\n              return resetCameraFn(resetCameraArgs);\n            });\n          }\n\n          // Trigger a render at the custom size\n          publicAPI.traverseAllPasses();\n        }\n      });\n    });\n  };\n  let hardwareMaximumLineWidth;\n  publicAPI.getHardwareMaximumLineWidth = () => {\n    // We cache the result of this function because `getParameter` is slow\n    if (hardwareMaximumLineWidth != null) {\n      return hardwareMaximumLineWidth;\n    }\n    const gl = publicAPI.get3DContext();\n    const lineWidthRange = gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE);\n    hardwareMaximumLineWidth = lineWidthRange[1];\n    return lineWidthRange[1];\n  };\n  publicAPI.getGLInformations = () => {\n    if (model._glInformation) {\n      return model._glInformation;\n    }\n    const gl = publicAPI.get3DContext();\n    const glTextureFloat = gl.getExtension('OES_texture_float');\n    const glTextureHalfFloat = gl.getExtension('OES_texture_half_float');\n    const glDebugRendererInfo = gl.getExtension('WEBGL_debug_renderer_info');\n    const glDrawBuffers = gl.getExtension('WEBGL_draw_buffers');\n    const glAnisotropic = gl.getExtension('EXT_texture_filter_anisotropic') || gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');\n    const params = [['Max Vertex Attributes', 'MAX_VERTEX_ATTRIBS', gl.getParameter(gl.MAX_VERTEX_ATTRIBS)], ['Max Varying Vectors', 'MAX_VARYING_VECTORS', gl.getParameter(gl.MAX_VARYING_VECTORS)], ['Max Vertex Uniform Vectors', 'MAX_VERTEX_UNIFORM_VECTORS', gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS)], ['Max Fragment Uniform Vectors', 'MAX_FRAGMENT_UNIFORM_VECTORS', gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS)], ['Max Fragment Texture Image Units', 'MAX_TEXTURE_IMAGE_UNITS', gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)], ['Max Vertex Texture Image Units', 'MAX_VERTEX_TEXTURE_IMAGE_UNITS', gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)], ['Max Combined Texture Image Units', 'MAX_COMBINED_TEXTURE_IMAGE_UNITS', gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)], ['Max 2D Texture Size', 'MAX_TEXTURE_SIZE', gl.getParameter(gl.MAX_TEXTURE_SIZE)], ['Max Cube Texture Size', 'MAX_CUBE_MAP_TEXTURE_SIZE', gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE)], ['Max Texture Anisotropy', 'MAX_TEXTURE_MAX_ANISOTROPY_EXT', glAnisotropic && gl.getParameter(glAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)], ['Point Size Range', 'ALIASED_POINT_SIZE_RANGE', gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE).join(' - ')], ['Line Width Range', 'ALIASED_LINE_WIDTH_RANGE', gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE).join(' - ')], ['Max Viewport Dimensions', 'MAX_VIEWPORT_DIMS', gl.getParameter(gl.MAX_VIEWPORT_DIMS).join(' - ')], ['Max Renderbuffer Size', 'MAX_RENDERBUFFER_SIZE', gl.getParameter(gl.MAX_RENDERBUFFER_SIZE)], ['Framebuffer Red Bits', 'RED_BITS', gl.getParameter(gl.RED_BITS)], ['Framebuffer Green Bits', 'GREEN_BITS', gl.getParameter(gl.GREEN_BITS)], ['Framebuffer Blue Bits', 'BLUE_BITS', gl.getParameter(gl.BLUE_BITS)], ['Framebuffer Alpha Bits', 'ALPHA_BITS', gl.getParameter(gl.ALPHA_BITS)], ['Framebuffer Depth Bits', 'DEPTH_BITS', gl.getParameter(gl.DEPTH_BITS)], ['Framebuffer Stencil Bits', 'STENCIL_BITS', gl.getParameter(gl.STENCIL_BITS)], ['Framebuffer Subpixel Bits', 'SUBPIXEL_BITS', gl.getParameter(gl.SUBPIXEL_BITS)], ['MSAA Samples', 'SAMPLES', gl.getParameter(gl.SAMPLES)], ['MSAA Sample Buffers', 'SAMPLE_BUFFERS', gl.getParameter(gl.SAMPLE_BUFFERS)], ['Supported Formats for UByte Render Targets     ', 'UNSIGNED_BYTE RENDER TARGET FORMATS', [glTextureFloat && checkRenderTargetSupport(gl, gl.RGBA, gl.UNSIGNED_BYTE) ? 'RGBA' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.RGB, gl.UNSIGNED_BYTE) ? 'RGB' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.LUMINANCE, gl.UNSIGNED_BYTE) ? 'LUMINANCE' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.ALPHA, gl.UNSIGNED_BYTE) ? 'ALPHA' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.LUMINANCE_ALPHA, gl.UNSIGNED_BYTE) ? 'LUMINANCE_ALPHA' : ''].join(' ')], ['Supported Formats for Half Float Render Targets', 'HALF FLOAT RENDER TARGET FORMATS', [glTextureHalfFloat && checkRenderTargetSupport(gl, gl.RGBA, glTextureHalfFloat.HALF_FLOAT_OES) ? 'RGBA' : '', glTextureHalfFloat && checkRenderTargetSupport(gl, gl.RGB, glTextureHalfFloat.HALF_FLOAT_OES) ? 'RGB' : '', glTextureHalfFloat && checkRenderTargetSupport(gl, gl.LUMINANCE, glTextureHalfFloat.HALF_FLOAT_OES) ? 'LUMINANCE' : '', glTextureHalfFloat && checkRenderTargetSupport(gl, gl.ALPHA, glTextureHalfFloat.HALF_FLOAT_OES) ? 'ALPHA' : '', glTextureHalfFloat && checkRenderTargetSupport(gl, gl.LUMINANCE_ALPHA, glTextureHalfFloat.HALF_FLOAT_OES) ? 'LUMINANCE_ALPHA' : ''].join(' ')], ['Supported Formats for Full Float Render Targets', 'FLOAT RENDER TARGET FORMATS', [glTextureFloat && checkRenderTargetSupport(gl, gl.RGBA, gl.FLOAT) ? 'RGBA' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.RGB, gl.FLOAT) ? 'RGB' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.LUMINANCE, gl.FLOAT) ? 'LUMINANCE' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.ALPHA, gl.FLOAT) ? 'ALPHA' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.LUMINANCE_ALPHA, gl.FLOAT) ? 'LUMINANCE_ALPHA' : ''].join(' ')], ['Max Multiple Render Targets Buffers', 'MAX_DRAW_BUFFERS_WEBGL', glDrawBuffers ? gl.getParameter(glDrawBuffers.MAX_DRAW_BUFFERS_WEBGL) : 0], ['High Float Precision in Vertex Shader', 'HIGH_FLOAT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).rangeMax, '</sup>)'].join('')], ['Medium Float Precision in Vertex Shader', 'MEDIUM_FLOAT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).rangeMax, '</sup>)'].join('')], ['Low Float Precision in Vertex Shader', 'LOW_FLOAT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT).rangeMax, '</sup>)'].join('')], ['High Float Precision in Fragment Shader', 'HIGH_FLOAT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).rangeMax, '</sup>)'].join('')], ['Medium Float Precision in Fragment Shader', 'MEDIUM_FLOAT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).rangeMax, '</sup>)'].join('')], ['Low Float Precision in Fragment Shader', 'LOW_FLOAT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT).rangeMax, '</sup>)'].join('')], ['High Int Precision in Vertex Shader', 'HIGH_INT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT).rangeMax, '</sup>)'].join('')], ['Medium Int Precision in Vertex Shader', 'MEDIUM_INT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT).rangeMax, '</sup>)'].join('')], ['Low Int Precision in Vertex Shader', 'LOW_INT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT).rangeMax, '</sup>)'].join('')], ['High Int Precision in Fragment Shader', 'HIGH_INT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT).rangeMax, '</sup>)'].join('')], ['Medium Int Precision in Fragment Shader', 'MEDIUM_INT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT).rangeMax, '</sup>)'].join('')], ['Low Int Precision in Fragment Shader', 'LOW_INT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT).rangeMax, '</sup>)'].join('')], ['Supported Extensions', 'EXTENSIONS', gl.getSupportedExtensions().join('<br/>\\t\\t\\t\\t\\t    ')], ['WebGL Renderer', 'RENDERER', gl.getParameter(gl.RENDERER)], ['WebGL Vendor', 'VENDOR', gl.getParameter(gl.VENDOR)], ['WebGL Version', 'VERSION', gl.getParameter(gl.VERSION)], ['Shading Language Version', 'SHADING_LANGUAGE_VERSION', gl.getParameter(gl.SHADING_LANGUAGE_VERSION)], ['Unmasked Renderer', 'UNMASKED_RENDERER', glDebugRendererInfo && gl.getParameter(glDebugRendererInfo.UNMASKED_RENDERER_WEBGL)], ['Unmasked Vendor', 'UNMASKED_VENDOR', glDebugRendererInfo && gl.getParameter(glDebugRendererInfo.UNMASKED_VENDOR_WEBGL)], ['WebGL Version', 'WEBGL_VERSION', model.webgl2 ? 2 : 1]];\n    const result = {};\n    while (params.length) {\n      const [label, key, value] = params.pop();\n      if (key) {\n        result[key] = {\n          label,\n          value\n        };\n      }\n    }\n    model._glInformation = result;\n    return result;\n  };\n  publicAPI.traverseAllPasses = () => {\n    if (model.renderPasses) {\n      for (let index = 0; index < model.renderPasses.length; ++index) {\n        model.renderPasses[index].traverse(publicAPI, null);\n      }\n    }\n    if (model.notifyStartCaptureImage) {\n      getCanvasDataURL();\n    }\n  };\n  publicAPI.disableCullFace = () => {\n    if (model.cullFaceEnabled) {\n      model.context.disable(model.context.CULL_FACE);\n      model.cullFaceEnabled = false;\n    }\n  };\n  publicAPI.enableCullFace = () => {\n    if (!model.cullFaceEnabled) {\n      model.context.enable(model.context.CULL_FACE);\n      model.cullFaceEnabled = true;\n    }\n  };\n  publicAPI.setViewStream = stream => {\n    if (model.viewStream === stream) {\n      return false;\n    }\n    if (model.subscription) {\n      model.subscription.unsubscribe();\n      model.subscription = null;\n    }\n    model.viewStream = stream;\n    if (model.viewStream) {\n      // Force background to be transparent + render\n      const mainRenderer = model.renderable.getRenderers()[0];\n      mainRenderer.getBackgroundByReference()[3] = 0;\n\n      // Enable display of the background image\n      publicAPI.setUseBackgroundImage(true);\n\n      // Bind to remote stream\n      model.subscription = model.viewStream.onImageReady(e => publicAPI.setBackgroundImage(e.image));\n      model.viewStream.setSize(model.size[0], model.size[1]);\n      model.viewStream.invalidateCache();\n      model.viewStream.render();\n      publicAPI.modified();\n    }\n    return true;\n  };\n  publicAPI.createSelector = () => {\n    const ret = vtkHardwareSelector.newInstance();\n    ret.setOpenGLRenderWindow(publicAPI);\n    return ret;\n  };\n  function clearEvents() {\n    model.canvas.removeEventListener('webglcontextlost', _preventDefault);\n    model.canvas.removeEventListener('webglcontextrestored', publicAPI.restoreContext);\n  }\n  publicAPI.delete = macro.chain(clearEvents, publicAPI.delete, publicAPI.setViewStream, deleteGLContext);\n\n  // Do not trigger modified for performance reasons\n  publicAPI.setActiveFramebuffer = newActiveFramebuffer => {\n    model.activeFramebuffer = newActiveFramebuffer;\n  };\n  const superSetSize = publicAPI.setSize;\n  publicAPI.setSize = (width, height) => {\n    const modified = superSetSize(width, height);\n    if (modified) {\n      publicAPI.invokeWindowResizeEvent({\n        width,\n        height\n      });\n    }\n    return modified;\n  };\n  publicAPI.getGraphicsResourceForObject = vtkObj => {\n    if (!vtkObj) {\n      return null;\n    }\n    const vtko = model._graphicsResources.get(vtkObj);\n    const vtkh = model._graphicsResourceHash.get(vtkObj);\n    return {\n      vtkObj: vtko,\n      hash: vtkh\n    };\n  };\n  publicAPI.setGraphicsResourceForObject = (vtkObj, gObj, hash) => {\n    if (!vtkObj) {\n      return;\n    }\n    model._graphicsResources.set(vtkObj, gObj);\n    model._graphicsResourceHash.set(vtkObj, hash);\n  };\n  publicAPI.getGraphicsMemoryInfo = () => {\n    let memUsed = 0;\n    model._graphicsResources.forEach((gObj, vtkObj) => {\n      memUsed += gObj.getAllocatedGPUMemoryInBytes();\n    });\n    return memUsed;\n  };\n  publicAPI.releaseGraphicsResourcesForObject = vtkObj => {\n    if (!vtkObj) {\n      return false;\n    }\n    model._graphicsResources.get(vtkObj)?.releaseGraphicsResources(publicAPI);\n    return model._graphicsResources.delete(vtkObj) && model._graphicsResourceHash.delete(vtkObj);\n  };\n  publicAPI.releaseGraphicsResources = () => {\n    // Clear the shader cache\n    if (model.shaderCache !== null) {\n      model.shaderCache.releaseGraphicsResources(publicAPI);\n    }\n    // Free cached graphics resources at the context level\n    model._graphicsResources.forEach((gObj, vtkObj) => {\n      gObj.releaseGraphicsResources(publicAPI);\n    });\n    model._graphicsResources.clear();\n    model._graphicsResourceHash.clear();\n    if (model.textureUnitManager !== null) {\n      model.textureUnitManager.freeAll();\n    }\n    // Finally, ask the renderers to release prop resources\n    model.renderable.getRenderersByReference().forEach(ren => {\n      const glRen = publicAPI.getViewNodeFor(ren);\n      glRen?.releaseGraphicsResources();\n    });\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {\n  cullFaceEnabled: false,\n  shaderCache: null,\n  initialized: false,\n  context: null,\n  canvas: null,\n  cursorVisibility: true,\n  cursor: 'pointer',\n  textureUnitManager: null,\n  textureResourceIds: null,\n  containerSize: null,\n  renderPasses: [],\n  notifyStartCaptureImage: false,\n  webgl2: false,\n  defaultToWebgl2: true,\n  // attempt webgl2 on by default\n  activeFramebuffer: null,\n  imageFormat: 'image/png',\n  useOffScreen: false,\n  useBackgroundImage: false\n};\n\n// ----------------------------------------------------------------------------\n\nfunction extend(publicAPI, model) {\n  let initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  // Inheritance\n  vtkRenderWindowViewNode.extend(publicAPI, model, initialValues);\n\n  // Create internal instances\n  model.canvas = document.createElement('canvas');\n  model.canvas.style.width = '100%';\n  createGLContext();\n  if (!model.selector) {\n    model.selector = vtkHardwareSelector.newInstance();\n    model.selector.setOpenGLRenderWindow(publicAPI);\n  }\n\n  // Create internal bgImage\n  model.bgImage = new Image();\n  model.bgImage.style.position = 'absolute';\n  model.bgImage.style.left = '0';\n  model.bgImage.style.top = '0';\n  model.bgImage.style.width = '100%';\n  model.bgImage.style.height = '100%';\n  model.bgImage.style.zIndex = '-1';\n  model._textureResourceIds = new Map();\n  model._graphicsResources = new Map();\n  model._graphicsResourceHash = new Map();\n  model._glInformation = null;\n  model.myFactory = vtkViewNodeFactory.newInstance();\n  /* eslint-disable no-use-before-define */\n  model.myFactory.registerOverride('vtkRenderWindow', newInstance);\n  /* eslint-enable no-use-before-define */\n\n  model.shaderCache = vtkShaderCache.newInstance();\n  model.shaderCache.setOpenGLRenderWindow(publicAPI);\n\n  // setup default forward pass rendering\n  model.renderPasses[0] = vtkForwardPass.newInstance();\n  macro.event(publicAPI, model, 'imageReady');\n\n  // Build VTK API\n  macro.get(publicAPI, model, ['shaderCache', 'textureUnitManager', 'webgl2', 'useBackgroundImage', 'activeFramebuffer']);\n  macro.setGet(publicAPI, model, ['initialized', 'context', 'canvas', 'renderPasses', 'notifyStartCaptureImage', 'defaultToWebgl2', 'cursor', 'useOffScreen']);\n  macro.setGetArray(publicAPI, model, ['size'], 2);\n  macro.event(publicAPI, model, 'windowResizeEvent');\n\n  // Object methods\n  vtkOpenGLRenderWindow(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nconst newInstance = macro.newInstance(extend, 'vtkOpenGLRenderWindow');\n\n// ----------------------------------------------------------------------------\n// Register API specific RenderWindow implementation\n// ----------------------------------------------------------------------------\n\nregisterViewConstructor('WebGL', newInstance);\n\n// ----------------------------------------------------------------------------\n\nvar vtkRenderWindow = {\n  newInstance,\n  extend,\n  pushMonitorGLContextCount,\n  popMonitorGLContextCount\n};\nexport { vtkRenderWindow as default, extend, newInstance, popMonitorGLContextCount, pushMonitorGLContextCount };","map":{"version":3,"names":["VtkDataTypes","m","macro","registerViewConstructor","vtkForwardPass","vtkHardwareSelector","vtkShaderCache","vtkTextureUnitManager","vtkViewNodeFactory","vtkRenderPass","vtkRenderWindowViewNode","createContextProxyHandler","vtkDebugMacro","vtkErrorMacro","SCREENSHOT_PLACEHOLDER","position","top","left","width","height","checkRenderTargetSupport","gl","format","type","framebuffer","createFramebuffer","texture","createTexture","bindTexture","TEXTURE_2D","texImage2D","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","status","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","GL_CONTEXT_COUNT","GL_CONTEXT_LISTENERS","createGLContext","forEach","cb","deleteGLContext","pushMonitorGLContextCount","push","popMonitorGLContextCount","pop","_preventDefault","e","preventDefault","vtkOpenGLRenderWindow","publicAPI","model","classHierarchy","cachingContextHandler","getViewNodeFactory","myFactory","canvas","addEventListener","restoreContext","previousSize","updateWindow","renderable","size","setAttribute","viewStream","setSize","style","display","useOffScreen","el","cursor","cursorVisibility","containerSize","onModified","buildPass","prepass","prepareNodes","addMissingNodes","getRenderersByReference","removeUnusedNodes","initialize","children","child","setOpenGLRenderWindow","initialized","context","get3DContext","textureUnitManager","newInstance","setContext","shaderCache","blendFuncSeparate","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","depthFunc","LEQUAL","enable","BLEND","makeCurrent","setContainer","parentNode","removeChild","contains","bgImage","appendChild","useBackgroundImage","modified","getContainer","getContainerSize","getBoundingClientRect","getFramebufferSize","activeFramebuffer","getSize","getPixelData","x1","y1","x2","y2","pixels","Uint8Array","readPixels","RGBA","UNSIGNED_BYTE","options","arguments","length","undefined","preserveDrawingBuffer","depth","alpha","powerPreference","result","webgl2Supported","WebGL2RenderingContext","webgl2","defaultToWebgl2","getContext","Proxy","rp","setCurrentOperation","traverse","activateTexture","_textureResourceIds","get","activeTexture","TEXTURE0","activeUnit","getTextureUnitManager","allocate","set","deactivateTexture","free","delete","getTextureUnitForTexture","getDefaultTextureByteSize","vtkType","oglNorm16Ext","useHalfFloat","CHAR","SIGNED_CHAR","UNSIGNED_CHAR","UNSIGNED_SHORT","SHORT","VOID","getDefaultTextureInternalFormat","vtktype","numComps","R8","RG8","RGB8","RGBA8","R16_EXT","RG16_EXT","RGB16_EXT","RGBA16_EXT","R16_SNORM_EXT","RG16_SNORM_EXT","RGB16_SNORM_EXT","RGBA16_SNORM_EXT","FLOAT","R16F","RG16F","RGB16F","RGBA16F","LUMINANCE","LUMINANCE_ALPHA","RGB","setBackgroundImage","img","src","setUseBackgroundImage","value","getCanvasDataURL","imageFormat","temporaryCanvas","document","createElement","temporaryContext","drawImage","mainBoundingClientRect","renderWindow","renderers","getRenderers","renderer","viewProps","getViewProps","viewProp","container","canvasList","getElementsByTagName","i","currentCanvas","boundingClientRect","newXPosition","x","newYPosition","y","screenshot","toDataURL","remove","invokeImageReady","captureNextImage","resetCamera","scale","deleted","previous","notifyStartCaptureImage","_screenshot","map","val","Promise","resolve","reject","subscription","onImageReady","imageURL","unsubscribe","placeHolder","originalSize","cameras","_ref","restoreParamsFn","arg","traverseAllPasses","tmpImg","isUserResetCamera","camera","getActiveCamera","params","resetCameraArgs","resetCameraFn","JSON","parse","stringify","_ref2","hardwareMaximumLineWidth","getHardwareMaximumLineWidth","lineWidthRange","getParameter","ALIASED_LINE_WIDTH_RANGE","getGLInformations","_glInformation","glTextureFloat","getExtension","glTextureHalfFloat","glDebugRendererInfo","glDrawBuffers","glAnisotropic","MAX_VERTEX_ATTRIBS","MAX_VARYING_VECTORS","MAX_VERTEX_UNIFORM_VECTORS","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_TEXTURE_MAX_ANISOTROPY_EXT","ALIASED_POINT_SIZE_RANGE","join","MAX_VIEWPORT_DIMS","MAX_RENDERBUFFER_SIZE","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS","SUBPIXEL_BITS","SAMPLES","SAMPLE_BUFFERS","ALPHA","HALF_FLOAT_OES","MAX_DRAW_BUFFERS_WEBGL","getShaderPrecisionFormat","VERTEX_SHADER","HIGH_FLOAT","precision","rangeMin","rangeMax","MEDIUM_FLOAT","LOW_FLOAT","FRAGMENT_SHADER","HIGH_INT","MEDIUM_INT","LOW_INT","getSupportedExtensions","RENDERER","VENDOR","VERSION","SHADING_LANGUAGE_VERSION","UNMASKED_RENDERER_WEBGL","UNMASKED_VENDOR_WEBGL","label","key","renderPasses","index","disableCullFace","cullFaceEnabled","disable","CULL_FACE","enableCullFace","setViewStream","stream","mainRenderer","getBackgroundByReference","image","invalidateCache","render","createSelector","ret","clearEvents","removeEventListener","chain","setActiveFramebuffer","newActiveFramebuffer","superSetSize","invokeWindowResizeEvent","getGraphicsResourceForObject","vtkObj","vtko","_graphicsResources","vtkh","_graphicsResourceHash","hash","setGraphicsResourceForObject","gObj","getGraphicsMemoryInfo","memUsed","getAllocatedGPUMemoryInBytes","releaseGraphicsResourcesForObject","releaseGraphicsResources","clear","freeAll","ren","glRen","getViewNodeFor","DEFAULT_VALUES","textureResourceIds","extend","initialValues","Object","assign","selector","Image","zIndex","Map","registerOverride","event","setGet","setGetArray","vtkRenderWindow","default"],"sources":["/Users/yzy/Documents/Playground/vue-cornerstone-demo/node_modules/@kitware/vtk.js/Rendering/OpenGL/RenderWindow.js"],"sourcesContent":["import { VtkDataTypes } from '../../Common/Core/DataArray/Constants.js';\nimport { m as macro } from '../../macros2.js';\nimport { registerViewConstructor } from '../Core/RenderWindow.js';\nimport vtkForwardPass from './ForwardPass.js';\nimport vtkHardwareSelector from './HardwareSelector.js';\nimport vtkShaderCache from './ShaderCache.js';\nimport vtkTextureUnitManager from './TextureUnitManager.js';\nimport vtkViewNodeFactory from './ViewNodeFactory.js';\nimport vtkRenderPass from '../SceneGraph/RenderPass.js';\nimport vtkRenderWindowViewNode from '../SceneGraph/RenderWindowViewNode.js';\nimport { createContextProxyHandler } from './RenderWindow/ContextProxy.js';\n\nconst {\n  vtkDebugMacro,\n  vtkErrorMacro\n} = macro;\nconst SCREENSHOT_PLACEHOLDER = {\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  width: '100%',\n  height: '100%'\n};\nfunction checkRenderTargetSupport(gl, format, type) {\n  // create temporary frame buffer and texture\n  const framebuffer = gl.createFramebuffer();\n  const texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texImage2D(gl.TEXTURE_2D, 0, format, 2, 2, 0, format, type, null);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\n  // check frame buffer status\n  const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\n  // clean up\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  return status === gl.FRAMEBUFFER_COMPLETE;\n}\n\n// ----------------------------------------------------------------------------\n// Monitor the usage of GL context across vtkOpenGLRenderWindow instances\n// ----------------------------------------------------------------------------\n\nlet GL_CONTEXT_COUNT = 0;\nconst GL_CONTEXT_LISTENERS = [];\nfunction createGLContext() {\n  GL_CONTEXT_COUNT++;\n  GL_CONTEXT_LISTENERS.forEach(cb => cb(GL_CONTEXT_COUNT));\n}\nfunction deleteGLContext() {\n  GL_CONTEXT_COUNT--;\n  GL_CONTEXT_LISTENERS.forEach(cb => cb(GL_CONTEXT_COUNT));\n}\nfunction pushMonitorGLContextCount(cb) {\n  GL_CONTEXT_LISTENERS.push(cb);\n}\nfunction popMonitorGLContextCount(cb) {\n  return GL_CONTEXT_LISTENERS.pop();\n}\nfunction _preventDefault(e) {\n  e.preventDefault();\n}\n\n// ----------------------------------------------------------------------------\n// vtkOpenGLRenderWindow methods\n// ----------------------------------------------------------------------------\n\nfunction vtkOpenGLRenderWindow(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkOpenGLRenderWindow');\n  const cachingContextHandler = createContextProxyHandler();\n  publicAPI.getViewNodeFactory = () => model.myFactory;\n\n  // prevent default context lost handler\n  model.canvas.addEventListener('webglcontextlost', _preventDefault, false);\n  model.canvas.addEventListener('webglcontextrestored', publicAPI.restoreContext, false);\n\n  // Auto update style\n  const previousSize = [0, 0];\n  function updateWindow() {\n    // Canvas size\n    if (model.renderable) {\n      if (model.size[0] !== previousSize[0] || model.size[1] !== previousSize[1]) {\n        previousSize[0] = model.size[0];\n        previousSize[1] = model.size[1];\n        model.canvas.setAttribute('width', model.size[0]);\n        model.canvas.setAttribute('height', model.size[1]);\n      }\n    }\n\n    // ImageStream size\n    if (model.viewStream) {\n      // If same size that's a NoOp\n      model.viewStream.setSize(model.size[0], model.size[1]);\n    }\n\n    // Offscreen ?\n    model.canvas.style.display = model.useOffScreen ? 'none' : 'block';\n\n    // Cursor type\n    if (model.el) {\n      model.el.style.cursor = model.cursorVisibility ? model.cursor : 'none';\n    }\n\n    // Invalidate cached DOM container size\n    model.containerSize = null;\n  }\n  publicAPI.onModified(updateWindow);\n\n  // Builds myself.\n  publicAPI.buildPass = prepass => {\n    if (prepass) {\n      if (!model.renderable) {\n        return;\n      }\n      publicAPI.prepareNodes();\n      publicAPI.addMissingNodes(model.renderable.getRenderersByReference());\n      publicAPI.removeUnusedNodes();\n      publicAPI.initialize();\n      model.children.forEach(child => {\n        child.setOpenGLRenderWindow(publicAPI);\n      });\n    }\n  };\n  publicAPI.initialize = () => {\n    if (!model.initialized) {\n      model.context = publicAPI.get3DContext();\n      model.textureUnitManager = vtkTextureUnitManager.newInstance();\n      model.textureUnitManager.setContext(model.context);\n      model.shaderCache.setContext(model.context);\n      // initialize blending for transparency\n      const gl = model.context;\n      gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n      gl.depthFunc(gl.LEQUAL);\n      gl.enable(gl.BLEND);\n      model.initialized = true;\n    }\n  };\n  publicAPI.makeCurrent = () => {\n    model.context.makeCurrent();\n  };\n  publicAPI.setContainer = el => {\n    if (model.el && model.el !== el) {\n      if (model.canvas.parentNode !== model.el) {\n        vtkErrorMacro('Error: canvas parent node does not match container');\n      }\n\n      // Remove canvas from previous container\n      model.el.removeChild(model.canvas);\n\n      // If the renderer has previously added\n      // a background image, remove it from the DOM.\n      if (model.el.contains(model.bgImage)) {\n        model.el.removeChild(model.bgImage);\n      }\n    }\n    if (model.el !== el) {\n      model.el = el;\n      if (model.el) {\n        model.el.appendChild(model.canvas);\n\n        // If the renderer is set to use a background\n        // image, attach it to the DOM.\n        if (model.useBackgroundImage) {\n          model.el.appendChild(model.bgImage);\n        }\n      }\n\n      // Trigger modified()\n      publicAPI.modified();\n    }\n  };\n  publicAPI.getContainer = () => model.el;\n  publicAPI.getContainerSize = () => {\n    if (!model.containerSize && model.el) {\n      const {\n        width,\n        height\n      } = model.el.getBoundingClientRect();\n      model.containerSize = [width, height];\n    }\n    return model.containerSize || model.size;\n  };\n  publicAPI.getFramebufferSize = () => {\n    if (model.activeFramebuffer) {\n      return model.activeFramebuffer.getSize();\n    }\n    return model.size;\n  };\n  publicAPI.getPixelData = (x1, y1, x2, y2) => {\n    const pixels = new Uint8Array((x2 - x1 + 1) * (y2 - y1 + 1) * 4);\n    model.context.readPixels(x1, y1, x2 - x1 + 1, y2 - y1 + 1, model.context.RGBA, model.context.UNSIGNED_BYTE, pixels);\n    return pixels;\n  };\n  publicAPI.get3DContext = function () {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      preserveDrawingBuffer: false,\n      depth: true,\n      alpha: true,\n      powerPreference: 'high-performance'\n    };\n    let result = null;\n    const webgl2Supported = typeof WebGL2RenderingContext !== 'undefined';\n    model.webgl2 = false;\n    if (model.defaultToWebgl2 && webgl2Supported) {\n      result = model.canvas.getContext('webgl2', options);\n      if (result) {\n        model.webgl2 = true;\n        vtkDebugMacro('using webgl2');\n      }\n    }\n    if (!result) {\n      vtkDebugMacro('using webgl1');\n      result = model.canvas.getContext('webgl', options) || model.canvas.getContext('experimental-webgl', options);\n    }\n    return new Proxy(result, cachingContextHandler);\n  };\n  publicAPI.restoreContext = () => {\n    const rp = vtkRenderPass.newInstance();\n    rp.setCurrentOperation('Release');\n    rp.traverse(publicAPI, null);\n  };\n  publicAPI.activateTexture = texture => {\n    // Only add if it isn't already there\n    const result = model._textureResourceIds.get(texture);\n    if (result !== undefined) {\n      model.context.activeTexture(model.context.TEXTURE0 + result);\n      return;\n    }\n    const activeUnit = publicAPI.getTextureUnitManager().allocate();\n    if (activeUnit < 0) {\n      vtkErrorMacro('Hardware does not support the number of textures defined.');\n      return;\n    }\n    model._textureResourceIds.set(texture, activeUnit);\n    model.context.activeTexture(model.context.TEXTURE0 + activeUnit);\n  };\n  publicAPI.deactivateTexture = texture => {\n    // Only deactivate if it isn't already there\n    const result = model._textureResourceIds.get(texture);\n    if (result !== undefined) {\n      publicAPI.getTextureUnitManager().free(result);\n      model._textureResourceIds.delete(texture);\n    }\n  };\n  publicAPI.getTextureUnitForTexture = texture => {\n    const result = model._textureResourceIds.get(texture);\n    if (result !== undefined) {\n      return result;\n    }\n    return -1;\n  };\n  publicAPI.getDefaultTextureByteSize = function (vtkType) {\n    let oglNorm16Ext = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    let useHalfFloat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    if (model.webgl2) {\n      switch (vtkType) {\n        case VtkDataTypes.CHAR:\n        case VtkDataTypes.SIGNED_CHAR:\n        case VtkDataTypes.UNSIGNED_CHAR:\n          return 1;\n        case oglNorm16Ext:\n        case useHalfFloat:\n        case VtkDataTypes.UNSIGNED_SHORT:\n        case VtkDataTypes.SHORT:\n        case VtkDataTypes.VOID:\n          // Used for unsigned int depth\n          return 2;\n        default:\n          // For all other cases, assume float\n          return 4;\n      }\n    }\n\n    // webgl1 type support is limited to 1 byte\n    return 1;\n  };\n  publicAPI.getDefaultTextureInternalFormat = function (vtktype, numComps) {\n    let oglNorm16Ext = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    let useHalfFloat = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n    if (model.webgl2) {\n      switch (vtktype) {\n        case VtkDataTypes.UNSIGNED_CHAR:\n          switch (numComps) {\n            case 1:\n              return model.context.R8;\n            case 2:\n              return model.context.RG8;\n            case 3:\n              return model.context.RGB8;\n            case 4:\n            default:\n              return model.context.RGBA8;\n          }\n        case oglNorm16Ext && !useHalfFloat && VtkDataTypes.UNSIGNED_SHORT:\n          switch (numComps) {\n            case 1:\n              return oglNorm16Ext.R16_EXT;\n            case 2:\n              return oglNorm16Ext.RG16_EXT;\n            case 3:\n              return oglNorm16Ext.RGB16_EXT;\n            case 4:\n            default:\n              return oglNorm16Ext.RGBA16_EXT;\n          }\n        // prioritize norm16 over float\n        case oglNorm16Ext && !useHalfFloat && VtkDataTypes.SHORT:\n          switch (numComps) {\n            case 1:\n              return oglNorm16Ext.R16_SNORM_EXT;\n            case 2:\n              return oglNorm16Ext.RG16_SNORM_EXT;\n            case 3:\n              return oglNorm16Ext.RGB16_SNORM_EXT;\n            case 4:\n            default:\n              return oglNorm16Ext.RGBA16_SNORM_EXT;\n          }\n        case VtkDataTypes.FLOAT:\n        default:\n          switch (numComps) {\n            case 1:\n              return model.context.R16F;\n            case 2:\n              return model.context.RG16F;\n            case 3:\n              return model.context.RGB16F;\n            case 4:\n            default:\n              return model.context.RGBA16F;\n          }\n      }\n    }\n\n    // webgl1 only supports four types\n    switch (numComps) {\n      case 1:\n        return model.context.LUMINANCE;\n      case 2:\n        return model.context.LUMINANCE_ALPHA;\n      case 3:\n        return model.context.RGB;\n      case 4:\n      default:\n        return model.context.RGBA;\n    }\n  };\n  publicAPI.setBackgroundImage = img => {\n    model.bgImage.src = img.src;\n  };\n  publicAPI.setUseBackgroundImage = value => {\n    model.useBackgroundImage = value;\n\n    // Add or remove the background image from the\n    // DOM as specified.\n    if (model.useBackgroundImage && !model.el.contains(model.bgImage)) {\n      model.el.appendChild(model.bgImage);\n    } else if (!model.useBackgroundImage && model.el.contains(model.bgImage)) {\n      model.el.removeChild(model.bgImage);\n    }\n  };\n  function getCanvasDataURL() {\n    let format = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : model.imageFormat;\n    // Copy current canvas to not modify the original\n    const temporaryCanvas = document.createElement('canvas');\n    const temporaryContext = temporaryCanvas.getContext('2d');\n    temporaryCanvas.width = model.canvas.width;\n    temporaryCanvas.height = model.canvas.height;\n    temporaryContext.drawImage(model.canvas, 0, 0);\n\n    // Get current client rect to place canvas\n    const mainBoundingClientRect = model.canvas.getBoundingClientRect();\n    const renderWindow = model.renderable;\n    const renderers = renderWindow.getRenderers();\n    renderers.forEach(renderer => {\n      const viewProps = renderer.getViewProps();\n      viewProps.forEach(viewProp => {\n        // Check if the prop has a container that should have canvas\n        if (viewProp.getContainer) {\n          const container = viewProp.getContainer();\n          const canvasList = container.getElementsByTagName('canvas');\n          // Go throughout all canvas and copy it into temporary main canvas\n          for (let i = 0; i < canvasList.length; i++) {\n            const currentCanvas = canvasList[i];\n            const boundingClientRect = currentCanvas.getBoundingClientRect();\n            const newXPosition = boundingClientRect.x - mainBoundingClientRect.x;\n            const newYPosition = boundingClientRect.y - mainBoundingClientRect.y;\n            temporaryContext.drawImage(currentCanvas, newXPosition, newYPosition);\n          }\n        }\n      });\n    });\n    const screenshot = temporaryCanvas.toDataURL(format);\n    temporaryCanvas.remove();\n    publicAPI.invokeImageReady(screenshot);\n  }\n  publicAPI.captureNextImage = function () {\n    let format = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'image/png';\n    let {\n      resetCamera = false,\n      size = null,\n      scale = 1\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    if (model.deleted) {\n      return null;\n    }\n    model.imageFormat = format;\n    const previous = model.notifyStartCaptureImage;\n    model.notifyStartCaptureImage = true;\n    model._screenshot = {\n      size: !!size || scale !== 1 ? size || model.size.map(val => val * scale) : null\n    };\n    return new Promise((resolve, reject) => {\n      const subscription = publicAPI.onImageReady(imageURL => {\n        if (model._screenshot.size === null) {\n          model.notifyStartCaptureImage = previous;\n          subscription.unsubscribe();\n          if (model._screenshot.placeHolder) {\n            // resize the main canvas back to its original size and show it\n            model.size = model._screenshot.originalSize;\n\n            // process the resize\n            publicAPI.modified();\n\n            // restore the saved camera parameters, if applicable\n            if (model._screenshot.cameras) {\n              model._screenshot.cameras.forEach(_ref => {\n                let {\n                  restoreParamsFn,\n                  arg\n                } = _ref;\n                return restoreParamsFn(arg);\n              });\n            }\n\n            // Trigger a render at the original size\n            publicAPI.traverseAllPasses();\n\n            // Remove and clean up the placeholder, revealing the original\n            model.el.removeChild(model._screenshot.placeHolder);\n            model._screenshot.placeHolder.remove();\n            model._screenshot = null;\n          }\n          resolve(imageURL);\n        } else {\n          // Create a placeholder image overlay while we resize and render\n          const tmpImg = document.createElement('img');\n          tmpImg.style = SCREENSHOT_PLACEHOLDER;\n          tmpImg.src = imageURL;\n          model._screenshot.placeHolder = model.el.appendChild(tmpImg);\n\n          // hide the main canvas\n          model.canvas.style.display = 'none';\n\n          // remember the main canvas original size, then resize it\n          model._screenshot.originalSize = model.size;\n          model.size = model._screenshot.size;\n          model._screenshot.size = null;\n\n          // process the resize\n          publicAPI.modified();\n          if (resetCamera) {\n            const isUserResetCamera = resetCamera !== true;\n\n            // If resetCamera was requested, we first save camera parameters\n            // from all the renderers, so we can restore them later\n            model._screenshot.cameras = model.renderable.getRenderers().map(renderer => {\n              const camera = renderer.getActiveCamera();\n              const params = camera.get('focalPoint', 'position', 'parallelScale');\n              return {\n                resetCameraArgs: isUserResetCamera ? {\n                  renderer\n                } : undefined,\n                resetCameraFn: isUserResetCamera ? resetCamera : renderer.resetCamera,\n                restoreParamsFn: camera.set,\n                // \"clone\" the params so we don't keep refs to properties\n                arg: JSON.parse(JSON.stringify(params))\n              };\n            });\n\n            // Perform the resetCamera() on each renderer only after capturing\n            // the params from all active cameras, in case there happen to be\n            // linked cameras among the renderers.\n            model._screenshot.cameras.forEach(_ref2 => {\n              let {\n                resetCameraFn,\n                resetCameraArgs\n              } = _ref2;\n              return resetCameraFn(resetCameraArgs);\n            });\n          }\n\n          // Trigger a render at the custom size\n          publicAPI.traverseAllPasses();\n        }\n      });\n    });\n  };\n  let hardwareMaximumLineWidth;\n  publicAPI.getHardwareMaximumLineWidth = () => {\n    // We cache the result of this function because `getParameter` is slow\n    if (hardwareMaximumLineWidth != null) {\n      return hardwareMaximumLineWidth;\n    }\n    const gl = publicAPI.get3DContext();\n    const lineWidthRange = gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE);\n    hardwareMaximumLineWidth = lineWidthRange[1];\n    return lineWidthRange[1];\n  };\n  publicAPI.getGLInformations = () => {\n    if (model._glInformation) {\n      return model._glInformation;\n    }\n    const gl = publicAPI.get3DContext();\n    const glTextureFloat = gl.getExtension('OES_texture_float');\n    const glTextureHalfFloat = gl.getExtension('OES_texture_half_float');\n    const glDebugRendererInfo = gl.getExtension('WEBGL_debug_renderer_info');\n    const glDrawBuffers = gl.getExtension('WEBGL_draw_buffers');\n    const glAnisotropic = gl.getExtension('EXT_texture_filter_anisotropic') || gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');\n    const params = [['Max Vertex Attributes', 'MAX_VERTEX_ATTRIBS', gl.getParameter(gl.MAX_VERTEX_ATTRIBS)], ['Max Varying Vectors', 'MAX_VARYING_VECTORS', gl.getParameter(gl.MAX_VARYING_VECTORS)], ['Max Vertex Uniform Vectors', 'MAX_VERTEX_UNIFORM_VECTORS', gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS)], ['Max Fragment Uniform Vectors', 'MAX_FRAGMENT_UNIFORM_VECTORS', gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS)], ['Max Fragment Texture Image Units', 'MAX_TEXTURE_IMAGE_UNITS', gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)], ['Max Vertex Texture Image Units', 'MAX_VERTEX_TEXTURE_IMAGE_UNITS', gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)], ['Max Combined Texture Image Units', 'MAX_COMBINED_TEXTURE_IMAGE_UNITS', gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)], ['Max 2D Texture Size', 'MAX_TEXTURE_SIZE', gl.getParameter(gl.MAX_TEXTURE_SIZE)], ['Max Cube Texture Size', 'MAX_CUBE_MAP_TEXTURE_SIZE', gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE)], ['Max Texture Anisotropy', 'MAX_TEXTURE_MAX_ANISOTROPY_EXT', glAnisotropic && gl.getParameter(glAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)], ['Point Size Range', 'ALIASED_POINT_SIZE_RANGE', gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE).join(' - ')], ['Line Width Range', 'ALIASED_LINE_WIDTH_RANGE', gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE).join(' - ')], ['Max Viewport Dimensions', 'MAX_VIEWPORT_DIMS', gl.getParameter(gl.MAX_VIEWPORT_DIMS).join(' - ')], ['Max Renderbuffer Size', 'MAX_RENDERBUFFER_SIZE', gl.getParameter(gl.MAX_RENDERBUFFER_SIZE)], ['Framebuffer Red Bits', 'RED_BITS', gl.getParameter(gl.RED_BITS)], ['Framebuffer Green Bits', 'GREEN_BITS', gl.getParameter(gl.GREEN_BITS)], ['Framebuffer Blue Bits', 'BLUE_BITS', gl.getParameter(gl.BLUE_BITS)], ['Framebuffer Alpha Bits', 'ALPHA_BITS', gl.getParameter(gl.ALPHA_BITS)], ['Framebuffer Depth Bits', 'DEPTH_BITS', gl.getParameter(gl.DEPTH_BITS)], ['Framebuffer Stencil Bits', 'STENCIL_BITS', gl.getParameter(gl.STENCIL_BITS)], ['Framebuffer Subpixel Bits', 'SUBPIXEL_BITS', gl.getParameter(gl.SUBPIXEL_BITS)], ['MSAA Samples', 'SAMPLES', gl.getParameter(gl.SAMPLES)], ['MSAA Sample Buffers', 'SAMPLE_BUFFERS', gl.getParameter(gl.SAMPLE_BUFFERS)], ['Supported Formats for UByte Render Targets     ', 'UNSIGNED_BYTE RENDER TARGET FORMATS', [glTextureFloat && checkRenderTargetSupport(gl, gl.RGBA, gl.UNSIGNED_BYTE) ? 'RGBA' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.RGB, gl.UNSIGNED_BYTE) ? 'RGB' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.LUMINANCE, gl.UNSIGNED_BYTE) ? 'LUMINANCE' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.ALPHA, gl.UNSIGNED_BYTE) ? 'ALPHA' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.LUMINANCE_ALPHA, gl.UNSIGNED_BYTE) ? 'LUMINANCE_ALPHA' : ''].join(' ')], ['Supported Formats for Half Float Render Targets', 'HALF FLOAT RENDER TARGET FORMATS', [glTextureHalfFloat && checkRenderTargetSupport(gl, gl.RGBA, glTextureHalfFloat.HALF_FLOAT_OES) ? 'RGBA' : '', glTextureHalfFloat && checkRenderTargetSupport(gl, gl.RGB, glTextureHalfFloat.HALF_FLOAT_OES) ? 'RGB' : '', glTextureHalfFloat && checkRenderTargetSupport(gl, gl.LUMINANCE, glTextureHalfFloat.HALF_FLOAT_OES) ? 'LUMINANCE' : '', glTextureHalfFloat && checkRenderTargetSupport(gl, gl.ALPHA, glTextureHalfFloat.HALF_FLOAT_OES) ? 'ALPHA' : '', glTextureHalfFloat && checkRenderTargetSupport(gl, gl.LUMINANCE_ALPHA, glTextureHalfFloat.HALF_FLOAT_OES) ? 'LUMINANCE_ALPHA' : ''].join(' ')], ['Supported Formats for Full Float Render Targets', 'FLOAT RENDER TARGET FORMATS', [glTextureFloat && checkRenderTargetSupport(gl, gl.RGBA, gl.FLOAT) ? 'RGBA' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.RGB, gl.FLOAT) ? 'RGB' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.LUMINANCE, gl.FLOAT) ? 'LUMINANCE' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.ALPHA, gl.FLOAT) ? 'ALPHA' : '', glTextureFloat && checkRenderTargetSupport(gl, gl.LUMINANCE_ALPHA, gl.FLOAT) ? 'LUMINANCE_ALPHA' : ''].join(' ')], ['Max Multiple Render Targets Buffers', 'MAX_DRAW_BUFFERS_WEBGL', glDrawBuffers ? gl.getParameter(glDrawBuffers.MAX_DRAW_BUFFERS_WEBGL) : 0], ['High Float Precision in Vertex Shader', 'HIGH_FLOAT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).rangeMax, '</sup>)'].join('')], ['Medium Float Precision in Vertex Shader', 'MEDIUM_FLOAT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).rangeMax, '</sup>)'].join('')], ['Low Float Precision in Vertex Shader', 'LOW_FLOAT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT).rangeMax, '</sup>)'].join('')], ['High Float Precision in Fragment Shader', 'HIGH_FLOAT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).rangeMax, '</sup>)'].join('')], ['Medium Float Precision in Fragment Shader', 'MEDIUM_FLOAT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).rangeMax, '</sup>)'].join('')], ['Low Float Precision in Fragment Shader', 'LOW_FLOAT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT).rangeMax, '</sup>)'].join('')], ['High Int Precision in Vertex Shader', 'HIGH_INT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT).rangeMax, '</sup>)'].join('')], ['Medium Int Precision in Vertex Shader', 'MEDIUM_INT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT).rangeMax, '</sup>)'].join('')], ['Low Int Precision in Vertex Shader', 'LOW_INT VERTEX_SHADER', [gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT).rangeMax, '</sup>)'].join('')], ['High Int Precision in Fragment Shader', 'HIGH_INT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT).rangeMax, '</sup>)'].join('')], ['Medium Int Precision in Fragment Shader', 'MEDIUM_INT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT).rangeMax, '</sup>)'].join('')], ['Low Int Precision in Fragment Shader', 'LOW_INT FRAGMENT_SHADER', [gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT).precision, ' (-2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT).rangeMin, '</sup> - 2<sup>', gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT).rangeMax, '</sup>)'].join('')], ['Supported Extensions', 'EXTENSIONS', gl.getSupportedExtensions().join('<br/>\\t\\t\\t\\t\\t    ')], ['WebGL Renderer', 'RENDERER', gl.getParameter(gl.RENDERER)], ['WebGL Vendor', 'VENDOR', gl.getParameter(gl.VENDOR)], ['WebGL Version', 'VERSION', gl.getParameter(gl.VERSION)], ['Shading Language Version', 'SHADING_LANGUAGE_VERSION', gl.getParameter(gl.SHADING_LANGUAGE_VERSION)], ['Unmasked Renderer', 'UNMASKED_RENDERER', glDebugRendererInfo && gl.getParameter(glDebugRendererInfo.UNMASKED_RENDERER_WEBGL)], ['Unmasked Vendor', 'UNMASKED_VENDOR', glDebugRendererInfo && gl.getParameter(glDebugRendererInfo.UNMASKED_VENDOR_WEBGL)], ['WebGL Version', 'WEBGL_VERSION', model.webgl2 ? 2 : 1]];\n    const result = {};\n    while (params.length) {\n      const [label, key, value] = params.pop();\n      if (key) {\n        result[key] = {\n          label,\n          value\n        };\n      }\n    }\n    model._glInformation = result;\n    return result;\n  };\n  publicAPI.traverseAllPasses = () => {\n    if (model.renderPasses) {\n      for (let index = 0; index < model.renderPasses.length; ++index) {\n        model.renderPasses[index].traverse(publicAPI, null);\n      }\n    }\n    if (model.notifyStartCaptureImage) {\n      getCanvasDataURL();\n    }\n  };\n  publicAPI.disableCullFace = () => {\n    if (model.cullFaceEnabled) {\n      model.context.disable(model.context.CULL_FACE);\n      model.cullFaceEnabled = false;\n    }\n  };\n  publicAPI.enableCullFace = () => {\n    if (!model.cullFaceEnabled) {\n      model.context.enable(model.context.CULL_FACE);\n      model.cullFaceEnabled = true;\n    }\n  };\n  publicAPI.setViewStream = stream => {\n    if (model.viewStream === stream) {\n      return false;\n    }\n    if (model.subscription) {\n      model.subscription.unsubscribe();\n      model.subscription = null;\n    }\n    model.viewStream = stream;\n    if (model.viewStream) {\n      // Force background to be transparent + render\n      const mainRenderer = model.renderable.getRenderers()[0];\n      mainRenderer.getBackgroundByReference()[3] = 0;\n\n      // Enable display of the background image\n      publicAPI.setUseBackgroundImage(true);\n\n      // Bind to remote stream\n      model.subscription = model.viewStream.onImageReady(e => publicAPI.setBackgroundImage(e.image));\n      model.viewStream.setSize(model.size[0], model.size[1]);\n      model.viewStream.invalidateCache();\n      model.viewStream.render();\n      publicAPI.modified();\n    }\n    return true;\n  };\n  publicAPI.createSelector = () => {\n    const ret = vtkHardwareSelector.newInstance();\n    ret.setOpenGLRenderWindow(publicAPI);\n    return ret;\n  };\n  function clearEvents() {\n    model.canvas.removeEventListener('webglcontextlost', _preventDefault);\n    model.canvas.removeEventListener('webglcontextrestored', publicAPI.restoreContext);\n  }\n  publicAPI.delete = macro.chain(clearEvents, publicAPI.delete, publicAPI.setViewStream, deleteGLContext);\n\n  // Do not trigger modified for performance reasons\n  publicAPI.setActiveFramebuffer = newActiveFramebuffer => {\n    model.activeFramebuffer = newActiveFramebuffer;\n  };\n  const superSetSize = publicAPI.setSize;\n  publicAPI.setSize = (width, height) => {\n    const modified = superSetSize(width, height);\n    if (modified) {\n      publicAPI.invokeWindowResizeEvent({\n        width,\n        height\n      });\n    }\n    return modified;\n  };\n  publicAPI.getGraphicsResourceForObject = vtkObj => {\n    if (!vtkObj) {\n      return null;\n    }\n    const vtko = model._graphicsResources.get(vtkObj);\n    const vtkh = model._graphicsResourceHash.get(vtkObj);\n    return {\n      vtkObj: vtko,\n      hash: vtkh\n    };\n  };\n  publicAPI.setGraphicsResourceForObject = (vtkObj, gObj, hash) => {\n    if (!vtkObj) {\n      return;\n    }\n    model._graphicsResources.set(vtkObj, gObj);\n    model._graphicsResourceHash.set(vtkObj, hash);\n  };\n  publicAPI.getGraphicsMemoryInfo = () => {\n    let memUsed = 0;\n    model._graphicsResources.forEach((gObj, vtkObj) => {\n      memUsed += gObj.getAllocatedGPUMemoryInBytes();\n    });\n    return memUsed;\n  };\n  publicAPI.releaseGraphicsResourcesForObject = vtkObj => {\n    if (!vtkObj) {\n      return false;\n    }\n    model._graphicsResources.get(vtkObj)?.releaseGraphicsResources(publicAPI);\n    return model._graphicsResources.delete(vtkObj) && model._graphicsResourceHash.delete(vtkObj);\n  };\n  publicAPI.releaseGraphicsResources = () => {\n    // Clear the shader cache\n    if (model.shaderCache !== null) {\n      model.shaderCache.releaseGraphicsResources(publicAPI);\n    }\n    // Free cached graphics resources at the context level\n    model._graphicsResources.forEach((gObj, vtkObj) => {\n      gObj.releaseGraphicsResources(publicAPI);\n    });\n    model._graphicsResources.clear();\n    model._graphicsResourceHash.clear();\n    if (model.textureUnitManager !== null) {\n      model.textureUnitManager.freeAll();\n    }\n    // Finally, ask the renderers to release prop resources\n    model.renderable.getRenderersByReference().forEach(ren => {\n      const glRen = publicAPI.getViewNodeFor(ren);\n      glRen?.releaseGraphicsResources();\n    });\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {\n  cullFaceEnabled: false,\n  shaderCache: null,\n  initialized: false,\n  context: null,\n  canvas: null,\n  cursorVisibility: true,\n  cursor: 'pointer',\n  textureUnitManager: null,\n  textureResourceIds: null,\n  containerSize: null,\n  renderPasses: [],\n  notifyStartCaptureImage: false,\n  webgl2: false,\n  defaultToWebgl2: true,\n  // attempt webgl2 on by default\n  activeFramebuffer: null,\n  imageFormat: 'image/png',\n  useOffScreen: false,\n  useBackgroundImage: false\n};\n\n// ----------------------------------------------------------------------------\n\nfunction extend(publicAPI, model) {\n  let initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  // Inheritance\n  vtkRenderWindowViewNode.extend(publicAPI, model, initialValues);\n\n  // Create internal instances\n  model.canvas = document.createElement('canvas');\n  model.canvas.style.width = '100%';\n  createGLContext();\n  if (!model.selector) {\n    model.selector = vtkHardwareSelector.newInstance();\n    model.selector.setOpenGLRenderWindow(publicAPI);\n  }\n\n  // Create internal bgImage\n  model.bgImage = new Image();\n  model.bgImage.style.position = 'absolute';\n  model.bgImage.style.left = '0';\n  model.bgImage.style.top = '0';\n  model.bgImage.style.width = '100%';\n  model.bgImage.style.height = '100%';\n  model.bgImage.style.zIndex = '-1';\n  model._textureResourceIds = new Map();\n  model._graphicsResources = new Map();\n  model._graphicsResourceHash = new Map();\n  model._glInformation = null;\n  model.myFactory = vtkViewNodeFactory.newInstance();\n  /* eslint-disable no-use-before-define */\n  model.myFactory.registerOverride('vtkRenderWindow', newInstance);\n  /* eslint-enable no-use-before-define */\n\n  model.shaderCache = vtkShaderCache.newInstance();\n  model.shaderCache.setOpenGLRenderWindow(publicAPI);\n\n  // setup default forward pass rendering\n  model.renderPasses[0] = vtkForwardPass.newInstance();\n  macro.event(publicAPI, model, 'imageReady');\n\n  // Build VTK API\n  macro.get(publicAPI, model, ['shaderCache', 'textureUnitManager', 'webgl2', 'useBackgroundImage', 'activeFramebuffer']);\n  macro.setGet(publicAPI, model, ['initialized', 'context', 'canvas', 'renderPasses', 'notifyStartCaptureImage', 'defaultToWebgl2', 'cursor', 'useOffScreen']);\n  macro.setGetArray(publicAPI, model, ['size'], 2);\n  macro.event(publicAPI, model, 'windowResizeEvent');\n\n  // Object methods\n  vtkOpenGLRenderWindow(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nconst newInstance = macro.newInstance(extend, 'vtkOpenGLRenderWindow');\n\n// ----------------------------------------------------------------------------\n// Register API specific RenderWindow implementation\n// ----------------------------------------------------------------------------\n\nregisterViewConstructor('WebGL', newInstance);\n\n// ----------------------------------------------------------------------------\n\nvar vtkRenderWindow = {\n  newInstance,\n  extend,\n  pushMonitorGLContextCount,\n  popMonitorGLContextCount\n};\n\nexport { vtkRenderWindow as default, extend, newInstance, popMonitorGLContextCount, pushMonitorGLContextCount };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}