{"ast":null,"code":"import { vec3 } from 'gl-matrix';\nimport { Events } from '../../enums';\nimport { getEnabledElement, triggerEvent, eventTarget } from '@cornerstonejs/core';\nimport { AnnotationTool } from '../base';\nimport throttle from '../../utilities/throttle';\nimport { addAnnotation, getAnnotations, removeAnnotation } from '../../stateManagement/annotation/annotationState';\nimport { isAnnotationLocked } from '../../stateManagement/annotation/annotationLocking';\nimport * as lineSegment from '../../utilities/math/line';\nimport angleBetweenLines from '../../utilities/math/angle/angleBetweenLines';\nimport { midPoint2 } from '../../utilities/math/midPoint';\nimport { drawHandles as drawHandlesSvg, drawLine as drawLineSvg, drawLinkedTextBox as drawLinkedTextBoxSvg, drawTextBox as drawTextBoxSvg } from '../../drawingSvg';\nimport { state } from '../../store';\nimport { getViewportIdsWithToolToRender } from '../../utilities/viewportFilters';\nimport { getTextBoxCoordsCanvas } from '../../utilities/drawing';\nimport triggerAnnotationRenderForViewportIds from '../../utilities/triggerAnnotationRenderForViewportIds';\nimport { resetElementCursor, hideElementCursor } from '../../cursors/elementCursor';\nclass CobbAngleTool extends AnnotationTool {\n  constructor(toolProps = {}, defaultToolProps = {\n    supportedInteractionTypes: ['Mouse', 'Touch'],\n    configuration: {\n      shadow: true,\n      preventHandleOutsideImage: false,\n      getTextLines: defaultGetTextLines\n    }\n  }) {\n    super(toolProps, defaultToolProps);\n    this.addNewAnnotation = evt => {\n      if (this.angleStartedNotYetCompleted) {\n        return;\n      }\n      this.angleStartedNotYetCompleted = true;\n      const eventDetail = evt.detail;\n      const {\n        currentPoints,\n        element\n      } = eventDetail;\n      const worldPos = currentPoints.world;\n      const enabledElement = getEnabledElement(element);\n      const {\n        viewport,\n        renderingEngine\n      } = enabledElement;\n      hideElementCursor(element);\n      this.isDrawing = true;\n      const camera = viewport.getCamera();\n      const {\n        viewPlaneNormal,\n        viewUp\n      } = camera;\n      const referencedImageId = this.getReferencedImageId(viewport, worldPos, viewPlaneNormal, viewUp);\n      const FrameOfReferenceUID = viewport.getFrameOfReferenceUID();\n      const annotation = {\n        highlighted: true,\n        invalidated: true,\n        metadata: {\n          toolName: this.getToolName(),\n          viewPlaneNormal: [...viewPlaneNormal],\n          viewUp: [...viewUp],\n          FrameOfReferenceUID,\n          referencedImageId\n        },\n        data: {\n          handles: {\n            points: [[...worldPos], [...worldPos]],\n            activeHandleIndex: null,\n            textBox: {\n              hasMoved: false,\n              worldPosition: [0, 0, 0],\n              worldBoundingBox: {\n                topLeft: [0, 0, 0],\n                topRight: [0, 0, 0],\n                bottomLeft: [0, 0, 0],\n                bottomRight: [0, 0, 0]\n              }\n            }\n          },\n          label: '',\n          cachedStats: {}\n        }\n      };\n      addAnnotation(annotation, element);\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      this.editData = {\n        annotation,\n        viewportIdsToRender,\n        handleIndex: 1,\n        movingTextBox: false,\n        newAnnotation: true,\n        hasMoved: false\n      };\n      this._activateDraw(element);\n      evt.preventDefault();\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      return annotation;\n    };\n    this.isPointNearTool = (element, annotation, canvasCoords, proximity) => {\n      const enabledElement = getEnabledElement(element);\n      const {\n        viewport\n      } = enabledElement;\n      const {\n        data\n      } = annotation;\n      const {\n        distanceToPoint,\n        distanceToPoint2\n      } = this.distanceToLines({\n        viewport,\n        points: data.handles.points,\n        canvasCoords,\n        proximity\n      });\n      if (distanceToPoint <= proximity || distanceToPoint2 <= proximity) {\n        return true;\n      }\n      return false;\n    };\n    this.toolSelectedCallback = (evt, annotation, interactionType, canvasCoords, proximity = 6) => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      annotation.highlighted = true;\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine,\n        viewport\n      } = enabledElement;\n      const {\n        isNearFirstLine,\n        isNearSecondLine\n      } = this.distanceToLines({\n        viewport,\n        points: annotation.data.handles.points,\n        canvasCoords,\n        proximity\n      });\n      this.editData = {\n        annotation,\n        viewportIdsToRender,\n        movingTextBox: false,\n        isNearFirstLine,\n        isNearSecondLine\n      };\n      this._activateModify(element);\n      hideElementCursor(element);\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      evt.preventDefault();\n    };\n    this._mouseUpCallback = evt => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const {\n        annotation,\n        viewportIdsToRender,\n        newAnnotation,\n        hasMoved\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      if (newAnnotation && !hasMoved) {\n        return;\n      }\n      if (this.angleStartedNotYetCompleted && data.handles.points.length < 4) {\n        resetElementCursor(element);\n        this.editData.handleIndex = data.handles.points.length;\n        return;\n      }\n      this.angleStartedNotYetCompleted = false;\n      data.handles.activeHandleIndex = null;\n      this._deactivateModify(element);\n      this._deactivateDraw(element);\n      resetElementCursor(element);\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      if (this.isHandleOutsideImage && this.configuration.preventHandleOutsideImage) {\n        removeAnnotation(annotation.annotationUID);\n      }\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      if (newAnnotation) {\n        const eventType = Events.ANNOTATION_COMPLETED;\n        const eventDetail = {\n          annotation\n        };\n        triggerEvent(eventTarget, eventType, eventDetail);\n      }\n      this.editData = null;\n      this.isDrawing = false;\n    };\n    this._mouseDownCallback = evt => {\n      const {\n        annotation,\n        handleIndex\n      } = this.editData;\n      const eventDetail = evt.detail;\n      const {\n        element,\n        currentPoints\n      } = eventDetail;\n      const worldPos = currentPoints.world;\n      const {\n        data\n      } = annotation;\n      if (handleIndex === 1) {\n        data.handles.points[1] = worldPos;\n        this.editData.hasMoved = data.handles.points[1][0] !== data.handles.points[0][0] || data.handles.points[1][1] !== data.handles.points[0][0];\n        return;\n      }\n      if (handleIndex === 3) {\n        data.handles.points[3] = worldPos;\n        this.editData.hasMoved = data.handles.points[3][0] !== data.handles.points[2][0] || data.handles.points[3][1] !== data.handles.points[2][0];\n        this.angleStartedNotYetCompleted = false;\n        return;\n      }\n      this.editData.hasMoved = false;\n      hideElementCursor(element);\n      data.handles.points[2] = data.handles.points[3] = worldPos;\n      this.editData.handleIndex = data.handles.points.length - 1;\n    };\n    this._mouseDragCallback = evt => {\n      this.isDrawing = true;\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const {\n        annotation,\n        viewportIdsToRender,\n        handleIndex,\n        movingTextBox,\n        isNearFirstLine,\n        isNearSecondLine\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      if (movingTextBox) {\n        const {\n          deltaPoints\n        } = eventDetail;\n        const worldPosDelta = deltaPoints.world;\n        const {\n          textBox\n        } = data.handles;\n        const {\n          worldPosition\n        } = textBox;\n        worldPosition[0] += worldPosDelta[0];\n        worldPosition[1] += worldPosDelta[1];\n        worldPosition[2] += worldPosDelta[2];\n        textBox.hasMoved = true;\n      } else if (handleIndex === undefined && (isNearFirstLine || isNearSecondLine)) {\n        const {\n          deltaPoints\n        } = eventDetail;\n        const worldPosDelta = deltaPoints.world;\n        const points = data.handles.points;\n        if (isNearFirstLine) {\n          const firstLinePoints = [points[0], points[1]];\n          firstLinePoints.forEach(point => {\n            point[0] += worldPosDelta[0];\n            point[1] += worldPosDelta[1];\n            point[2] += worldPosDelta[2];\n          });\n        } else if (isNearSecondLine) {\n          const secondLinePoints = [points[2], points[3]];\n          secondLinePoints.forEach(point => {\n            point[0] += worldPosDelta[0];\n            point[1] += worldPosDelta[1];\n            point[2] += worldPosDelta[2];\n          });\n        }\n        annotation.invalidated = true;\n      } else {\n        const {\n          currentPoints\n        } = eventDetail;\n        const worldPos = currentPoints.world;\n        data.handles.points[handleIndex] = [...worldPos];\n        annotation.invalidated = true;\n      }\n      this.editData.hasMoved = true;\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n    };\n    this.cancel = element => {\n      if (!this.isDrawing) {\n        return;\n      }\n      this.isDrawing = false;\n      this._deactivateDraw(element);\n      this._deactivateModify(element);\n      resetElementCursor(element);\n      const {\n        annotation,\n        viewportIdsToRender,\n        newAnnotation\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      if (data.handles.points.length < 4) {\n        removeAnnotation(annotation.annotationUID);\n      }\n      annotation.highlighted = false;\n      data.handles.activeHandleIndex = null;\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      if (newAnnotation) {\n        const eventType = Events.ANNOTATION_COMPLETED;\n        const eventDetail = {\n          annotation\n        };\n        triggerEvent(eventTarget, eventType, eventDetail);\n      }\n      this.editData = null;\n      this.angleStartedNotYetCompleted = false;\n      return annotation.annotationUID;\n    };\n    this._activateModify = element => {\n      state.isInteractingWithTool = true;\n      element.addEventListener(Events.MOUSE_UP, this._mouseUpCallback);\n      element.addEventListener(Events.MOUSE_DRAG, this._mouseDragCallback);\n      element.addEventListener(Events.MOUSE_CLICK, this._mouseUpCallback);\n    };\n    this._deactivateModify = element => {\n      state.isInteractingWithTool = false;\n      element.removeEventListener(Events.MOUSE_UP, this._mouseUpCallback);\n      element.removeEventListener(Events.MOUSE_DRAG, this._mouseDragCallback);\n      element.removeEventListener(Events.MOUSE_CLICK, this._mouseUpCallback);\n    };\n    this._activateDraw = element => {\n      state.isInteractingWithTool = true;\n      element.addEventListener(Events.MOUSE_UP, this._mouseUpCallback);\n      element.addEventListener(Events.MOUSE_DRAG, this._mouseDragCallback);\n      element.addEventListener(Events.MOUSE_MOVE, this._mouseDragCallback);\n      element.addEventListener(Events.MOUSE_CLICK, this._mouseUpCallback);\n      element.addEventListener(Events.MOUSE_DOWN, this._mouseDownCallback);\n    };\n    this._deactivateDraw = element => {\n      state.isInteractingWithTool = false;\n      element.removeEventListener(Events.MOUSE_UP, this._mouseUpCallback);\n      element.removeEventListener(Events.MOUSE_DRAG, this._mouseDragCallback);\n      element.removeEventListener(Events.MOUSE_MOVE, this._mouseDragCallback);\n      element.removeEventListener(Events.MOUSE_CLICK, this._mouseUpCallback);\n      element.removeEventListener(Events.MOUSE_DOWN, this._mouseDownCallback);\n    };\n    this.renderAnnotation = (enabledElement, svgDrawingHelper) => {\n      let renderStatus = false;\n      const {\n        viewport\n      } = enabledElement;\n      const {\n        element\n      } = viewport;\n      let annotations = getAnnotations(this.getToolName(), element);\n      if (!annotations?.length) {\n        return renderStatus;\n      }\n      annotations = this.filterInteractableAnnotationsForElement(element, annotations);\n      if (!annotations?.length) {\n        return renderStatus;\n      }\n      const targetId = this.getTargetId(viewport);\n      const renderingEngine = viewport.getRenderingEngine();\n      const styleSpecifier = {\n        toolGroupId: this.toolGroupId,\n        toolName: this.getToolName(),\n        viewportId: enabledElement.viewport.id\n      };\n      for (let i = 0; i < annotations.length; i++) {\n        const annotation = annotations[i];\n        const {\n          annotationUID,\n          data\n        } = annotation;\n        const {\n          points,\n          activeHandleIndex\n        } = data.handles;\n        styleSpecifier.annotationUID = annotationUID;\n        const {\n          color,\n          lineWidth,\n          lineDash\n        } = this.getAnnotationStyle({\n          annotation,\n          styleSpecifier\n        });\n        const canvasCoordinates = points.map(p => viewport.worldToCanvas(p));\n        if (!data.cachedStats[targetId] || data.cachedStats[targetId].angle == null) {\n          data.cachedStats[targetId] = {\n            angle: null,\n            arc1Angle: null,\n            arc2Angle: null,\n            points: {\n              world: {\n                arc1Start: null,\n                arc1End: null,\n                arc2Start: null,\n                arc2End: null,\n                arc1Angle: null,\n                arc2Angle: null\n              },\n              canvas: {\n                arc1Start: null,\n                arc1End: null,\n                arc2Start: null,\n                arc2End: null,\n                arc1Angle: null,\n                arc2Angle: null\n              }\n            }\n          };\n          this._calculateCachedStats(annotation, renderingEngine, enabledElement);\n        } else if (annotation.invalidated) {\n          this._throttledCalculateCachedStats(annotation, renderingEngine, enabledElement);\n        }\n        let activeHandleCanvasCoords;\n        if (!isAnnotationLocked(annotation) && !this.editData && activeHandleIndex !== null) {\n          activeHandleCanvasCoords = [canvasCoordinates[activeHandleIndex]];\n        }\n        if (!viewport.getRenderingEngine()) {\n          console.warn('Rendering Engine has been destroyed');\n          return renderStatus;\n        }\n        if (activeHandleCanvasCoords) {\n          const handleGroupUID = '0';\n          drawHandlesSvg(svgDrawingHelper, annotationUID, handleGroupUID, canvasCoordinates, {\n            color,\n            lineDash,\n            lineWidth\n          });\n        }\n        const firstLine = [canvasCoordinates[0], canvasCoordinates[1]];\n        const secondLine = [canvasCoordinates[2], canvasCoordinates[3]];\n        let lineUID = 'line1';\n        drawLineSvg(svgDrawingHelper, annotationUID, lineUID, firstLine[0], firstLine[1], {\n          color,\n          width: lineWidth,\n          lineDash\n        });\n        renderStatus = true;\n        if (canvasCoordinates.length < 4) {\n          return renderStatus;\n        }\n        lineUID = 'line2';\n        drawLineSvg(svgDrawingHelper, annotationUID, lineUID, secondLine[0], secondLine[1], {\n          color,\n          width: lineWidth,\n          lineDash\n        });\n        lineUID = 'linkLine';\n        const mid1 = midPoint2(firstLine[0], firstLine[1]);\n        const mid2 = midPoint2(secondLine[0], secondLine[1]);\n        drawLineSvg(svgDrawingHelper, annotationUID, lineUID, mid1, mid2, {\n          color,\n          lineWidth: '1',\n          lineDash: '1,4'\n        });\n        const {\n          arc1Start,\n          arc1End,\n          arc2End,\n          arc2Start\n        } = data.cachedStats[targetId].points.canvas;\n        const {\n          arc1Angle,\n          arc2Angle\n        } = data.cachedStats[targetId];\n        lineUID = 'arc1';\n        drawLineSvg(svgDrawingHelper, annotationUID, lineUID, arc1Start, arc1End, {\n          color,\n          lineWidth: '1'\n        });\n        lineUID = 'arc2';\n        drawLineSvg(svgDrawingHelper, annotationUID, lineUID, arc2Start, arc2End, {\n          color,\n          lineWidth: '1'\n        });\n        if (!data.cachedStats[targetId]?.angle) {\n          continue;\n        }\n        const options = this.getLinkedTextBoxStyle(styleSpecifier, annotation);\n        if (!options.visibility) {\n          data.handles.textBox = {\n            hasMoved: false,\n            worldPosition: [0, 0, 0],\n            worldBoundingBox: {\n              topLeft: [0, 0, 0],\n              topRight: [0, 0, 0],\n              bottomLeft: [0, 0, 0],\n              bottomRight: [0, 0, 0]\n            }\n          };\n          continue;\n        }\n        const textLines = this.configuration.getTextLines(data, targetId);\n        if (!data.handles.textBox.hasMoved) {\n          const canvasTextBoxCoords = getTextBoxCoordsCanvas(canvasCoordinates);\n          data.handles.textBox.worldPosition = viewport.canvasToWorld(canvasTextBoxCoords);\n        }\n        const textBoxPosition = viewport.worldToCanvas(data.handles.textBox.worldPosition);\n        const textBoxUID = 'cobbAngleText';\n        const boundingBox = drawLinkedTextBoxSvg(svgDrawingHelper, annotationUID, textBoxUID, textLines, textBoxPosition, canvasCoordinates, {}, options);\n        const {\n          x: left,\n          y: top,\n          width,\n          height\n        } = boundingBox;\n        data.handles.textBox.worldBoundingBox = {\n          topLeft: viewport.canvasToWorld([left, top]),\n          topRight: viewport.canvasToWorld([left + width, top]),\n          bottomLeft: viewport.canvasToWorld([left, top + height]),\n          bottomRight: viewport.canvasToWorld([left + width, top + height])\n        };\n        const arc1TextBoxUID = 'arcAngle1';\n        const arc1TextLine = [`${arc1Angle.toFixed(2)} ${String.fromCharCode(176)}`];\n        const arch1TextPosCanvas = midPoint2(arc1Start, arc1End);\n        drawTextBoxSvg(svgDrawingHelper, annotationUID, arc1TextBoxUID, arc1TextLine, arch1TextPosCanvas, {\n          ...options,\n          padding: 3\n        });\n        const arc2TextBoxUID = 'arcAngle2';\n        const arc2TextLine = [`${arc2Angle.toFixed(2)} ${String.fromCharCode(176)}`];\n        const arch2TextPosCanvas = midPoint2(arc2Start, arc2End);\n        drawTextBoxSvg(svgDrawingHelper, annotationUID, arc2TextBoxUID, arc2TextLine, arch2TextPosCanvas, {\n          ...options,\n          padding: 3\n        });\n      }\n      return renderStatus;\n    };\n    this.distanceToLines = ({\n      viewport,\n      points,\n      canvasCoords,\n      proximity\n    }) => {\n      const [point1, point2, point3, point4] = points;\n      const canvasPoint1 = viewport.worldToCanvas(point1);\n      const canvasPoint2 = viewport.worldToCanvas(point2);\n      const canvasPoint3 = viewport.worldToCanvas(point3);\n      const canvasPoint4 = viewport.worldToCanvas(point4);\n      const line1 = {\n        start: {\n          x: canvasPoint1[0],\n          y: canvasPoint1[1]\n        },\n        end: {\n          x: canvasPoint2[0],\n          y: canvasPoint2[1]\n        }\n      };\n      const line2 = {\n        start: {\n          x: canvasPoint3[0],\n          y: canvasPoint3[1]\n        },\n        end: {\n          x: canvasPoint4[0],\n          y: canvasPoint4[1]\n        }\n      };\n      const distanceToPoint = lineSegment.distanceToPoint([line1.start.x, line1.start.y], [line1.end.x, line1.end.y], [canvasCoords[0], canvasCoords[1]]);\n      const distanceToPoint2 = lineSegment.distanceToPoint([line2.start.x, line2.start.y], [line2.end.x, line2.end.y], [canvasCoords[0], canvasCoords[1]]);\n      let isNearFirstLine = false;\n      let isNearSecondLine = false;\n      if (distanceToPoint <= proximity) {\n        isNearFirstLine = true;\n      } else if (distanceToPoint2 <= proximity) {\n        isNearSecondLine = true;\n      }\n      return {\n        distanceToPoint,\n        distanceToPoint2,\n        isNearFirstLine,\n        isNearSecondLine\n      };\n    };\n    this.getArcsStartEndPoints = ({\n      firstLine,\n      secondLine,\n      mid1,\n      mid2\n    }) => {\n      const linkLine = [mid1, mid2];\n      const arc1Angle = angleBetweenLines(firstLine, linkLine);\n      const arc2Angle = angleBetweenLines(secondLine, linkLine);\n      const arc1Side = arc1Angle > 90 ? 1 : 0;\n      const arc2Side = arc2Angle > 90 ? 0 : 1;\n      const midLinkLine = midPoint2(linkLine[0], linkLine[1]);\n      const linkLineLength = Math.sqrt((linkLine[1][0] - linkLine[0][0]) ** 2 + (linkLine[1][1] - linkLine[0][1]) ** 2);\n      const ratio = 0.1;\n      const midFirstLine = midPoint2(firstLine[0], firstLine[1]);\n      const midSecondLine = midPoint2(secondLine[0], secondLine[1]);\n      const directionVectorStartArc1 = [firstLine[arc1Side][0] - midFirstLine[0], firstLine[arc1Side][1] - midFirstLine[1]];\n      const magnitudeStartArc1 = Math.sqrt(directionVectorStartArc1[0] ** 2 + directionVectorStartArc1[1] ** 2);\n      const normalizedDirectionStartArc1 = [directionVectorStartArc1[0] / magnitudeStartArc1, directionVectorStartArc1[1] / magnitudeStartArc1];\n      const arc1Start = [midFirstLine[0] + normalizedDirectionStartArc1[0] * linkLineLength * ratio, midFirstLine[1] + normalizedDirectionStartArc1[1] * linkLineLength * ratio];\n      const directionVectorEndArc1 = [midLinkLine[0] - mid1[0], midLinkLine[1] - mid1[1]];\n      const magnitudeEndArc1 = Math.sqrt(directionVectorEndArc1[0] ** 2 + directionVectorEndArc1[1] ** 2);\n      const normalizedDirectionEndArc1 = [directionVectorEndArc1[0] / magnitudeEndArc1, directionVectorEndArc1[1] / magnitudeEndArc1];\n      const arc1End = [mid1[0] + normalizedDirectionEndArc1[0] * linkLineLength * ratio, mid1[1] + normalizedDirectionEndArc1[1] * linkLineLength * ratio];\n      const directionVectorStartArc2 = [secondLine[arc2Side][0] - midSecondLine[0], secondLine[arc2Side][1] - midSecondLine[1]];\n      const magnitudeStartArc2 = Math.sqrt(directionVectorStartArc2[0] ** 2 + directionVectorStartArc2[1] ** 2);\n      const normalizedDirectionStartArc2 = [directionVectorStartArc2[0] / magnitudeStartArc2, directionVectorStartArc2[1] / magnitudeStartArc2];\n      const arc2Start = [midSecondLine[0] + normalizedDirectionStartArc2[0] * linkLineLength * ratio, midSecondLine[1] + normalizedDirectionStartArc2[1] * linkLineLength * ratio];\n      const directionVectorEndArc2 = [midLinkLine[0] - mid2[0], midLinkLine[1] - mid2[1]];\n      const magnitudeEndArc2 = Math.sqrt(directionVectorEndArc2[0] ** 2 + directionVectorEndArc2[1] ** 2);\n      const normalizedDirectionEndArc2 = [directionVectorEndArc2[0] / magnitudeEndArc2, directionVectorEndArc2[1] / magnitudeEndArc2];\n      const arc2End = [mid2[0] + normalizedDirectionEndArc2[0] * linkLineLength * ratio, mid2[1] + normalizedDirectionEndArc2[1] * linkLineLength * ratio];\n      return {\n        arc1Start,\n        arc1End,\n        arc2Start,\n        arc2End,\n        arc1Angle: arc1Angle > 90 ? 180 - arc1Angle : arc1Angle,\n        arc2Angle: arc2Angle > 90 ? 180 - arc2Angle : arc2Angle\n      };\n    };\n    this._throttledCalculateCachedStats = throttle(this._calculateCachedStats, 25, {\n      trailing: true\n    });\n  }\n  handleSelectedCallback(evt, annotation, handle, interactionType = 'mouse') {\n    const eventDetail = evt.detail;\n    const {\n      element\n    } = eventDetail;\n    const {\n      data\n    } = annotation;\n    annotation.highlighted = true;\n    let movingTextBox = false;\n    let handleIndex;\n    if (handle.worldPosition) {\n      movingTextBox = true;\n    } else {\n      handleIndex = data.handles.points.findIndex(p => p === handle);\n    }\n    const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n    this.editData = {\n      annotation,\n      viewportIdsToRender,\n      handleIndex,\n      movingTextBox\n    };\n    this._activateModify(element);\n    hideElementCursor(element);\n    const enabledElement = getEnabledElement(element);\n    const {\n      renderingEngine\n    } = enabledElement;\n    triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n    evt.preventDefault();\n  }\n  _calculateCachedStats(annotation, renderingEngine, enabledElement) {\n    const data = annotation.data;\n    const {\n      viewportId,\n      renderingEngineId\n    } = enabledElement;\n    if (data.handles.points.length !== 4) {\n      return;\n    }\n    const seg1 = [null, null];\n    const seg2 = [null, null];\n    let minDist = Number.MAX_VALUE;\n    for (let i = 0; i < 2; i += 1) {\n      for (let j = 2; j < 4; j += 1) {\n        const dist = vec3.distance(data.handles.points[i], data.handles.points[j]);\n        if (dist < minDist) {\n          minDist = dist;\n          seg1[1] = data.handles.points[i];\n          seg1[0] = data.handles.points[(i + 1) % 2];\n          seg2[0] = data.handles.points[j];\n          seg2[1] = data.handles.points[2 + (j - 1) % 2];\n        }\n      }\n    }\n    const {\n      viewport\n    } = enabledElement;\n    const canvasPoints = data.handles.points.map(p => viewport.worldToCanvas(p));\n    const firstLine = [canvasPoints[0], canvasPoints[1]];\n    const secondLine = [canvasPoints[2], canvasPoints[3]];\n    const mid1 = midPoint2(firstLine[0], firstLine[1]);\n    const mid2 = midPoint2(secondLine[0], secondLine[1]);\n    const {\n      arc1Start,\n      arc1End,\n      arc2End,\n      arc2Start,\n      arc1Angle,\n      arc2Angle\n    } = this.getArcsStartEndPoints({\n      firstLine,\n      secondLine,\n      mid1,\n      mid2\n    });\n    const {\n      cachedStats\n    } = data;\n    const targetIds = Object.keys(cachedStats);\n    for (let i = 0; i < targetIds.length; i++) {\n      const targetId = targetIds[i];\n      cachedStats[targetId] = {\n        angle: angleBetweenLines(seg1, seg2),\n        arc1Angle,\n        arc2Angle,\n        points: {\n          canvas: {\n            arc1Start,\n            arc1End,\n            arc2End,\n            arc2Start\n          },\n          world: {\n            arc1Start: viewport.canvasToWorld(arc1Start),\n            arc1End: viewport.canvasToWorld(arc1End),\n            arc2End: viewport.canvasToWorld(arc2End),\n            arc2Start: viewport.canvasToWorld(arc2Start)\n          }\n        }\n      };\n    }\n    annotation.invalidated = false;\n    const eventType = Events.ANNOTATION_MODIFIED;\n    const eventDetail = {\n      annotation,\n      viewportId,\n      renderingEngineId\n    };\n    triggerEvent(eventTarget, eventType, eventDetail);\n    return cachedStats;\n  }\n}\nfunction defaultGetTextLines(data, targetId) {\n  const cachedVolumeStats = data.cachedStats[targetId];\n  const {\n    angle\n  } = cachedVolumeStats;\n  if (angle === undefined) {\n    return;\n  }\n  const textLines = [`${angle.toFixed(2)} ${String.fromCharCode(176)}`];\n  return textLines;\n}\nCobbAngleTool.toolName = 'CobbAngle';\nexport default CobbAngleTool;","map":{"version":3,"names":["vec3","Events","getEnabledElement","triggerEvent","eventTarget","AnnotationTool","throttle","addAnnotation","getAnnotations","removeAnnotation","isAnnotationLocked","lineSegment","angleBetweenLines","midPoint2","drawHandles","drawHandlesSvg","drawLine","drawLineSvg","drawLinkedTextBox","drawLinkedTextBoxSvg","drawTextBox","drawTextBoxSvg","state","getViewportIdsWithToolToRender","getTextBoxCoordsCanvas","triggerAnnotationRenderForViewportIds","resetElementCursor","hideElementCursor","CobbAngleTool","constructor","toolProps","defaultToolProps","supportedInteractionTypes","configuration","shadow","preventHandleOutsideImage","getTextLines","defaultGetTextLines","addNewAnnotation","evt","angleStartedNotYetCompleted","eventDetail","detail","currentPoints","element","worldPos","world","enabledElement","viewport","renderingEngine","isDrawing","camera","getCamera","viewPlaneNormal","viewUp","referencedImageId","getReferencedImageId","FrameOfReferenceUID","getFrameOfReferenceUID","annotation","highlighted","invalidated","metadata","toolName","getToolName","data","handles","points","activeHandleIndex","textBox","hasMoved","worldPosition","worldBoundingBox","topLeft","topRight","bottomLeft","bottomRight","label","cachedStats","viewportIdsToRender","editData","handleIndex","movingTextBox","newAnnotation","_activateDraw","preventDefault","isPointNearTool","canvasCoords","proximity","distanceToPoint","distanceToPoint2","distanceToLines","toolSelectedCallback","interactionType","isNearFirstLine","isNearSecondLine","_activateModify","_mouseUpCallback","length","_deactivateModify","_deactivateDraw","isHandleOutsideImage","annotationUID","eventType","ANNOTATION_COMPLETED","_mouseDownCallback","_mouseDragCallback","deltaPoints","worldPosDelta","undefined","firstLinePoints","forEach","point","secondLinePoints","cancel","isInteractingWithTool","addEventListener","MOUSE_UP","MOUSE_DRAG","MOUSE_CLICK","removeEventListener","MOUSE_MOVE","MOUSE_DOWN","renderAnnotation","svgDrawingHelper","renderStatus","annotations","filterInteractableAnnotationsForElement","targetId","getTargetId","getRenderingEngine","styleSpecifier","toolGroupId","viewportId","id","i","color","lineWidth","lineDash","getAnnotationStyle","canvasCoordinates","map","p","worldToCanvas","angle","arc1Angle","arc2Angle","arc1Start","arc1End","arc2Start","arc2End","canvas","_calculateCachedStats","_throttledCalculateCachedStats","activeHandleCanvasCoords","console","warn","handleGroupUID","firstLine","secondLine","lineUID","width","mid1","mid2","options","getLinkedTextBoxStyle","visibility","textLines","canvasTextBoxCoords","canvasToWorld","textBoxPosition","textBoxUID","boundingBox","x","left","y","top","height","arc1TextBoxUID","arc1TextLine","toFixed","String","fromCharCode","arch1TextPosCanvas","padding","arc2TextBoxUID","arc2TextLine","arch2TextPosCanvas","point1","point2","point3","point4","canvasPoint1","canvasPoint2","canvasPoint3","canvasPoint4","line1","start","end","line2","getArcsStartEndPoints","linkLine","arc1Side","arc2Side","midLinkLine","linkLineLength","Math","sqrt","ratio","midFirstLine","midSecondLine","directionVectorStartArc1","magnitudeStartArc1","normalizedDirectionStartArc1","directionVectorEndArc1","magnitudeEndArc1","normalizedDirectionEndArc1","directionVectorStartArc2","magnitudeStartArc2","normalizedDirectionStartArc2","directionVectorEndArc2","magnitudeEndArc2","normalizedDirectionEndArc2","trailing","handleSelectedCallback","handle","findIndex","renderingEngineId","seg1","seg2","minDist","Number","MAX_VALUE","j","dist","distance","canvasPoints","targetIds","Object","keys","ANNOTATION_MODIFIED","cachedVolumeStats"],"sources":["../../../../src/tools/annotation/CobbAngleTool.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}