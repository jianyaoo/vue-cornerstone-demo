{"ast":null,"code":"import { vec2, vec3 } from 'gl-matrix';\nimport { getEnabledElement, triggerEvent, eventTarget, utilities as csUtils } from '@cornerstonejs/core';\nimport { getCalibratedLengthUnits, getCalibratedScale } from '../../utilities/getCalibratedUnits';\nimport { roundNumber } from '../../utilities';\nimport { AnnotationTool } from '../base';\nimport throttle from '../../utilities/throttle';\nimport { addAnnotation, getAnnotations, removeAnnotation } from '../../stateManagement/annotation/annotationState';\nimport { isAnnotationLocked } from '../../stateManagement/annotation/annotationLocking';\nimport { isAnnotationVisible } from '../../stateManagement/annotation/annotationVisibility';\nimport { drawLine as drawLineSvg, drawHandles as drawHandlesSvg, drawLinkedTextBox as drawLinkedTextBoxSvg } from '../../drawingSvg';\nimport { state } from '../../store';\nimport { Events } from '../../enums';\nimport { getViewportIdsWithToolToRender } from '../../utilities/viewportFilters';\nimport * as lineSegment from '../../utilities/math/line';\nimport { getTextBoxCoordsCanvas } from '../../utilities/drawing';\nimport { resetElementCursor, hideElementCursor } from '../../cursors/elementCursor';\nimport triggerAnnotationRenderForViewportIds from '../../utilities/triggerAnnotationRenderForViewportIds';\nconst {\n  transformWorldToIndex\n} = csUtils;\nclass BidirectionalTool extends AnnotationTool {\n  constructor(toolProps = {}, defaultToolProps = {\n    supportedInteractionTypes: ['Mouse', 'Touch'],\n    configuration: {\n      preventHandleOutsideImage: false,\n      getTextLines: defaultGetTextLines\n    }\n  }) {\n    super(toolProps, defaultToolProps);\n    this.isPointNearTool = (element, annotation, canvasCoords, proximity) => {\n      const enabledElement = getEnabledElement(element);\n      const {\n        viewport\n      } = enabledElement;\n      const {\n        data\n      } = annotation;\n      const {\n        points\n      } = data.handles;\n      let canvasPoint1 = viewport.worldToCanvas(points[0]);\n      let canvasPoint2 = viewport.worldToCanvas(points[1]);\n      let line = {\n        start: {\n          x: canvasPoint1[0],\n          y: canvasPoint1[1]\n        },\n        end: {\n          x: canvasPoint2[0],\n          y: canvasPoint2[1]\n        }\n      };\n      let distanceToPoint = lineSegment.distanceToPoint([line.start.x, line.start.y], [line.end.x, line.end.y], [canvasCoords[0], canvasCoords[1]]);\n      if (distanceToPoint <= proximity) {\n        return true;\n      }\n      canvasPoint1 = viewport.worldToCanvas(points[2]);\n      canvasPoint2 = viewport.worldToCanvas(points[3]);\n      line = {\n        start: {\n          x: canvasPoint1[0],\n          y: canvasPoint1[1]\n        },\n        end: {\n          x: canvasPoint2[0],\n          y: canvasPoint2[1]\n        }\n      };\n      distanceToPoint = lineSegment.distanceToPoint([line.start.x, line.start.y], [line.end.x, line.end.y], [canvasCoords[0], canvasCoords[1]]);\n      if (distanceToPoint <= proximity) {\n        return true;\n      }\n      return false;\n    };\n    this.toolSelectedCallback = (evt, annotation) => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      annotation.highlighted = true;\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      this.editData = {\n        annotation,\n        viewportIdsToRender,\n        movingTextBox: false\n      };\n      this._activateModify(element);\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      hideElementCursor(element);\n      evt.preventDefault();\n    };\n    this.handleSelectedCallback = (evt, annotation, handle) => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const data = annotation.data;\n      annotation.highlighted = true;\n      let movingTextBox = false;\n      let handleIndex;\n      if (handle.worldPosition) {\n        movingTextBox = true;\n      } else {\n        handleIndex = data.handles.points.findIndex(p => p === handle);\n      }\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      hideElementCursor(element);\n      this.editData = {\n        annotation,\n        viewportIdsToRender,\n        handleIndex,\n        movingTextBox\n      };\n      this._activateModify(element);\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      evt.preventDefault();\n    };\n    this._endCallback = evt => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const {\n        annotation,\n        viewportIdsToRender,\n        newAnnotation,\n        hasMoved\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      if (newAnnotation && !hasMoved) {\n        return;\n      }\n      data.handles.activeHandleIndex = null;\n      this._deactivateModify(element);\n      this._deactivateDraw(element);\n      resetElementCursor(element);\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      if (this.editData.handleIndex !== undefined) {\n        const {\n          points\n        } = data.handles;\n        const firstLineSegmentLength = vec3.distance(points[0], points[1]);\n        const secondLineSegmentLength = vec3.distance(points[2], points[3]);\n        if (secondLineSegmentLength > firstLineSegmentLength) {\n          const longAxis = [[...points[2]], [...points[3]]];\n          const shortAxisPoint0 = [...points[0]];\n          const shortAxisPoint1 = [...points[1]];\n          const longAxisVector = vec2.create();\n          vec2.set(longAxisVector, longAxis[1][0] - longAxis[0][0], longAxis[1][1] - longAxis[1][0]);\n          const counterClockWisePerpendicularToLongAxis = vec2.create();\n          vec2.set(counterClockWisePerpendicularToLongAxis, -longAxisVector[1], longAxisVector[0]);\n          const currentShortAxisVector = vec2.create();\n          vec2.set(currentShortAxisVector, shortAxisPoint1[0] - shortAxisPoint0[0], shortAxisPoint1[1] - shortAxisPoint0[0]);\n          let shortAxis;\n          if (vec2.dot(currentShortAxisVector, counterClockWisePerpendicularToLongAxis) > 0) {\n            shortAxis = [shortAxisPoint0, shortAxisPoint1];\n          } else {\n            shortAxis = [shortAxisPoint1, shortAxisPoint0];\n          }\n          data.handles.points = [longAxis[0], longAxis[1], shortAxis[0], shortAxis[1]];\n        }\n      }\n      if (this.isHandleOutsideImage && this.configuration.preventHandleOutsideImage) {\n        removeAnnotation(annotation.annotationUID);\n      }\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      if (newAnnotation) {\n        const eventType = Events.ANNOTATION_COMPLETED;\n        const eventDetail = {\n          annotation\n        };\n        triggerEvent(eventTarget, eventType, eventDetail);\n      }\n      this.editData = null;\n      this.isDrawing = false;\n    };\n    this._dragDrawCallback = evt => {\n      this.isDrawing = true;\n      const eventDetail = evt.detail;\n      const {\n        currentPoints,\n        element\n      } = eventDetail;\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine,\n        viewport\n      } = enabledElement;\n      const {\n        worldToCanvas\n      } = viewport;\n      const {\n        annotation,\n        viewportIdsToRender,\n        handleIndex\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      const worldPos = currentPoints.world;\n      data.handles.points[handleIndex] = [...worldPos];\n      const canvasCoordPoints = data.handles.points.map(worldToCanvas);\n      const canvasCoords = {\n        longLineSegment: {\n          start: {\n            x: canvasCoordPoints[0][0],\n            y: canvasCoordPoints[0][1]\n          },\n          end: {\n            x: canvasCoordPoints[1][0],\n            y: canvasCoordPoints[1][1]\n          }\n        },\n        shortLineSegment: {\n          start: {\n            x: canvasCoordPoints[2][0],\n            y: canvasCoordPoints[2][1]\n          },\n          end: {\n            x: canvasCoordPoints[3][0],\n            y: canvasCoordPoints[3][1]\n          }\n        }\n      };\n      const dist = vec2.distance(canvasCoordPoints[0], canvasCoordPoints[1]);\n      const shortAxisDistFromCenter = dist / 3;\n      const dx = canvasCoords.longLineSegment.start.x - canvasCoords.longLineSegment.end.x;\n      const dy = canvasCoords.longLineSegment.start.y - canvasCoords.longLineSegment.end.y;\n      const length = Math.sqrt(dx * dx + dy * dy);\n      const vectorX = dx / length;\n      const vectorY = dy / length;\n      const xMid = (canvasCoords.longLineSegment.start.x + canvasCoords.longLineSegment.end.x) / 2;\n      const yMid = (canvasCoords.longLineSegment.start.y + canvasCoords.longLineSegment.end.y) / 2;\n      const startX = xMid + shortAxisDistFromCenter * vectorY;\n      const startY = yMid - shortAxisDistFromCenter * vectorX;\n      const endX = xMid - shortAxisDistFromCenter * vectorY;\n      const endY = yMid + shortAxisDistFromCenter * vectorX;\n      data.handles.points[2] = viewport.canvasToWorld([startX, startY]);\n      data.handles.points[3] = viewport.canvasToWorld([endX, endY]);\n      annotation.invalidated = true;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      this.editData.hasMoved = true;\n    };\n    this._dragModifyCallback = evt => {\n      this.isDrawing = true;\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      const {\n        annotation,\n        viewportIdsToRender,\n        handleIndex,\n        movingTextBox\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      if (movingTextBox) {\n        const {\n          deltaPoints\n        } = eventDetail;\n        const worldPosDelta = deltaPoints.world;\n        const {\n          textBox\n        } = data.handles;\n        const {\n          worldPosition\n        } = textBox;\n        worldPosition[0] += worldPosDelta[0];\n        worldPosition[1] += worldPosDelta[1];\n        worldPosition[2] += worldPosDelta[2];\n        textBox.hasMoved = true;\n      } else if (handleIndex === undefined) {\n        const {\n          deltaPoints\n        } = eventDetail;\n        const worldPosDelta = deltaPoints.world;\n        const points = data.handles.points;\n        points.forEach(point => {\n          point[0] += worldPosDelta[0];\n          point[1] += worldPosDelta[1];\n          point[2] += worldPosDelta[2];\n        });\n        annotation.invalidated = true;\n      } else {\n        this._dragModifyHandle(evt);\n        annotation.invalidated = true;\n      }\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n    };\n    this._dragModifyHandle = evt => {\n      const eventDetail = evt.detail;\n      const {\n        currentPoints,\n        element\n      } = eventDetail;\n      const enabledElement = getEnabledElement(element);\n      const {\n        viewport\n      } = enabledElement;\n      const {\n        annotation,\n        handleIndex: movingHandleIndex\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      const worldPos = currentPoints.world;\n      const canvasCoordHandlesCurrent = [viewport.worldToCanvas(data.handles.points[0]), viewport.worldToCanvas(data.handles.points[1]), viewport.worldToCanvas(data.handles.points[2]), viewport.worldToCanvas(data.handles.points[3])];\n      const firstLineSegment = {\n        start: {\n          x: canvasCoordHandlesCurrent[0][0],\n          y: canvasCoordHandlesCurrent[0][1]\n        },\n        end: {\n          x: canvasCoordHandlesCurrent[1][0],\n          y: canvasCoordHandlesCurrent[1][1]\n        }\n      };\n      const secondLineSegment = {\n        start: {\n          x: canvasCoordHandlesCurrent[2][0],\n          y: canvasCoordHandlesCurrent[2][1]\n        },\n        end: {\n          x: canvasCoordHandlesCurrent[3][0],\n          y: canvasCoordHandlesCurrent[3][1]\n        }\n      };\n      const proposedPoint = [...worldPos];\n      const proposedCanvasCoord = viewport.worldToCanvas(proposedPoint);\n      if (movingHandleIndex === 0 || movingHandleIndex === 1) {\n        const fixedHandleIndex = movingHandleIndex === 0 ? 1 : 0;\n        const fixedHandleCanvasCoord = canvasCoordHandlesCurrent[fixedHandleIndex];\n        const fixedHandleToProposedCoordVec = vec2.set(vec2.create(), proposedCanvasCoord[0] - fixedHandleCanvasCoord[0], proposedCanvasCoord[1] - fixedHandleCanvasCoord[1]);\n        const fixedHandleToOldCoordVec = vec2.set(vec2.create(), canvasCoordHandlesCurrent[movingHandleIndex][0] - fixedHandleCanvasCoord[0], canvasCoordHandlesCurrent[movingHandleIndex][1] - fixedHandleCanvasCoord[1]);\n        vec2.normalize(fixedHandleToProposedCoordVec, fixedHandleToProposedCoordVec);\n        vec2.normalize(fixedHandleToOldCoordVec, fixedHandleToOldCoordVec);\n        const proposedFirstLineSegment = {\n          start: {\n            x: fixedHandleCanvasCoord[0],\n            y: fixedHandleCanvasCoord[1]\n          },\n          end: {\n            x: proposedCanvasCoord[0],\n            y: proposedCanvasCoord[1]\n          }\n        };\n        if (this._movingLongAxisWouldPutItThroughShortAxis(proposedFirstLineSegment, secondLineSegment)) {\n          return;\n        }\n        const centerOfRotation = fixedHandleCanvasCoord;\n        const angle = this._getSignedAngle(fixedHandleToOldCoordVec, fixedHandleToProposedCoordVec);\n        let firstPointX = canvasCoordHandlesCurrent[2][0];\n        let firstPointY = canvasCoordHandlesCurrent[2][1];\n        let secondPointX = canvasCoordHandlesCurrent[3][0];\n        let secondPointY = canvasCoordHandlesCurrent[3][1];\n        firstPointX -= centerOfRotation[0];\n        firstPointY -= centerOfRotation[1];\n        secondPointX -= centerOfRotation[0];\n        secondPointY -= centerOfRotation[1];\n        const rotatedFirstPoint = firstPointX * Math.cos(angle) - firstPointY * Math.sin(angle);\n        const rotatedFirstPointY = firstPointX * Math.sin(angle) + firstPointY * Math.cos(angle);\n        const rotatedSecondPoint = secondPointX * Math.cos(angle) - secondPointY * Math.sin(angle);\n        const rotatedSecondPointY = secondPointX * Math.sin(angle) + secondPointY * Math.cos(angle);\n        firstPointX = rotatedFirstPoint + centerOfRotation[0];\n        firstPointY = rotatedFirstPointY + centerOfRotation[1];\n        secondPointX = rotatedSecondPoint + centerOfRotation[0];\n        secondPointY = rotatedSecondPointY + centerOfRotation[1];\n        const newFirstPoint = viewport.canvasToWorld([firstPointX, firstPointY]);\n        const newSecondPoint = viewport.canvasToWorld([secondPointX, secondPointY]);\n        data.handles.points[movingHandleIndex] = proposedPoint;\n        data.handles.points[2] = newFirstPoint;\n        data.handles.points[3] = newSecondPoint;\n      } else {\n        const translateHandleIndex = movingHandleIndex === 2 ? 3 : 2;\n        const canvasCoordsCurrent = {\n          longLineSegment: {\n            start: firstLineSegment.start,\n            end: firstLineSegment.end\n          },\n          shortLineSegment: {\n            start: secondLineSegment.start,\n            end: secondLineSegment.end\n          }\n        };\n        const longLineSegmentVec = vec2.subtract(vec2.create(), [canvasCoordsCurrent.longLineSegment.end.x, canvasCoordsCurrent.longLineSegment.end.y], [canvasCoordsCurrent.longLineSegment.start.x, canvasCoordsCurrent.longLineSegment.start.y]);\n        const longLineSegmentVecNormalized = vec2.normalize(vec2.create(), longLineSegmentVec);\n        const proposedToCurrentVec = vec2.subtract(vec2.create(), [proposedCanvasCoord[0], proposedCanvasCoord[1]], [canvasCoordHandlesCurrent[movingHandleIndex][0], canvasCoordHandlesCurrent[movingHandleIndex][1]]);\n        const movementLength = vec2.length(proposedToCurrentVec);\n        const angle = this._getSignedAngle(longLineSegmentVecNormalized, proposedToCurrentVec);\n        const movementAlongLineSegmentLength = Math.cos(angle) * movementLength;\n        const newTranslatedPoint = vec2.scaleAndAdd(vec2.create(), [canvasCoordHandlesCurrent[translateHandleIndex][0], canvasCoordHandlesCurrent[translateHandleIndex][1]], longLineSegmentVecNormalized, movementAlongLineSegmentLength);\n        if (this._movingLongAxisWouldPutItThroughShortAxis({\n          start: {\n            x: proposedCanvasCoord[0],\n            y: proposedCanvasCoord[1]\n          },\n          end: {\n            x: newTranslatedPoint[0],\n            y: newTranslatedPoint[1]\n          }\n        }, {\n          start: {\n            x: canvasCoordsCurrent.longLineSegment.start.x,\n            y: canvasCoordsCurrent.longLineSegment.start.y\n          },\n          end: {\n            x: canvasCoordsCurrent.longLineSegment.end.x,\n            y: canvasCoordsCurrent.longLineSegment.end.y\n          }\n        })) {\n          return;\n        }\n        const intersectionPoint = lineSegment.intersectLine([proposedCanvasCoord[0], proposedCanvasCoord[1]], [newTranslatedPoint[0], newTranslatedPoint[1]], [firstLineSegment.start.x, firstLineSegment.start.y], [firstLineSegment.end.x, firstLineSegment.end.y]);\n        if (!intersectionPoint) {\n          return;\n        }\n        data.handles.points[translateHandleIndex] = viewport.canvasToWorld(newTranslatedPoint);\n        data.handles.points[movingHandleIndex] = proposedPoint;\n      }\n    };\n    this.cancel = element => {\n      if (this.isDrawing) {\n        this.isDrawing = false;\n        this._deactivateDraw(element);\n        this._deactivateModify(element);\n        resetElementCursor(element);\n        const {\n          annotation,\n          viewportIdsToRender,\n          newAnnotation\n        } = this.editData;\n        const {\n          data\n        } = annotation;\n        annotation.highlighted = false;\n        data.handles.activeHandleIndex = null;\n        const enabledElement = getEnabledElement(element);\n        const {\n          renderingEngine\n        } = enabledElement;\n        triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n        if (newAnnotation) {\n          const eventType = Events.ANNOTATION_COMPLETED;\n          const eventDetail = {\n            annotation\n          };\n          triggerEvent(eventTarget, eventType, eventDetail);\n        }\n        this.editData = null;\n        return annotation.annotationUID;\n      }\n    };\n    this._activateDraw = element => {\n      state.isInteractingWithTool = true;\n      element.addEventListener(Events.MOUSE_UP, this._endCallback);\n      element.addEventListener(Events.MOUSE_DRAG, this._dragDrawCallback);\n      element.addEventListener(Events.MOUSE_MOVE, this._dragDrawCallback);\n      element.addEventListener(Events.MOUSE_CLICK, this._endCallback);\n      element.addEventListener(Events.TOUCH_TAP, this._endCallback);\n      element.addEventListener(Events.TOUCH_END, this._endCallback);\n      element.addEventListener(Events.TOUCH_DRAG, this._dragDrawCallback);\n    };\n    this._deactivateDraw = element => {\n      state.isInteractingWithTool = false;\n      element.removeEventListener(Events.MOUSE_UP, this._endCallback);\n      element.removeEventListener(Events.MOUSE_DRAG, this._dragDrawCallback);\n      element.removeEventListener(Events.MOUSE_MOVE, this._dragDrawCallback);\n      element.removeEventListener(Events.MOUSE_CLICK, this._endCallback);\n      element.removeEventListener(Events.TOUCH_TAP, this._endCallback);\n      element.removeEventListener(Events.TOUCH_END, this._endCallback);\n      element.removeEventListener(Events.TOUCH_DRAG, this._dragDrawCallback);\n    };\n    this._activateModify = element => {\n      state.isInteractingWithTool = true;\n      element.addEventListener(Events.MOUSE_UP, this._endCallback);\n      element.addEventListener(Events.MOUSE_DRAG, this._dragModifyCallback);\n      element.addEventListener(Events.MOUSE_CLICK, this._endCallback);\n      element.addEventListener(Events.TOUCH_END, this._endCallback);\n      element.addEventListener(Events.TOUCH_DRAG, this._dragModifyCallback);\n      element.addEventListener(Events.TOUCH_TAP, this._endCallback);\n    };\n    this._deactivateModify = element => {\n      state.isInteractingWithTool = false;\n      element.removeEventListener(Events.MOUSE_UP, this._endCallback);\n      element.removeEventListener(Events.MOUSE_DRAG, this._dragModifyCallback);\n      element.removeEventListener(Events.MOUSE_CLICK, this._endCallback);\n      element.removeEventListener(Events.TOUCH_END, this._endCallback);\n      element.removeEventListener(Events.TOUCH_DRAG, this._dragModifyCallback);\n      element.removeEventListener(Events.TOUCH_TAP, this._endCallback);\n    };\n    this.renderAnnotation = (enabledElement, svgDrawingHelper) => {\n      let renderStatus = true;\n      const {\n        viewport\n      } = enabledElement;\n      const {\n        element\n      } = viewport;\n      let annotations = getAnnotations(this.getToolName(), element);\n      if (!annotations?.length) {\n        return renderStatus;\n      }\n      annotations = this.filterInteractableAnnotationsForElement(element, annotations);\n      if (!annotations?.length) {\n        return renderStatus;\n      }\n      const targetId = this.getTargetId(viewport);\n      const renderingEngine = viewport.getRenderingEngine();\n      const styleSpecifier = {\n        toolGroupId: this.toolGroupId,\n        toolName: this.getToolName(),\n        viewportId: enabledElement.viewport.id\n      };\n      for (let i = 0; i < annotations.length; i++) {\n        const annotation = annotations[i];\n        const {\n          annotationUID,\n          data\n        } = annotation;\n        const {\n          points,\n          activeHandleIndex\n        } = data.handles;\n        const canvasCoordinates = points.map(p => viewport.worldToCanvas(p));\n        styleSpecifier.annotationUID = annotationUID;\n        const {\n          color,\n          lineWidth,\n          lineDash,\n          shadow\n        } = this.getAnnotationStyle({\n          annotation,\n          styleSpecifier\n        });\n        if (!data.cachedStats[targetId] || data.cachedStats[targetId].unit == null) {\n          data.cachedStats[targetId] = {\n            length: null,\n            width: null,\n            unit: null\n          };\n          this._calculateCachedStats(annotation, renderingEngine, enabledElement);\n        } else if (annotation.invalidated) {\n          this._throttledCalculateCachedStats(annotation, renderingEngine, enabledElement);\n        }\n        if (!viewport.getRenderingEngine()) {\n          console.warn('Rendering Engine has been destroyed');\n          return renderStatus;\n        }\n        let activeHandleCanvasCoords;\n        if (!isAnnotationVisible(annotationUID)) {\n          continue;\n        }\n        if (!isAnnotationLocked(annotation) && !this.editData && activeHandleIndex !== null) {\n          activeHandleCanvasCoords = [canvasCoordinates[activeHandleIndex]];\n        }\n        if (activeHandleCanvasCoords) {\n          const handleGroupUID = '0';\n          drawHandlesSvg(svgDrawingHelper, annotationUID, handleGroupUID, activeHandleCanvasCoords, {\n            color\n          });\n        }\n        const dataId1 = `${annotationUID}-line-1`;\n        const dataId2 = `${annotationUID}-line-2`;\n        const lineUID = '0';\n        drawLineSvg(svgDrawingHelper, annotationUID, lineUID, canvasCoordinates[0], canvasCoordinates[1], {\n          color,\n          lineDash,\n          lineWidth,\n          shadow\n        }, dataId1);\n        const secondLineUID = '1';\n        drawLineSvg(svgDrawingHelper, annotationUID, secondLineUID, canvasCoordinates[2], canvasCoordinates[3], {\n          color,\n          lineDash,\n          lineWidth,\n          shadow\n        }, dataId2);\n        renderStatus = true;\n        const options = this.getLinkedTextBoxStyle(styleSpecifier, annotation);\n        if (!options.visibility) {\n          data.handles.textBox = {\n            hasMoved: false,\n            worldPosition: [0, 0, 0],\n            worldBoundingBox: {\n              topLeft: [0, 0, 0],\n              topRight: [0, 0, 0],\n              bottomLeft: [0, 0, 0],\n              bottomRight: [0, 0, 0]\n            }\n          };\n          continue;\n        }\n        const textLines = this.configuration.getTextLines(data, targetId);\n        if (!textLines || textLines.length === 0) {\n          continue;\n        }\n        let canvasTextBoxCoords;\n        if (!data.handles.textBox.hasMoved) {\n          canvasTextBoxCoords = getTextBoxCoordsCanvas(canvasCoordinates);\n          data.handles.textBox.worldPosition = viewport.canvasToWorld(canvasTextBoxCoords);\n        }\n        const textBoxPosition = viewport.worldToCanvas(data.handles.textBox.worldPosition);\n        const textBoxUID = '1';\n        const boundingBox = drawLinkedTextBoxSvg(svgDrawingHelper, annotationUID, textBoxUID, textLines, textBoxPosition, canvasCoordinates, {}, options);\n        const {\n          x: left,\n          y: top,\n          width,\n          height\n        } = boundingBox;\n        data.handles.textBox.worldBoundingBox = {\n          topLeft: viewport.canvasToWorld([left, top]),\n          topRight: viewport.canvasToWorld([left + width, top]),\n          bottomLeft: viewport.canvasToWorld([left, top + height]),\n          bottomRight: viewport.canvasToWorld([left + width, top + height])\n        };\n      }\n      return renderStatus;\n    };\n    this._movingLongAxisWouldPutItThroughShortAxis = (firstLineSegment, secondLineSegment) => {\n      const vectorInSecondLineDirection = vec2.create();\n      vec2.set(vectorInSecondLineDirection, secondLineSegment.end.x - secondLineSegment.start.x, secondLineSegment.end.y - secondLineSegment.start.y);\n      vec2.normalize(vectorInSecondLineDirection, vectorInSecondLineDirection);\n      const extendedSecondLineSegment = {\n        start: {\n          x: secondLineSegment.start.x - vectorInSecondLineDirection[0] * 10,\n          y: secondLineSegment.start.y - vectorInSecondLineDirection[1] * 10\n        },\n        end: {\n          x: secondLineSegment.end.x + vectorInSecondLineDirection[0] * 10,\n          y: secondLineSegment.end.y + vectorInSecondLineDirection[1] * 10\n        }\n      };\n      const proposedIntersectionPoint = lineSegment.intersectLine([extendedSecondLineSegment.start.x, extendedSecondLineSegment.start.y], [extendedSecondLineSegment.end.x, extendedSecondLineSegment.end.y], [firstLineSegment.start.x, firstLineSegment.start.y], [firstLineSegment.end.x, firstLineSegment.end.y]);\n      const wouldPutThroughShortAxis = !proposedIntersectionPoint;\n      return wouldPutThroughShortAxis;\n    };\n    this._calculateCachedStats = (annotation, renderingEngine, enabledElement) => {\n      const {\n        data\n      } = annotation;\n      const {\n        viewportId,\n        renderingEngineId\n      } = enabledElement;\n      const worldPos1 = data.handles.points[0];\n      const worldPos2 = data.handles.points[1];\n      const worldPos3 = data.handles.points[2];\n      const worldPos4 = data.handles.points[3];\n      const {\n        cachedStats\n      } = data;\n      const targetIds = Object.keys(cachedStats);\n      for (let i = 0; i < targetIds.length; i++) {\n        const targetId = targetIds[i];\n        const image = this.getTargetIdImage(targetId, renderingEngine);\n        if (!image) {\n          continue;\n        }\n        const {\n          imageData,\n          dimensions\n        } = image;\n        const scale = getCalibratedScale(image);\n        const dist1 = this._calculateLength(worldPos1, worldPos2) / scale;\n        const dist2 = this._calculateLength(worldPos3, worldPos4) / scale;\n        const length = dist1 > dist2 ? dist1 : dist2;\n        const width = dist1 > dist2 ? dist2 : dist1;\n        const index1 = transformWorldToIndex(imageData, worldPos1);\n        const index2 = transformWorldToIndex(imageData, worldPos2);\n        const index3 = transformWorldToIndex(imageData, worldPos3);\n        const index4 = transformWorldToIndex(imageData, worldPos4);\n        this._isInsideVolume(index1, index2, index3, index4, dimensions) ? this.isHandleOutsideImage = false : this.isHandleOutsideImage = true;\n        cachedStats[targetId] = {\n          length,\n          width,\n          unit: getCalibratedLengthUnits(null, image)\n        };\n      }\n      annotation.invalidated = false;\n      const eventType = Events.ANNOTATION_MODIFIED;\n      const eventDetail = {\n        annotation,\n        viewportId,\n        renderingEngineId\n      };\n      triggerEvent(eventTarget, eventType, eventDetail);\n      return cachedStats;\n    };\n    this._isInsideVolume = (index1, index2, index3, index4, dimensions) => {\n      return csUtils.indexWithinDimensions(index1, dimensions) && csUtils.indexWithinDimensions(index2, dimensions) && csUtils.indexWithinDimensions(index3, dimensions) && csUtils.indexWithinDimensions(index4, dimensions);\n    };\n    this._getSignedAngle = (vector1, vector2) => {\n      return Math.atan2(vector1[0] * vector2[1] - vector1[1] * vector2[0], vector1[0] * vector2[0] + vector1[1] * vector2[1]);\n    };\n    this._throttledCalculateCachedStats = throttle(this._calculateCachedStats, 100, {\n      trailing: true\n    });\n  }\n  addNewAnnotation(evt) {\n    const eventDetail = evt.detail;\n    const {\n      currentPoints,\n      element\n    } = eventDetail;\n    const worldPos = currentPoints.world;\n    const enabledElement = getEnabledElement(element);\n    const {\n      viewport,\n      renderingEngine\n    } = enabledElement;\n    this.isDrawing = true;\n    const camera = viewport.getCamera();\n    const {\n      viewPlaneNormal,\n      viewUp\n    } = camera;\n    const referencedImageId = this.getReferencedImageId(viewport, worldPos, viewPlaneNormal, viewUp);\n    const FrameOfReferenceUID = viewport.getFrameOfReferenceUID();\n    const annotation = {\n      highlighted: true,\n      invalidated: true,\n      metadata: {\n        toolName: this.getToolName(),\n        viewPlaneNormal: [...viewPlaneNormal],\n        viewUp: [...viewUp],\n        FrameOfReferenceUID,\n        referencedImageId\n      },\n      data: {\n        handles: {\n          points: [[...worldPos], [...worldPos], [...worldPos], [...worldPos]],\n          textBox: {\n            hasMoved: false,\n            worldPosition: [0, 0, 0],\n            worldBoundingBox: {\n              topLeft: [0, 0, 0],\n              topRight: [0, 0, 0],\n              bottomLeft: [0, 0, 0],\n              bottomRight: [0, 0, 0]\n            }\n          },\n          activeHandleIndex: null\n        },\n        label: '',\n        cachedStats: {}\n      }\n    };\n    addAnnotation(annotation, element);\n    const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n    this.editData = {\n      annotation,\n      viewportIdsToRender,\n      handleIndex: 1,\n      movingTextBox: false,\n      newAnnotation: true,\n      hasMoved: false\n    };\n    this._activateDraw(element);\n    hideElementCursor(element);\n    evt.preventDefault();\n    triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n    return annotation;\n  }\n  _calculateLength(pos1, pos2) {\n    const dx = pos1[0] - pos2[0];\n    const dy = pos1[1] - pos2[1];\n    const dz = pos1[2] - pos2[2];\n    return Math.sqrt(dx * dx + dy * dy + dz * dz);\n  }\n}\nfunction defaultGetTextLines(data, targetId) {\n  const {\n    cachedStats,\n    label\n  } = data;\n  const {\n    length,\n    width,\n    unit\n  } = cachedStats[targetId];\n  const textLines = [];\n  if (label) {\n    textLines.push(label);\n  }\n  if (length === undefined) {\n    return textLines;\n  }\n  textLines.push(`L: ${roundNumber(length)} ${unit}`, `W: ${roundNumber(width)} ${unit}`);\n  return textLines;\n}\nBidirectionalTool.toolName = 'Bidirectional';\nexport default BidirectionalTool;","map":{"version":3,"names":["vec2","vec3","getEnabledElement","triggerEvent","eventTarget","utilities","csUtils","getCalibratedLengthUnits","getCalibratedScale","roundNumber","AnnotationTool","throttle","addAnnotation","getAnnotations","removeAnnotation","isAnnotationLocked","isAnnotationVisible","drawLine","drawLineSvg","drawHandles","drawHandlesSvg","drawLinkedTextBox","drawLinkedTextBoxSvg","state","Events","getViewportIdsWithToolToRender","lineSegment","getTextBoxCoordsCanvas","resetElementCursor","hideElementCursor","triggerAnnotationRenderForViewportIds","transformWorldToIndex","BidirectionalTool","constructor","toolProps","defaultToolProps","supportedInteractionTypes","configuration","preventHandleOutsideImage","getTextLines","defaultGetTextLines","isPointNearTool","element","annotation","canvasCoords","proximity","enabledElement","viewport","data","points","handles","canvasPoint1","worldToCanvas","canvasPoint2","line","start","x","y","end","distanceToPoint","toolSelectedCallback","evt","eventDetail","detail","highlighted","viewportIdsToRender","getToolName","editData","movingTextBox","_activateModify","renderingEngine","preventDefault","handleSelectedCallback","handle","handleIndex","worldPosition","findIndex","p","_endCallback","newAnnotation","hasMoved","activeHandleIndex","_deactivateModify","_deactivateDraw","undefined","firstLineSegmentLength","distance","secondLineSegmentLength","longAxis","shortAxisPoint0","shortAxisPoint1","longAxisVector","create","set","counterClockWisePerpendicularToLongAxis","currentShortAxisVector","shortAxis","dot","isHandleOutsideImage","annotationUID","eventType","ANNOTATION_COMPLETED","isDrawing","_dragDrawCallback","currentPoints","worldPos","world","canvasCoordPoints","map","longLineSegment","shortLineSegment","dist","shortAxisDistFromCenter","dx","dy","length","Math","sqrt","vectorX","vectorY","xMid","yMid","startX","startY","endX","endY","canvasToWorld","invalidated","_dragModifyCallback","deltaPoints","worldPosDelta","textBox","forEach","point","_dragModifyHandle","movingHandleIndex","canvasCoordHandlesCurrent","firstLineSegment","secondLineSegment","proposedPoint","proposedCanvasCoord","fixedHandleIndex","fixedHandleCanvasCoord","fixedHandleToProposedCoordVec","fixedHandleToOldCoordVec","normalize","proposedFirstLineSegment","_movingLongAxisWouldPutItThroughShortAxis","centerOfRotation","angle","_getSignedAngle","firstPointX","firstPointY","secondPointX","secondPointY","rotatedFirstPoint","cos","sin","rotatedFirstPointY","rotatedSecondPoint","rotatedSecondPointY","newFirstPoint","newSecondPoint","translateHandleIndex","canvasCoordsCurrent","longLineSegmentVec","subtract","longLineSegmentVecNormalized","proposedToCurrentVec","movementLength","movementAlongLineSegmentLength","newTranslatedPoint","scaleAndAdd","intersectionPoint","intersectLine","cancel","_activateDraw","isInteractingWithTool","addEventListener","MOUSE_UP","MOUSE_DRAG","MOUSE_MOVE","MOUSE_CLICK","TOUCH_TAP","TOUCH_END","TOUCH_DRAG","removeEventListener","renderAnnotation","svgDrawingHelper","renderStatus","annotations","filterInteractableAnnotationsForElement","targetId","getTargetId","getRenderingEngine","styleSpecifier","toolGroupId","toolName","viewportId","id","i","canvasCoordinates","color","lineWidth","lineDash","shadow","getAnnotationStyle","cachedStats","unit","width","_calculateCachedStats","_throttledCalculateCachedStats","console","warn","activeHandleCanvasCoords","handleGroupUID","dataId1","dataId2","lineUID","secondLineUID","options","getLinkedTextBoxStyle","visibility","worldBoundingBox","topLeft","topRight","bottomLeft","bottomRight","textLines","canvasTextBoxCoords","textBoxPosition","textBoxUID","boundingBox","left","top","height","vectorInSecondLineDirection","extendedSecondLineSegment","proposedIntersectionPoint","wouldPutThroughShortAxis","renderingEngineId","worldPos1","worldPos2","worldPos3","worldPos4","targetIds","Object","keys","image","getTargetIdImage","imageData","dimensions","scale","dist1","_calculateLength","dist2","index1","index2","index3","index4","_isInsideVolume","ANNOTATION_MODIFIED","indexWithinDimensions","vector1","vector2","atan2","trailing","addNewAnnotation","camera","getCamera","viewPlaneNormal","viewUp","referencedImageId","getReferencedImageId","FrameOfReferenceUID","getFrameOfReferenceUID","metadata","label","pos1","pos2","dz","push"],"sources":["../../../../src/tools/annotation/BidirectionalTool.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}