{"ast":null,"code":"import { AnnotationTool } from '../base';\nimport { getEnabledElement, VolumeViewport, triggerEvent, eventTarget, utilities as csUtils } from '@cornerstonejs/core';\nimport { getCalibratedAreaUnits, getCalibratedScale } from '../../utilities/getCalibratedUnits';\nimport { roundNumber } from '../../utilities';\nimport throttle from '../../utilities/throttle';\nimport { addAnnotation, getAnnotations, removeAnnotation } from '../../stateManagement';\nimport { isAnnotationLocked } from '../../stateManagement/annotation/annotationLocking';\nimport { isAnnotationVisible } from '../../stateManagement/annotation/annotationVisibility';\nimport { drawHandles as drawHandlesSvg, drawLinkedTextBox as drawLinkedTextBoxSvg, drawRect as drawRectSvg } from '../../drawingSvg';\nimport { state } from '../../store';\nimport { Events } from '../../enums';\nimport { getViewportIdsWithToolToRender } from '../../utilities/viewportFilters';\nimport * as rectangle from '../../utilities/math/rectangle';\nimport { getTextBoxCoordsCanvas } from '../../utilities/drawing';\nimport getWorldWidthAndHeightFromCorners from '../../utilities/planar/getWorldWidthAndHeightFromCorners';\nimport { resetElementCursor, hideElementCursor } from '../../cursors/elementCursor';\nimport triggerAnnotationRenderForViewportIds from '../../utilities/triggerAnnotationRenderForViewportIds';\nimport { getModalityUnit } from '../../utilities/getModalityUnit';\nimport { isViewportPreScaled } from '../../utilities/viewport/isViewportPreScaled';\nimport { pointInShapeCallback } from '../../utilities/';\nimport { BasicStatsCalculator } from '../../utilities/math/basic';\nconst {\n  transformWorldToIndex\n} = csUtils;\nclass RectangleROITool extends AnnotationTool {\n  constructor(toolProps = {}, defaultToolProps = {\n    supportedInteractionTypes: ['Mouse', 'Touch'],\n    configuration: {\n      shadow: true,\n      preventHandleOutsideImage: false,\n      getTextLines: defaultGetTextLines,\n      statsCalculator: BasicStatsCalculator\n    }\n  }) {\n    super(toolProps, defaultToolProps);\n    this.addNewAnnotation = evt => {\n      const eventDetail = evt.detail;\n      const {\n        currentPoints,\n        element\n      } = eventDetail;\n      const worldPos = currentPoints.world;\n      const enabledElement = getEnabledElement(element);\n      const {\n        viewport,\n        renderingEngine\n      } = enabledElement;\n      this.isDrawing = true;\n      const camera = viewport.getCamera();\n      const {\n        viewPlaneNormal,\n        viewUp\n      } = camera;\n      const referencedImageId = this.getReferencedImageId(viewport, worldPos, viewPlaneNormal, viewUp);\n      const FrameOfReferenceUID = viewport.getFrameOfReferenceUID();\n      const annotation = {\n        invalidated: true,\n        highlighted: true,\n        metadata: {\n          toolName: this.getToolName(),\n          viewPlaneNormal: [...viewPlaneNormal],\n          viewUp: [...viewUp],\n          FrameOfReferenceUID,\n          referencedImageId\n        },\n        data: {\n          label: '',\n          handles: {\n            points: [[...worldPos], [...worldPos], [...worldPos], [...worldPos]],\n            textBox: {\n              hasMoved: false,\n              worldPosition: [0, 0, 0],\n              worldBoundingBox: {\n                topLeft: [0, 0, 0],\n                topRight: [0, 0, 0],\n                bottomLeft: [0, 0, 0],\n                bottomRight: [0, 0, 0]\n              }\n            },\n            activeHandleIndex: null\n          },\n          cachedStats: {}\n        }\n      };\n      addAnnotation(annotation, element);\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      this.editData = {\n        annotation,\n        viewportIdsToRender,\n        handleIndex: 3,\n        movingTextBox: false,\n        newAnnotation: true,\n        hasMoved: false\n      };\n      this._activateDraw(element);\n      hideElementCursor(element);\n      evt.preventDefault();\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      return annotation;\n    };\n    this.isPointNearTool = (element, annotation, canvasCoords, proximity) => {\n      const enabledElement = getEnabledElement(element);\n      const {\n        viewport\n      } = enabledElement;\n      const {\n        data\n      } = annotation;\n      const {\n        points\n      } = data.handles;\n      const canvasPoint1 = viewport.worldToCanvas(points[0]);\n      const canvasPoint2 = viewport.worldToCanvas(points[3]);\n      const rect = this._getRectangleImageCoordinates([canvasPoint1, canvasPoint2]);\n      const point = [canvasCoords[0], canvasCoords[1]];\n      const {\n        left,\n        top,\n        width,\n        height\n      } = rect;\n      const distanceToPoint = rectangle.distanceToPoint([left, top, width, height], point);\n      if (distanceToPoint <= proximity) {\n        return true;\n      }\n      return false;\n    };\n    this.toolSelectedCallback = (evt, annotation) => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      annotation.highlighted = true;\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      this.editData = {\n        annotation,\n        viewportIdsToRender,\n        movingTextBox: false\n      };\n      this._activateModify(element);\n      hideElementCursor(element);\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      evt.preventDefault();\n    };\n    this.handleSelectedCallback = (evt, annotation, handle) => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const {\n        data\n      } = annotation;\n      annotation.highlighted = true;\n      let movingTextBox = false;\n      let handleIndex;\n      if (handle.worldPosition) {\n        movingTextBox = true;\n      } else {\n        handleIndex = data.handles.points.findIndex(p => p === handle);\n      }\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      this.editData = {\n        annotation,\n        viewportIdsToRender,\n        handleIndex,\n        movingTextBox\n      };\n      this._activateModify(element);\n      hideElementCursor(element);\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      evt.preventDefault();\n    };\n    this._endCallback = evt => {\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const {\n        annotation,\n        viewportIdsToRender,\n        newAnnotation,\n        hasMoved\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      if (newAnnotation && !hasMoved) {\n        return;\n      }\n      data.handles.activeHandleIndex = null;\n      this._deactivateModify(element);\n      this._deactivateDraw(element);\n      resetElementCursor(element);\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      this.editData = null;\n      this.isDrawing = false;\n      if (this.isHandleOutsideImage && this.configuration.preventHandleOutsideImage) {\n        removeAnnotation(annotation.annotationUID);\n      }\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      if (newAnnotation) {\n        const eventType = Events.ANNOTATION_COMPLETED;\n        const eventDetail = {\n          annotation\n        };\n        triggerEvent(eventTarget, eventType, eventDetail);\n      }\n    };\n    this._dragCallback = evt => {\n      this.isDrawing = true;\n      const eventDetail = evt.detail;\n      const {\n        element\n      } = eventDetail;\n      const {\n        annotation,\n        viewportIdsToRender,\n        handleIndex,\n        movingTextBox\n      } = this.editData;\n      const {\n        data\n      } = annotation;\n      if (movingTextBox) {\n        const {\n          deltaPoints\n        } = eventDetail;\n        const worldPosDelta = deltaPoints.world;\n        const {\n          textBox\n        } = data.handles;\n        const {\n          worldPosition\n        } = textBox;\n        worldPosition[0] += worldPosDelta[0];\n        worldPosition[1] += worldPosDelta[1];\n        worldPosition[2] += worldPosDelta[2];\n        textBox.hasMoved = true;\n      } else if (handleIndex === undefined) {\n        const {\n          deltaPoints\n        } = eventDetail;\n        const worldPosDelta = deltaPoints.world;\n        const {\n          points\n        } = data.handles;\n        points.forEach(point => {\n          point[0] += worldPosDelta[0];\n          point[1] += worldPosDelta[1];\n          point[2] += worldPosDelta[2];\n        });\n        annotation.invalidated = true;\n      } else {\n        const {\n          currentPoints\n        } = eventDetail;\n        const enabledElement = getEnabledElement(element);\n        const {\n          worldToCanvas,\n          canvasToWorld\n        } = enabledElement.viewport;\n        const worldPos = currentPoints.world;\n        const {\n          points\n        } = data.handles;\n        points[handleIndex] = [...worldPos];\n        let bottomLeftCanvas;\n        let bottomRightCanvas;\n        let topLeftCanvas;\n        let topRightCanvas;\n        let bottomLeftWorld;\n        let bottomRightWorld;\n        let topLeftWorld;\n        let topRightWorld;\n        switch (handleIndex) {\n          case 0:\n          case 3:\n            bottomLeftCanvas = worldToCanvas(points[0]);\n            topRightCanvas = worldToCanvas(points[3]);\n            bottomRightCanvas = [topRightCanvas[0], bottomLeftCanvas[1]];\n            topLeftCanvas = [bottomLeftCanvas[0], topRightCanvas[1]];\n            bottomRightWorld = canvasToWorld(bottomRightCanvas);\n            topLeftWorld = canvasToWorld(topLeftCanvas);\n            points[1] = bottomRightWorld;\n            points[2] = topLeftWorld;\n            break;\n          case 1:\n          case 2:\n            bottomRightCanvas = worldToCanvas(points[1]);\n            topLeftCanvas = worldToCanvas(points[2]);\n            bottomLeftCanvas = [topLeftCanvas[0], bottomRightCanvas[1]];\n            topRightCanvas = [bottomRightCanvas[0], topLeftCanvas[1]];\n            bottomLeftWorld = canvasToWorld(bottomLeftCanvas);\n            topRightWorld = canvasToWorld(topRightCanvas);\n            points[0] = bottomLeftWorld;\n            points[3] = topRightWorld;\n            break;\n        }\n        annotation.invalidated = true;\n      }\n      this.editData.hasMoved = true;\n      const enabledElement = getEnabledElement(element);\n      const {\n        renderingEngine\n      } = enabledElement;\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n    };\n    this.cancel = element => {\n      if (this.isDrawing) {\n        this.isDrawing = false;\n        this._deactivateDraw(element);\n        this._deactivateModify(element);\n        resetElementCursor(element);\n        const {\n          annotation,\n          viewportIdsToRender,\n          newAnnotation\n        } = this.editData;\n        const {\n          data\n        } = annotation;\n        annotation.highlighted = false;\n        data.handles.activeHandleIndex = null;\n        const enabledElement = getEnabledElement(element);\n        const {\n          renderingEngine\n        } = enabledElement;\n        triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n        if (newAnnotation) {\n          const eventType = Events.ANNOTATION_COMPLETED;\n          const eventDetail = {\n            annotation\n          };\n          triggerEvent(eventTarget, eventType, eventDetail);\n        }\n        this.editData = null;\n        return annotation.annotationUID;\n      }\n    };\n    this._activateDraw = element => {\n      state.isInteractingWithTool = true;\n      element.addEventListener(Events.MOUSE_UP, this._endCallback);\n      element.addEventListener(Events.MOUSE_DRAG, this._dragCallback);\n      element.addEventListener(Events.MOUSE_MOVE, this._dragCallback);\n      element.addEventListener(Events.MOUSE_CLICK, this._endCallback);\n      element.addEventListener(Events.TOUCH_END, this._endCallback);\n      element.addEventListener(Events.TOUCH_DRAG, this._dragCallback);\n      element.addEventListener(Events.TOUCH_TAP, this._endCallback);\n    };\n    this._deactivateDraw = element => {\n      state.isInteractingWithTool = false;\n      element.removeEventListener(Events.MOUSE_UP, this._endCallback);\n      element.removeEventListener(Events.MOUSE_DRAG, this._dragCallback);\n      element.removeEventListener(Events.MOUSE_MOVE, this._dragCallback);\n      element.removeEventListener(Events.MOUSE_CLICK, this._endCallback);\n      element.removeEventListener(Events.TOUCH_END, this._endCallback);\n      element.removeEventListener(Events.TOUCH_DRAG, this._dragCallback);\n      element.removeEventListener(Events.TOUCH_TAP, this._endCallback);\n    };\n    this._activateModify = element => {\n      state.isInteractingWithTool = true;\n      element.addEventListener(Events.MOUSE_UP, this._endCallback);\n      element.addEventListener(Events.MOUSE_DRAG, this._dragCallback);\n      element.addEventListener(Events.MOUSE_CLICK, this._endCallback);\n      element.addEventListener(Events.TOUCH_END, this._endCallback);\n      element.addEventListener(Events.TOUCH_DRAG, this._dragCallback);\n      element.addEventListener(Events.TOUCH_TAP, this._endCallback);\n    };\n    this._deactivateModify = element => {\n      state.isInteractingWithTool = false;\n      element.removeEventListener(Events.MOUSE_UP, this._endCallback);\n      element.removeEventListener(Events.MOUSE_DRAG, this._dragCallback);\n      element.removeEventListener(Events.MOUSE_CLICK, this._endCallback);\n      element.removeEventListener(Events.TOUCH_END, this._endCallback);\n      element.removeEventListener(Events.TOUCH_DRAG, this._dragCallback);\n      element.removeEventListener(Events.TOUCH_TAP, this._endCallback);\n    };\n    this.renderAnnotation = (enabledElement, svgDrawingHelper) => {\n      let renderStatus = false;\n      const {\n        viewport\n      } = enabledElement;\n      const {\n        element\n      } = viewport;\n      let annotations = getAnnotations(this.getToolName(), element);\n      if (!annotations?.length) {\n        return renderStatus;\n      }\n      annotations = this.filterInteractableAnnotationsForElement(element, annotations);\n      if (!annotations?.length) {\n        return renderStatus;\n      }\n      const targetId = this.getTargetId(viewport);\n      const renderingEngine = viewport.getRenderingEngine();\n      const styleSpecifier = {\n        toolGroupId: this.toolGroupId,\n        toolName: this.getToolName(),\n        viewportId: enabledElement.viewport.id\n      };\n      for (let i = 0; i < annotations.length; i++) {\n        const annotation = annotations[i];\n        const {\n          annotationUID,\n          data\n        } = annotation;\n        const {\n          points,\n          activeHandleIndex\n        } = data.handles;\n        const canvasCoordinates = points.map(p => viewport.worldToCanvas(p));\n        styleSpecifier.annotationUID = annotationUID;\n        const {\n          color,\n          lineWidth,\n          lineDash\n        } = this.getAnnotationStyle({\n          annotation,\n          styleSpecifier\n        });\n        const {\n          viewPlaneNormal,\n          viewUp\n        } = viewport.getCamera();\n        if (!data.cachedStats[targetId] || data.cachedStats[targetId].areaUnit == null) {\n          data.cachedStats[targetId] = {\n            Modality: null,\n            area: null,\n            max: null,\n            mean: null,\n            stdDev: null,\n            areaUnit: null\n          };\n          this._calculateCachedStats(annotation, viewPlaneNormal, viewUp, renderingEngine, enabledElement);\n        } else if (annotation.invalidated) {\n          this._throttledCalculateCachedStats(annotation, viewPlaneNormal, viewUp, renderingEngine, enabledElement);\n          if (viewport instanceof VolumeViewport) {\n            const {\n              referencedImageId\n            } = annotation.metadata;\n            for (const targetId in data.cachedStats) {\n              if (targetId.startsWith('imageId')) {\n                const viewports = renderingEngine.getStackViewports();\n                const invalidatedStack = viewports.find(vp => {\n                  const referencedImageURI = csUtils.imageIdToURI(referencedImageId);\n                  const hasImageURI = vp.hasImageURI(referencedImageURI);\n                  const currentImageURI = csUtils.imageIdToURI(vp.getCurrentImageId());\n                  return hasImageURI && currentImageURI !== referencedImageURI;\n                });\n                if (invalidatedStack) {\n                  delete data.cachedStats[targetId];\n                }\n              }\n            }\n          }\n        }\n        if (!viewport.getRenderingEngine()) {\n          console.warn('Rendering Engine has been destroyed');\n          return renderStatus;\n        }\n        let activeHandleCanvasCoords;\n        if (!isAnnotationVisible(annotationUID)) {\n          continue;\n        }\n        if (!isAnnotationLocked(annotation) && !this.editData && activeHandleIndex !== null) {\n          activeHandleCanvasCoords = [canvasCoordinates[activeHandleIndex]];\n        }\n        if (activeHandleCanvasCoords) {\n          const handleGroupUID = '0';\n          drawHandlesSvg(svgDrawingHelper, annotationUID, handleGroupUID, activeHandleCanvasCoords, {\n            color\n          });\n        }\n        const dataId = `${annotationUID}-rect`;\n        const rectangleUID = '0';\n        drawRectSvg(svgDrawingHelper, annotationUID, rectangleUID, canvasCoordinates[0], canvasCoordinates[3], {\n          color,\n          lineDash,\n          lineWidth\n        }, dataId);\n        renderStatus = true;\n        const options = this.getLinkedTextBoxStyle(styleSpecifier, annotation);\n        if (!options.visibility) {\n          data.handles.textBox = {\n            hasMoved: false,\n            worldPosition: [0, 0, 0],\n            worldBoundingBox: {\n              topLeft: [0, 0, 0],\n              topRight: [0, 0, 0],\n              bottomLeft: [0, 0, 0],\n              bottomRight: [0, 0, 0]\n            }\n          };\n          continue;\n        }\n        const textLines = this.configuration.getTextLines(data, targetId);\n        if (!textLines || textLines.length === 0) {\n          continue;\n        }\n        if (!data.handles.textBox.hasMoved) {\n          const canvasTextBoxCoords = getTextBoxCoordsCanvas(canvasCoordinates);\n          data.handles.textBox.worldPosition = viewport.canvasToWorld(canvasTextBoxCoords);\n        }\n        const textBoxPosition = viewport.worldToCanvas(data.handles.textBox.worldPosition);\n        const textBoxUID = '1';\n        const boundingBox = drawLinkedTextBoxSvg(svgDrawingHelper, annotationUID, textBoxUID, textLines, textBoxPosition, canvasCoordinates, {}, options);\n        const {\n          x: left,\n          y: top,\n          width,\n          height\n        } = boundingBox;\n        data.handles.textBox.worldBoundingBox = {\n          topLeft: viewport.canvasToWorld([left, top]),\n          topRight: viewport.canvasToWorld([left + width, top]),\n          bottomLeft: viewport.canvasToWorld([left, top + height]),\n          bottomRight: viewport.canvasToWorld([left + width, top + height])\n        };\n      }\n      return renderStatus;\n    };\n    this._getRectangleImageCoordinates = points => {\n      const [point0, point1] = points;\n      return {\n        left: Math.min(point0[0], point1[0]),\n        top: Math.min(point0[1], point1[1]),\n        width: Math.abs(point0[0] - point1[0]),\n        height: Math.abs(point0[1] - point1[1])\n      };\n    };\n    this._calculateCachedStats = (annotation, viewPlaneNormal, viewUp, renderingEngine, enabledElement) => {\n      const {\n        data\n      } = annotation;\n      const {\n        viewportId,\n        renderingEngineId,\n        viewport\n      } = enabledElement;\n      const worldPos1 = data.handles.points[0];\n      const worldPos2 = data.handles.points[3];\n      const {\n        cachedStats\n      } = data;\n      const targetIds = Object.keys(cachedStats);\n      for (let i = 0; i < targetIds.length; i++) {\n        const targetId = targetIds[i];\n        const image = this.getTargetIdImage(targetId, renderingEngine);\n        if (!image) {\n          continue;\n        }\n        const {\n          dimensions,\n          imageData,\n          metadata\n        } = image;\n        const scalarData = 'getScalarData' in image ? image.getScalarData() : image.scalarData;\n        const worldPos1Index = transformWorldToIndex(imageData, worldPos1);\n        worldPos1Index[0] = Math.floor(worldPos1Index[0]);\n        worldPos1Index[1] = Math.floor(worldPos1Index[1]);\n        worldPos1Index[2] = Math.floor(worldPos1Index[2]);\n        const worldPos2Index = transformWorldToIndex(imageData, worldPos2);\n        worldPos2Index[0] = Math.floor(worldPos2Index[0]);\n        worldPos2Index[1] = Math.floor(worldPos2Index[1]);\n        worldPos2Index[2] = Math.floor(worldPos2Index[2]);\n        if (this._isInsideVolume(worldPos1Index, worldPos2Index, dimensions)) {\n          this.isHandleOutsideImage = false;\n          const iMin = Math.min(worldPos1Index[0], worldPos2Index[0]);\n          const iMax = Math.max(worldPos1Index[0], worldPos2Index[0]);\n          const jMin = Math.min(worldPos1Index[1], worldPos2Index[1]);\n          const jMax = Math.max(worldPos1Index[1], worldPos2Index[1]);\n          const kMin = Math.min(worldPos1Index[2], worldPos2Index[2]);\n          const kMax = Math.max(worldPos1Index[2], worldPos2Index[2]);\n          const boundsIJK = [[iMin, iMax], [jMin, jMax], [kMin, kMax]];\n          const {\n            worldWidth,\n            worldHeight\n          } = getWorldWidthAndHeightFromCorners(viewPlaneNormal, viewUp, worldPos1, worldPos2);\n          const scale = getCalibratedScale(image);\n          const area = Math.abs(worldWidth * worldHeight) / (scale * scale);\n          const modalityUnitOptions = {\n            isPreScaled: isViewportPreScaled(viewport, targetId),\n            isSuvScaled: this.isSuvScaled(viewport, targetId, annotation.metadata.referencedImageId)\n          };\n          const modalityUnit = getModalityUnit(metadata.Modality, annotation.metadata.referencedImageId, modalityUnitOptions);\n          const pointsInShape = pointInShapeCallback(imageData, () => true, this.configuration.statsCalculator.statsCallback, boundsIJK);\n          const stats = this.configuration.statsCalculator.getStatistics();\n          cachedStats[targetId] = {\n            Modality: metadata.Modality,\n            area,\n            mean: stats[1]?.value,\n            stdDev: stats[2]?.value,\n            max: stats[0]?.value,\n            statsArray: stats,\n            pointsInShape: pointsInShape,\n            areaUnit: getCalibratedAreaUnits(null, image),\n            modalityUnit\n          };\n        } else {\n          this.isHandleOutsideImage = true;\n          cachedStats[targetId] = {\n            Modality: metadata.Modality\n          };\n        }\n      }\n      annotation.invalidated = false;\n      const eventType = Events.ANNOTATION_MODIFIED;\n      const eventDetail = {\n        annotation,\n        viewportId,\n        renderingEngineId\n      };\n      triggerEvent(eventTarget, eventType, eventDetail);\n      return cachedStats;\n    };\n    this._isInsideVolume = (index1, index2, dimensions) => {\n      return csUtils.indexWithinDimensions(index1, dimensions) && csUtils.indexWithinDimensions(index2, dimensions);\n    };\n    this._throttledCalculateCachedStats = throttle(this._calculateCachedStats, 100, {\n      trailing: true\n    });\n  }\n}\nfunction defaultGetTextLines(data, targetId) {\n  const cachedVolumeStats = data.cachedStats[targetId];\n  const {\n    area,\n    mean,\n    max,\n    stdDev,\n    areaUnit,\n    modalityUnit\n  } = cachedVolumeStats;\n  if (mean === undefined) {\n    return;\n  }\n  const textLines = [];\n  textLines.push(`Area: ${roundNumber(area)} ${areaUnit}`);\n  textLines.push(`Mean: ${roundNumber(mean)} ${modalityUnit}`);\n  textLines.push(`Max: ${roundNumber(max)} ${modalityUnit}`);\n  textLines.push(`Std Dev: ${roundNumber(stdDev)} ${modalityUnit}`);\n  return textLines;\n}\nRectangleROITool.toolName = 'RectangleROI';\nexport default RectangleROITool;","map":{"version":3,"names":["AnnotationTool","getEnabledElement","VolumeViewport","triggerEvent","eventTarget","utilities","csUtils","getCalibratedAreaUnits","getCalibratedScale","roundNumber","throttle","addAnnotation","getAnnotations","removeAnnotation","isAnnotationLocked","isAnnotationVisible","drawHandles","drawHandlesSvg","drawLinkedTextBox","drawLinkedTextBoxSvg","drawRect","drawRectSvg","state","Events","getViewportIdsWithToolToRender","rectangle","getTextBoxCoordsCanvas","getWorldWidthAndHeightFromCorners","resetElementCursor","hideElementCursor","triggerAnnotationRenderForViewportIds","getModalityUnit","isViewportPreScaled","pointInShapeCallback","BasicStatsCalculator","transformWorldToIndex","RectangleROITool","constructor","toolProps","defaultToolProps","supportedInteractionTypes","configuration","shadow","preventHandleOutsideImage","getTextLines","defaultGetTextLines","statsCalculator","addNewAnnotation","evt","eventDetail","detail","currentPoints","element","worldPos","world","enabledElement","viewport","renderingEngine","isDrawing","camera","getCamera","viewPlaneNormal","viewUp","referencedImageId","getReferencedImageId","FrameOfReferenceUID","getFrameOfReferenceUID","annotation","invalidated","highlighted","metadata","toolName","getToolName","data","label","handles","points","textBox","hasMoved","worldPosition","worldBoundingBox","topLeft","topRight","bottomLeft","bottomRight","activeHandleIndex","cachedStats","viewportIdsToRender","editData","handleIndex","movingTextBox","newAnnotation","_activateDraw","preventDefault","isPointNearTool","canvasCoords","proximity","canvasPoint1","worldToCanvas","canvasPoint2","rect","_getRectangleImageCoordinates","point","left","top","width","height","distanceToPoint","toolSelectedCallback","_activateModify","handleSelectedCallback","handle","findIndex","p","_endCallback","_deactivateModify","_deactivateDraw","isHandleOutsideImage","annotationUID","eventType","ANNOTATION_COMPLETED","_dragCallback","deltaPoints","worldPosDelta","undefined","forEach","canvasToWorld","bottomLeftCanvas","bottomRightCanvas","topLeftCanvas","topRightCanvas","bottomLeftWorld","bottomRightWorld","topLeftWorld","topRightWorld","cancel","isInteractingWithTool","addEventListener","MOUSE_UP","MOUSE_DRAG","MOUSE_MOVE","MOUSE_CLICK","TOUCH_END","TOUCH_DRAG","TOUCH_TAP","removeEventListener","renderAnnotation","svgDrawingHelper","renderStatus","annotations","length","filterInteractableAnnotationsForElement","targetId","getTargetId","getRenderingEngine","styleSpecifier","toolGroupId","viewportId","id","i","canvasCoordinates","map","color","lineWidth","lineDash","getAnnotationStyle","areaUnit","Modality","area","max","mean","stdDev","_calculateCachedStats","_throttledCalculateCachedStats","startsWith","viewports","getStackViewports","invalidatedStack","find","vp","referencedImageURI","imageIdToURI","hasImageURI","currentImageURI","getCurrentImageId","console","warn","activeHandleCanvasCoords","handleGroupUID","dataId","rectangleUID","options","getLinkedTextBoxStyle","visibility","textLines","canvasTextBoxCoords","textBoxPosition","textBoxUID","boundingBox","x","y","point0","point1","Math","min","abs","renderingEngineId","worldPos1","worldPos2","targetIds","Object","keys","image","getTargetIdImage","dimensions","imageData","scalarData","getScalarData","worldPos1Index","floor","worldPos2Index","_isInsideVolume","iMin","iMax","jMin","jMax","kMin","kMax","boundsIJK","worldWidth","worldHeight","scale","modalityUnitOptions","isPreScaled","isSuvScaled","modalityUnit","pointsInShape","statsCallback","stats","getStatistics","value","statsArray","ANNOTATION_MODIFIED","index1","index2","indexWithinDimensions","trailing","cachedVolumeStats","push"],"sources":["../../../../src/tools/annotation/RectangleROITool.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}