{"ast":null,"code":"import { state } from '../../store';\nimport { ToolModes } from '../../enums';\nimport { setAnnotationSelected, isAnnotationSelected } from '../../stateManagement/annotation/annotationSelection';\nimport { isAnnotationLocked } from '../../stateManagement/annotation/annotationLocking';\nimport { isAnnotationVisible } from '../../stateManagement/annotation/annotationVisibility';\nimport filterToolsWithMoveableHandles from '../../store/filterToolsWithMoveableHandles';\nimport filterToolsWithAnnotationsForElement from '../../store/filterToolsWithAnnotationsForElement';\nimport filterMoveableAnnotationTools from '../../store/filterMoveableAnnotationTools';\nimport getActiveToolForMouseEvent from '../shared/getActiveToolForMouseEvent';\nimport getToolsWithModesForMouseEvent from '../shared/getToolsWithModesForMouseEvent';\nimport mouseDownAnnotationAction from './mouseDownAnnotationAction';\nconst {\n  Active,\n  Passive\n} = ToolModes;\nexport default function mouseDown(evt) {\n  if (state.isInteractingWithTool) {\n    return;\n  }\n  const activeTool = getActiveToolForMouseEvent(evt);\n  if (activeTool && typeof activeTool.preMouseDownCallback === 'function') {\n    const consumedEvent = activeTool.preMouseDownCallback(evt);\n    if (consumedEvent) {\n      return;\n    }\n  }\n  const isPrimaryClick = evt.detail.event.buttons === 1;\n  const activeToolsWithEventBinding = getToolsWithModesForMouseEvent(evt, [Active], evt.detail.event.buttons);\n  const passiveToolsIfEventWasPrimaryMouseButton = isPrimaryClick ? getToolsWithModesForMouseEvent(evt, [Passive]) : undefined;\n  const applicableTools = [...(activeToolsWithEventBinding || []), ...(passiveToolsIfEventWasPrimaryMouseButton || [])];\n  const actionExecuted = mouseDownAnnotationAction(evt);\n  if (actionExecuted) {\n    return;\n  }\n  const eventDetail = evt.detail;\n  const {\n    element\n  } = eventDetail;\n  const annotationToolsWithAnnotations = filterToolsWithAnnotationsForElement(element, applicableTools);\n  const canvasCoords = eventDetail.currentPoints.canvas;\n  const annotationToolsWithMoveableHandles = filterToolsWithMoveableHandles(element, annotationToolsWithAnnotations, canvasCoords, 'mouse');\n  const isMultiSelect = !!evt.detail.event.shiftKey;\n  if (annotationToolsWithMoveableHandles.length > 0) {\n    const {\n      tool,\n      annotation,\n      handle\n    } = getAnnotationForSelection(annotationToolsWithMoveableHandles);\n    toggleAnnotationSelection(annotation.annotationUID, isMultiSelect);\n    tool.handleSelectedCallback(evt, annotation, handle, 'Mouse');\n    return;\n  }\n  const moveableAnnotationTools = filterMoveableAnnotationTools(element, annotationToolsWithAnnotations, canvasCoords, 'mouse');\n  if (moveableAnnotationTools.length > 0) {\n    const {\n      tool,\n      annotation\n    } = getAnnotationForSelection(moveableAnnotationTools);\n    toggleAnnotationSelection(annotation.annotationUID, isMultiSelect);\n    tool.toolSelectedCallback(evt, annotation, 'Mouse', canvasCoords);\n    return;\n  }\n  if (activeTool && typeof activeTool.postMouseDownCallback === 'function') {\n    const consumedEvent = activeTool.postMouseDownCallback(evt);\n    if (consumedEvent) {\n      return;\n    }\n  }\n}\nfunction getAnnotationForSelection(toolsWithMovableHandles) {\n  return toolsWithMovableHandles.length > 1 && toolsWithMovableHandles.find(item => !isAnnotationLocked(item.annotation) && isAnnotationVisible(item.annotation.annotationUID)) || toolsWithMovableHandles[0];\n}\nfunction toggleAnnotationSelection(annotationUID, isMultiSelect = false) {\n  if (isMultiSelect) {\n    if (isAnnotationSelected(annotationUID)) {\n      setAnnotationSelected(annotationUID, false);\n    } else {\n      const preserveSelected = true;\n      setAnnotationSelected(annotationUID, true, preserveSelected);\n    }\n  } else {\n    const preserveSelected = false;\n    setAnnotationSelected(annotationUID, true, preserveSelected);\n  }\n}","map":{"version":3,"names":["state","ToolModes","setAnnotationSelected","isAnnotationSelected","isAnnotationLocked","isAnnotationVisible","filterToolsWithMoveableHandles","filterToolsWithAnnotationsForElement","filterMoveableAnnotationTools","getActiveToolForMouseEvent","getToolsWithModesForMouseEvent","mouseDownAnnotationAction","Active","Passive","mouseDown","evt","isInteractingWithTool","activeTool","preMouseDownCallback","consumedEvent","isPrimaryClick","detail","event","buttons","activeToolsWithEventBinding","passiveToolsIfEventWasPrimaryMouseButton","undefined","applicableTools","actionExecuted","eventDetail","element","annotationToolsWithAnnotations","canvasCoords","currentPoints","canvas","annotationToolsWithMoveableHandles","isMultiSelect","shiftKey","length","tool","annotation","handle","getAnnotationForSelection","toggleAnnotationSelection","annotationUID","handleSelectedCallback","moveableAnnotationTools","toolSelectedCallback","postMouseDownCallback","toolsWithMovableHandles","find","item","preserveSelected"],"sources":["../../../../src/eventDispatchers/mouseEventHandlers/mouseDown.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}