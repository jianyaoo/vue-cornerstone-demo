{"ast":null,"code":"import vtkVolume from '@kitware/vtk.js/Rendering/Core/Volume';\nimport { loadVolume } from '../../loaders/volumeLoader';\nimport createVolumeMapper from './createVolumeMapper';\nimport { triggerEvent } from '../../utilities';\nimport { Events } from '../../enums';\nimport setDefaultVolumeVOI from './setDefaultVolumeVOI';\nasync function createVolumeActor(props, element, viewportId, suppressEvents = false, useNativeDataType = false) {\n  const {\n    volumeId,\n    callback,\n    blendMode\n  } = props;\n  const imageVolume = await loadVolume(volumeId);\n  if (!imageVolume) {\n    throw new Error(`imageVolume with id: ${imageVolume.volumeId} does not exist`);\n  }\n  const {\n    imageData,\n    vtkOpenGLTexture\n  } = imageVolume;\n  const volumeMapper = createVolumeMapper(imageData, vtkOpenGLTexture);\n  if (blendMode) {\n    volumeMapper.setBlendMode(blendMode);\n  }\n  const volumeActor = vtkVolume.newInstance();\n  volumeActor.setMapper(volumeMapper);\n  const numberOfComponents = imageData.getPointData().getScalars().getNumberOfComponents();\n  if (numberOfComponents === 3) {\n    volumeActor.getProperty().setIndependentComponents(false);\n  }\n  if (imageVolume.imageIds?.length) {\n    await setDefaultVolumeVOI(volumeActor, imageVolume, useNativeDataType);\n  }\n  if (callback) {\n    callback({\n      volumeActor,\n      volumeId\n    });\n  }\n  if (!suppressEvents) {\n    triggerVOIModified(element, viewportId, volumeActor, volumeId);\n  }\n  return volumeActor;\n}\nfunction triggerVOIModified(element, viewportId, volumeActor, volumeId) {\n  const voiRange = volumeActor.getProperty().getRGBTransferFunction(0).getRange();\n  const voiModifiedEventDetail = {\n    viewportId,\n    range: {\n      lower: voiRange[0],\n      upper: voiRange[1]\n    },\n    volumeId\n  };\n  triggerEvent(element, Events.VOI_MODIFIED, voiModifiedEventDetail);\n}\nexport default createVolumeActor;","map":{"version":3,"names":["vtkVolume","loadVolume","createVolumeMapper","triggerEvent","Events","setDefaultVolumeVOI","createVolumeActor","props","element","viewportId","suppressEvents","useNativeDataType","volumeId","callback","blendMode","imageVolume","Error","imageData","vtkOpenGLTexture","volumeMapper","setBlendMode","volumeActor","newInstance","setMapper","numberOfComponents","getPointData","getScalars","getNumberOfComponents","getProperty","setIndependentComponents","imageIds","length","triggerVOIModified","voiRange","getRGBTransferFunction","getRange","voiModifiedEventDetail","range","lower","upper","VOI_MODIFIED"],"sources":["../../../../src/RenderingEngine/helpers/createVolumeActor.ts"],"sourcesContent":[null],"mappings":"AAAA,OAAOA,SAAS,MAAM,uCAAuC;AAI7D,SAASC,UAAU,QAAQ,4BAA4B;AACvD,OAAOC,kBAAkB,MAAM,sBAAsB;AAErD,SAASC,YAAY,QAAQ,iBAAiB;AAC9C,SAASC,MAAM,QAAQ,aAAa;AACpC,OAAOC,mBAAmB,MAAM,uBAAuB;AAsBvD,eAAeC,iBAAiBA,CAC9BC,KAAiC,EACjCC,OAAuB,EACvBC,UAAkB,EAClBC,cAAc,GAAG,KAAK,EACtBC,iBAAiB,GAAG,KAAK;EAEzB,MAAM;IAAEC,QAAQ;IAAEC,QAAQ;IAAEC;EAAS,CAAE,GAAGP,KAAK;EAE/C,MAAMQ,WAAW,GAAG,MAAMd,UAAU,CAACW,QAAQ,CAAC;EAE9C,IAAI,CAACG,WAAW,EAAE;IAChB,MAAM,IAAIC,KAAK,CACb,wBAAwBD,WAAW,CAACH,QAAQ,iBAAiB,CAC9D;;EAGH,MAAM;IAAEK,SAAS;IAAEC;EAAgB,CAAE,GAAGH,WAAW;EAEnD,MAAMI,YAAY,GAAGjB,kBAAkB,CAACe,SAAS,EAAEC,gBAAgB,CAAC;EAEpE,IAAIJ,SAAS,EAAE;IACbK,YAAY,CAACC,YAAY,CAACN,SAAS,CAAC;;EAGtC,MAAMO,WAAW,GAAGrB,SAAS,CAACsB,WAAW,EAAE;EAC3CD,WAAW,CAACE,SAAS,CAACJ,YAAY,CAAC;EAEnC,MAAMK,kBAAkB,GAAGP,SAAS,CACjCQ,YAAY,EAAE,CACdC,UAAU,EAAE,CACZC,qBAAqB,EAAE;EAE1B,IAAIH,kBAAkB,KAAK,CAAC,EAAE;IAC5BH,WAAW,CAACO,WAAW,EAAE,CAACC,wBAAwB,CAAC,KAAK,CAAC;;EAO3D,IAAId,WAAW,CAACe,QAAQ,EAAEC,MAAM,EAAE;IAChC,MAAM1B,mBAAmB,CAACgB,WAAW,EAAEN,WAAW,EAAEJ,iBAAiB,CAAC;;EAGxE,IAAIE,QAAQ,EAAE;IACZA,QAAQ,CAAC;MAAEQ,WAAW;MAAET;IAAQ,CAAE,CAAC;;EAGrC,IAAI,CAACF,cAAc,EAAE;IACnBsB,kBAAkB,CAACxB,OAAO,EAAEC,UAAU,EAAEY,WAAW,EAAET,QAAQ,CAAC;;EAGhE,OAAOS,WAAW;AACpB;AAEA,SAASW,kBAAkBA,CACzBxB,OAAuB,EACvBC,UAAkB,EAClBY,WAAwB,EACxBT,QAAgB;EAEhB,MAAMqB,QAAQ,GAAGZ,WAAW,CACzBO,WAAW,EAAE,CACbM,sBAAsB,CAAC,CAAC,CAAC,CACzBC,QAAQ,EAAE;EAEb,MAAMC,sBAAsB,GAA2B;IACrD3B,UAAU;IACV4B,KAAK,EAAE;MACLC,KAAK,EAAEL,QAAQ,CAAC,CAAC,CAAC;MAClBM,KAAK,EAAEN,QAAQ,CAAC,CAAC;KAClB;IACDrB;GACD;EAEDT,YAAY,CAACK,OAAO,EAAEJ,MAAM,CAACoC,YAAY,EAAEJ,sBAAsB,CAAC;AACpE;AAEA,eAAe9B,iBAAiB"},"metadata":{},"sourceType":"module","externalDependencies":[]}