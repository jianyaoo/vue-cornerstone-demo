{"ast":null,"code":"import vtkColorTransferFunction from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction';\nimport vtkPiecewiseFunction from '@kitware/vtk.js/Common/DataModel/PiecewiseFunction';\nexport default function applyPreset(actor, preset) {\n  const colorTransferArray = preset.colorTransfer.split(' ').splice(1).map(parseFloat);\n  const {\n    shiftRange\n  } = getShiftRange(colorTransferArray);\n  const min = shiftRange[0];\n  const width = shiftRange[1] - shiftRange[0];\n  const cfun = vtkColorTransferFunction.newInstance();\n  const normColorTransferValuePoints = [];\n  for (let i = 0; i < colorTransferArray.length; i += 4) {\n    let value = colorTransferArray[i];\n    const r = colorTransferArray[i + 1];\n    const g = colorTransferArray[i + 2];\n    const b = colorTransferArray[i + 3];\n    value = (value - min) / width;\n    normColorTransferValuePoints.push([value, r, g, b]);\n  }\n  applyPointsToRGBFunction(normColorTransferValuePoints, shiftRange, cfun);\n  actor.getProperty().setRGBTransferFunction(0, cfun);\n  const scalarOpacityArray = preset.scalarOpacity.split(' ').splice(1).map(parseFloat);\n  const ofun = vtkPiecewiseFunction.newInstance();\n  const normPoints = [];\n  for (let i = 0; i < scalarOpacityArray.length; i += 2) {\n    let value = scalarOpacityArray[i];\n    const opacity = scalarOpacityArray[i + 1];\n    value = (value - min) / width;\n    normPoints.push([value, opacity]);\n  }\n  applyPointsToPiecewiseFunction(normPoints, shiftRange, ofun);\n  actor.getProperty().setScalarOpacity(0, ofun);\n  const [gradientMinValue, gradientMinOpacity, gradientMaxValue, gradientMaxOpacity] = preset.gradientOpacity.split(' ').splice(1).map(parseFloat);\n  actor.getProperty().setUseGradientOpacity(0, true);\n  actor.getProperty().setGradientOpacityMinimumValue(0, gradientMinValue);\n  actor.getProperty().setGradientOpacityMinimumOpacity(0, gradientMinOpacity);\n  actor.getProperty().setGradientOpacityMaximumValue(0, gradientMaxValue);\n  actor.getProperty().setGradientOpacityMaximumOpacity(0, gradientMaxOpacity);\n  if (preset.interpolation === '1') {\n    actor.getProperty().setInterpolationTypeToFastLinear();\n  }\n  const ambient = parseFloat(preset.ambient);\n  const diffuse = parseFloat(preset.diffuse);\n  const specular = parseFloat(preset.specular);\n  const specularPower = parseFloat(preset.specularPower);\n  actor.getProperty().setAmbient(ambient);\n  actor.getProperty().setDiffuse(diffuse);\n  actor.getProperty().setSpecular(specular);\n  actor.getProperty().setSpecularPower(specularPower);\n}\nfunction getShiftRange(colorTransferArray) {\n  let min = Infinity;\n  let max = -Infinity;\n  for (let i = 0; i < colorTransferArray.length; i += 4) {\n    min = Math.min(min, colorTransferArray[i]);\n    max = Math.max(max, colorTransferArray[i]);\n  }\n  const center = (max - min) / 2;\n  return {\n    shiftRange: [-center, center],\n    min,\n    max\n  };\n}\nfunction applyPointsToRGBFunction(points, range, cfun) {\n  const width = range[1] - range[0];\n  const rescaled = points.map(([x, r, g, b]) => [x * width + range[0], r, g, b]);\n  cfun.removeAllPoints();\n  rescaled.forEach(([x, r, g, b]) => cfun.addRGBPoint(x, r, g, b));\n  return rescaled;\n}\nfunction applyPointsToPiecewiseFunction(points, range, pwf) {\n  const width = range[1] - range[0];\n  const rescaled = points.map(([x, y]) => [x * width + range[0], y]);\n  pwf.removeAllPoints();\n  rescaled.forEach(([x, y]) => pwf.addPoint(x, y));\n  return rescaled;\n}","map":{"version":3,"names":["vtkColorTransferFunction","vtkPiecewiseFunction","applyPreset","actor","preset","colorTransferArray","colorTransfer","split","splice","map","parseFloat","shiftRange","getShiftRange","min","width","cfun","newInstance","normColorTransferValuePoints","i","length","value","r","g","b","push","applyPointsToRGBFunction","getProperty","setRGBTransferFunction","scalarOpacityArray","scalarOpacity","ofun","normPoints","opacity","applyPointsToPiecewiseFunction","setScalarOpacity","gradientMinValue","gradientMinOpacity","gradientMaxValue","gradientMaxOpacity","gradientOpacity","setUseGradientOpacity","setGradientOpacityMinimumValue","setGradientOpacityMinimumOpacity","setGradientOpacityMaximumValue","setGradientOpacityMaximumOpacity","interpolation","setInterpolationTypeToFastLinear","ambient","diffuse","specular","specularPower","setAmbient","setDiffuse","setSpecular","setSpecularPower","Infinity","max","Math","center","points","range","rescaled","x","removeAllPoints","forEach","addRGBPoint","pwf","y","addPoint"],"sources":["../../../src/utilities/applyPreset.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}