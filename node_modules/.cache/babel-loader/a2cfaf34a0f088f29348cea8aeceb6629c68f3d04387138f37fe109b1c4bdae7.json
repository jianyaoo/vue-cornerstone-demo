{"ast":null,"code":"import { state } from '../store';\nimport { getEnabledElement } from '@cornerstonejs/core';\nconst VIEWPORT_ELEMENT = 'viewport-element';\nfunction getSvgDrawingHelper(element) {\n  const enabledElement = getEnabledElement(element);\n  const {\n    viewportId,\n    renderingEngineId\n  } = enabledElement;\n  const canvasHash = `${viewportId}:${renderingEngineId}`;\n  const svgLayerElement = _getSvgLayer(element);\n  Object.keys(state.svgNodeCache[canvasHash]).forEach(cacheKey => {\n    state.svgNodeCache[canvasHash][cacheKey].touched = false;\n  });\n  return {\n    svgLayerElement: svgLayerElement,\n    svgNodeCacheForCanvas: state.svgNodeCache,\n    getSvgNode: getSvgNode.bind(this, canvasHash),\n    appendNode: appendNode.bind(this, svgLayerElement, canvasHash),\n    setNodeTouched: setNodeTouched.bind(this, canvasHash),\n    clearUntouched: clearUntouched.bind(this, svgLayerElement, canvasHash)\n  };\n}\nfunction _getSvgLayer(element) {\n  const viewportElement = `.${VIEWPORT_ELEMENT}`;\n  const internalDivElement = element.querySelector(viewportElement);\n  const svgLayer = internalDivElement.querySelector(':scope > .svg-layer');\n  return svgLayer;\n}\nfunction getSvgNode(canvasHash, cacheKey) {\n  if (!state.svgNodeCache[canvasHash]) {\n    return;\n  }\n  if (state.svgNodeCache[canvasHash][cacheKey]) {\n    return state.svgNodeCache[canvasHash][cacheKey].domRef;\n  }\n}\nfunction appendNode(svgLayerElement, canvasHash, svgNode, cacheKey) {\n  if (!state.svgNodeCache[canvasHash]) {\n    return null;\n  }\n  state.svgNodeCache[canvasHash][cacheKey] = {\n    touched: true,\n    domRef: svgNode\n  };\n  svgLayerElement.appendChild(svgNode);\n}\nfunction setNodeTouched(canvasHash, cacheKey) {\n  if (!state.svgNodeCache[canvasHash]) {\n    return;\n  }\n  if (state.svgNodeCache[canvasHash][cacheKey]) {\n    state.svgNodeCache[canvasHash][cacheKey].touched = true;\n  }\n}\nfunction clearUntouched(svgLayerElement, canvasHash) {\n  if (!state.svgNodeCache[canvasHash]) {\n    return;\n  }\n  Object.keys(state.svgNodeCache[canvasHash]).forEach(cacheKey => {\n    const cacheEntry = state.svgNodeCache[canvasHash][cacheKey];\n    if (!cacheEntry.touched && cacheEntry.domRef) {\n      svgLayerElement.removeChild(cacheEntry.domRef);\n      delete state.svgNodeCache[canvasHash][cacheKey];\n    }\n  });\n}\nexport default getSvgDrawingHelper;","map":{"version":3,"names":["state","getEnabledElement","VIEWPORT_ELEMENT","getSvgDrawingHelper","element","enabledElement","viewportId","renderingEngineId","canvasHash","svgLayerElement","_getSvgLayer","Object","keys","svgNodeCache","forEach","cacheKey","touched","svgNodeCacheForCanvas","getSvgNode","bind","appendNode","setNodeTouched","clearUntouched","viewportElement","internalDivElement","querySelector","svgLayer","domRef","svgNode","appendChild","cacheEntry","removeChild"],"sources":["../../../src/drawingSvg/getSvgDrawingHelper.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}