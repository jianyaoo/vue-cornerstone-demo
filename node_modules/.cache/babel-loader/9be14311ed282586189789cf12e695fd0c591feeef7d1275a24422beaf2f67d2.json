{"ast":null,"code":"import { vec3 } from 'gl-matrix';\nimport * as metaData from '../metaData';\nimport getSpacingInNormalDirection from './getSpacingInNormalDirection';\nimport { EPSILON } from '../constants';\nexport default function getClosestImageId(imageVolume, worldPos, viewPlaneNormal) {\n  if (!imageVolume) {\n    return;\n  }\n  const {\n    direction,\n    imageIds\n  } = imageVolume;\n  if (!imageIds || !imageIds.length) {\n    return;\n  }\n  const kVector = direction.slice(6, 9);\n  const dotProducts = vec3.dot(kVector, viewPlaneNormal);\n  if (Math.abs(dotProducts) < 1 - EPSILON) {\n    return;\n  }\n  const spacingInNormalDirection = getSpacingInNormalDirection(imageVolume, viewPlaneNormal);\n  const halfSpacingInNormalDirection = spacingInNormalDirection / 2;\n  let imageIdForTool;\n  for (let i = 0; i < imageIds.length; i++) {\n    const imageId = imageIds[i];\n    const {\n      imagePositionPatient\n    } = metaData.get('imagePlaneModule', imageId);\n    const dir = vec3.create();\n    vec3.sub(dir, worldPos, imagePositionPatient);\n    const dot = vec3.dot(dir, viewPlaneNormal);\n    if (Math.abs(dot) < halfSpacingInNormalDirection) {\n      imageIdForTool = imageId;\n    }\n  }\n  return imageIdForTool;\n}","map":{"version":3,"names":["vec3","metaData","getSpacingInNormalDirection","EPSILON","getClosestImageId","imageVolume","worldPos","viewPlaneNormal","direction","imageIds","length","kVector","slice","dotProducts","dot","Math","abs","spacingInNormalDirection","halfSpacingInNormalDirection","imageIdForTool","i","imageId","imagePositionPatient","get","dir","create","sub"],"sources":["../../../src/utilities/getClosestImageId.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,IAAI,QAAQ,WAAW;AAChC,OAAO,KAAKC,QAAQ,MAAM,aAAa;AAGvC,OAAOC,2BAA2B,MAAM,+BAA+B;AACvE,SAASC,OAAO,QAAQ,cAAc;AAYtC,eAAc,SAAUC,iBAAiBA,CACvCC,WAAyB,EACzBC,QAAgB,EAChBC,eAAuB;EAEvB,IAAI,CAACF,WAAW,EAAE;IAChB;;EAGF,MAAM;IAAEG,SAAS;IAAEC;EAAQ,CAAE,GAAGJ,WAAW;EAE3C,IAAI,CAACI,QAAQ,IAAI,CAACA,QAAQ,CAACC,MAAM,EAAE;IACjC;;EAIF,MAAMC,OAAO,GAAGH,SAAS,CAACI,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;EAGrC,MAAMC,WAAW,GAAGb,IAAI,CAACc,GAAG,CAACH,OAAiB,EAAQJ,eAAe,CAAC;EAItE,IAAIQ,IAAI,CAACC,GAAG,CAACH,WAAW,CAAC,GAAG,CAAC,GAAGV,OAAO,EAAE;IACvC;;EAKF,MAAMc,wBAAwB,GAAGf,2BAA2B,CAC1DG,WAAW,EACXE,eAAe,CAChB;EAED,MAAMW,4BAA4B,GAAGD,wBAAwB,GAAG,CAAC;EAIjE,IAAIE,cAAc;EAClB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGX,QAAQ,CAACC,MAAM,EAAEU,CAAC,EAAE,EAAE;IACxC,MAAMC,OAAO,GAAGZ,QAAQ,CAACW,CAAC,CAAC;IAG3B,MAAM;MAAEE;IAAoB,CAAE,GAAGrB,QAAQ,CAACsB,GAAG,CAAC,kBAAkB,EAAEF,OAAO,CAAC;IAI1E,MAAMG,GAAG,GAAGxB,IAAI,CAACyB,MAAM,EAAE;IACzBzB,IAAI,CAAC0B,GAAG,CAACF,GAAG,EAAElB,QAAQ,EAAEgB,oBAAoB,CAAC;IAI7C,MAAMR,GAAG,GAAGd,IAAI,CAACc,GAAG,CAACU,GAAG,EAAEjB,eAAe,CAAC;IAG1C,IAAIQ,IAAI,CAACC,GAAG,CAACF,GAAG,CAAC,GAAGI,4BAA4B,EAAE;MAChDC,cAAc,GAAGE,OAAO;;;EAI5B,OAAOF,cAAc;AACvB"},"metadata":{},"sourceType":"module","externalDependencies":[]}