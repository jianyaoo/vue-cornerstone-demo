{"ast":null,"code":"import { eventTarget, triggerEvent } from '@cornerstonejs/core';\nimport { getAnnotation } from './annotationState';\nimport { Events } from '../../enums';\nimport { isAnnotationSelected, deselectAnnotation } from './annotationSelection';\nconst globalHiddenAnnotationUIDsSet = new Set();\nfunction setAnnotationVisibility(annotationUID, visible = true) {\n  const detail = makeEventDetail();\n  if (annotationUID) {\n    if (visible) {\n      show(annotationUID, globalHiddenAnnotationUIDsSet, detail);\n    } else {\n      hide(annotationUID, globalHiddenAnnotationUIDsSet, detail);\n    }\n  }\n  publish(detail);\n}\nfunction showAllAnnotations() {\n  const detail = makeEventDetail();\n  globalHiddenAnnotationUIDsSet.forEach(annotationUID => {\n    show(annotationUID, globalHiddenAnnotationUIDsSet, detail);\n  });\n  publish(detail);\n}\nfunction isAnnotationVisible(annotationUID) {\n  const annotation = getAnnotation(annotationUID);\n  if (annotation) {\n    return !globalHiddenAnnotationUIDsSet.has(annotationUID);\n  }\n}\nfunction checkAndDefineIsVisibleProperty(annotation) {\n  if (annotation) {\n    const isVisible = annotation.isVisible ?? true;\n    if (shouldDefineIsVisibleProperty(annotation)) {\n      Object.defineProperty(annotation, 'isVisible', {\n        configurable: false,\n        enumerable: true,\n        set: setIsVisible,\n        get: getIsVisible\n      });\n    }\n    setAnnotationVisibility(annotation.annotationUID, isVisible);\n  }\n}\nfunction makeEventDetail() {\n  return Object.freeze({\n    lastVisible: [],\n    lastHidden: [],\n    hidden: []\n  });\n}\nfunction show(annotationUID, annotationUIDsSet, detail) {\n  if (annotationUIDsSet.delete(annotationUID)) {\n    detail.lastVisible.push(annotationUID);\n  }\n}\nfunction hide(annotationUID, annotationUIDsSet, detail) {\n  if (!annotationUIDsSet.has(annotationUID)) {\n    annotationUIDsSet.add(annotationUID);\n    if (isAnnotationSelected(annotationUID)) {\n      deselectAnnotation(annotationUID);\n    }\n    detail.lastHidden.push(annotationUID);\n  }\n}\nfunction publish(detail) {\n  if (detail.lastHidden.length > 0 || detail.lastVisible.length > 0) {\n    globalHiddenAnnotationUIDsSet.forEach(item => void detail.hidden.push(item));\n    triggerEvent(eventTarget, Events.ANNOTATION_VISIBILITY_CHANGE, detail);\n  }\n}\nfunction shouldDefineIsVisibleProperty(annotation) {\n  const descriptor = Object.getOwnPropertyDescriptor(annotation, 'isVisible');\n  if (descriptor) {\n    return descriptor.configurable && (descriptor.set !== setIsVisible || descriptor.get !== getIsVisible);\n  }\n  return Object.isExtensible(annotation);\n}\nfunction setIsVisible(hidden) {\n  setAnnotationVisibility(this.annotationUID, hidden);\n}\nfunction getIsVisible() {\n  return isAnnotationVisible(this.annotationUID);\n}\nexport { setAnnotationVisibility, showAllAnnotations, isAnnotationVisible, checkAndDefineIsVisibleProperty };","map":{"version":3,"names":["eventTarget","triggerEvent","getAnnotation","Events","isAnnotationSelected","deselectAnnotation","globalHiddenAnnotationUIDsSet","Set","setAnnotationVisibility","annotationUID","visible","detail","makeEventDetail","show","hide","publish","showAllAnnotations","forEach","isAnnotationVisible","annotation","has","checkAndDefineIsVisibleProperty","isVisible","shouldDefineIsVisibleProperty","Object","defineProperty","configurable","enumerable","set","setIsVisible","get","getIsVisible","freeze","lastVisible","lastHidden","hidden","annotationUIDsSet","delete","push","add","length","item","ANNOTATION_VISIBILITY_CHANGE","descriptor","getOwnPropertyDescriptor","isExtensible"],"sources":["../../../../src/stateManagement/annotation/annotationVisibility.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}