{"ast":null,"code":"import { getEnabledElement } from '@cornerstonejs/core';\nimport { getAnnotations } from '../stateManagement/annotation/annotationState';\nimport * as ToolGroupManager from '../store/ToolGroupManager';\nfunction getAnnotationNearPoint(element, canvasPoint, proximity = 5) {\n  const enabledElement = getEnabledElement(element);\n  if (!enabledElement) {\n    throw new Error('getAnnotationNearPoint: enabledElement not found');\n  }\n  return getAnnotationNearPointOnEnabledElement(enabledElement, canvasPoint, proximity);\n}\nfunction getAnnotationNearPointOnEnabledElement(enabledElement, point, proximity) {\n  const {\n    renderingEngineId,\n    viewportId\n  } = enabledElement;\n  const toolGroup = ToolGroupManager.getToolGroupForViewport(viewportId, renderingEngineId);\n  if (!toolGroup) {\n    return null;\n  }\n  const {\n    _toolInstances: tools\n  } = toolGroup;\n  for (const name in tools) {\n    const found = findAnnotationNearPointByTool(tools[name], enabledElement, point, proximity);\n    if (found) {\n      return found;\n    }\n  }\n  return null;\n}\nfunction findAnnotationNearPointByTool(tool, enabledElement, point, proximity) {\n  const {\n    viewport\n  } = enabledElement;\n  const annotations = getAnnotations(tool.constructor.toolName, viewport?.element);\n  const currentId = viewport?.getCurrentImageId?.();\n  if (annotations?.length) {\n    const {\n      element\n    } = enabledElement.viewport;\n    for (const annotation of annotations) {\n      const referencedImageId = annotation.metadata?.referencedImageId;\n      if (currentId && referencedImageId && currentId !== referencedImageId || !tool.isPointNearTool) {\n        continue;\n      }\n      if (tool.isPointNearTool(element, annotation, point, proximity, '') || tool.getHandleNearImagePoint(element, annotation, point, proximity)) {\n        return annotation;\n      }\n    }\n  }\n  return null;\n}\nexport { getAnnotationNearPoint, getAnnotationNearPointOnEnabledElement };","map":{"version":3,"names":["getEnabledElement","getAnnotations","ToolGroupManager","getAnnotationNearPoint","element","canvasPoint","proximity","enabledElement","Error","getAnnotationNearPointOnEnabledElement","point","renderingEngineId","viewportId","toolGroup","getToolGroupForViewport","_toolInstances","tools","name","found","findAnnotationNearPointByTool","tool","viewport","annotations","constructor","toolName","currentId","getCurrentImageId","length","annotation","referencedImageId","metadata","isPointNearTool","getHandleNearImagePoint"],"sources":["../../../src/utilities/getAnnotationNearPoint.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,iBAAiB,QAAQ,qBAAqB;AAKvD,SAASC,cAAc,QAAQ,+CAA+C;AAC9E,OAAO,KAAKC,gBAAgB,MAAM,2BAA2B;AAW7D,SAASC,sBAAsBA,CAC7BC,OAAuB,EACvBC,WAAyB,EACzBC,SAAS,GAAG,CAAC;EAIb,MAAMC,cAAc,GAAGP,iBAAiB,CAACI,OAAO,CAAC;EACjD,IAAI,CAACG,cAAc,EAAE;IACnB,MAAM,IAAIC,KAAK,CAAC,kDAAkD,CAAC;;EAGrE,OAAOC,sCAAsC,CAC3CF,cAAc,EACdF,WAAW,EACXC,SAAS,CACV;AACH;AAYA,SAASG,sCAAsCA,CAC7CF,cAAqC,EACrCG,KAAmB,EACnBJ,SAAiB;EAIjB,MAAM;IAAEK,iBAAiB;IAAEC;EAAU,CAAE,GAAGL,cAAc;EACxD,MAAMM,SAAS,GAAGX,gBAAgB,CAACY,uBAAuB,CACxDF,UAAU,EACVD,iBAAiB,CAClB;EAED,IAAI,CAACE,SAAS,EAAE;IACd,OAAO,IAAI;;EAGb,MAAM;IAAEE,cAAc,EAAEC;EAAK,CAAE,GAAGH,SAAS;EAC3C,KAAK,MAAMI,IAAI,IAAID,KAAK,EAAE;IACxB,MAAME,KAAK,GAAGC,6BAA6B,CACzCH,KAAK,CAACC,IAAI,CAAC,EACXV,cAAc,EACdG,KAAK,EACLJ,SAAS,CACV;IACD,IAAIY,KAAK,EAAE;MACT,OAAOA,KAAK;;;EAIhB,OAAO,IAAI;AACb;AAcA,SAASC,6BAA6BA,CACpCC,IAAoB,EACpBb,cAAqC,EACrCG,KAAmB,EACnBJ,SAAiB;EAKjB,MAAM;IAAEe;EAAQ,CAAE,GAAGd,cAAc;EAEnC,MAAMe,WAAW,GAAGrB,cAAc,CAC/BmB,IAAI,CAACG,WAA+B,CAACC,QAAQ,EAC9CH,QAAQ,EAAEjB,OAAO,CAClB;EACD,MAAMqB,SAAS,GAAGJ,QAAQ,EAAEK,iBAAiB,GAAE,CAAE;EACjD,IAAIJ,WAAW,EAAEK,MAAM,EAAE;IACvB,MAAM;MAAEvB;IAAO,CAAE,GAAGG,cAAc,CAACc,QAAQ;IAC3C,KAAK,MAAMO,UAAU,IAAIN,WAAW,EAAE;MACpC,MAAMO,iBAAiB,GAAGD,UAAU,CAACE,QAAQ,EAAED,iBAAiB;MAChE,IACGJ,SAAS,IAAII,iBAAiB,IAAIJ,SAAS,KAAKI,iBAAiB,IAClE,CAACT,IAAI,CAACW,eAAe,EACrB;QACA;;MAGF,IACEX,IAAI,CAACW,eAAe,CAAC3B,OAAO,EAAEwB,UAAU,EAAElB,KAAK,EAAEJ,SAAS,EAAE,EAAE,CAAC,IAC/Dc,IAAI,CAACY,uBAAuB,CAAC5B,OAAO,EAAEwB,UAAU,EAAElB,KAAK,EAAEJ,SAAS,CAAC,EACnE;QACA,OAAOsB,UAAU;;;;EAIvB,OAAO,IAAI;AACb;AAEA,SAASzB,sBAAsB,EAAEM,sCAAsC"},"metadata":{},"sourceType":"module","externalDependencies":[]}