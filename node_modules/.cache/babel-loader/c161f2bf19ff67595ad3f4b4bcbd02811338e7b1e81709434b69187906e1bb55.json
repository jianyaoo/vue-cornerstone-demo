{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { getEnabledElement, cache, StackViewport, metaData, triggerEvent, eventTarget, utilities as csUtils } from '@cornerstonejs/core';\nimport { vec3 } from 'gl-matrix';\nimport { Events } from '../../enums';\nimport { addAnnotation, getAnnotations } from '../../stateManagement';\nimport { isAnnotationLocked } from '../../stateManagement/annotation/annotationLocking';\nimport { drawHandles as drawHandlesSvg, drawRect as drawRectSvg } from '../../drawingSvg';\nimport { getViewportIdsWithToolToRender } from '../../utilities/viewportFilters';\nimport throttle from '../../utilities/throttle';\nimport { isAnnotationVisible } from '../../stateManagement/annotation/annotationVisibility';\nimport { hideElementCursor } from '../../cursors/elementCursor';\nimport triggerAnnotationRenderForViewportIds from '../../utilities/triggerAnnotationRenderForViewportIds';\nimport RectangleROITool from '../annotation/RectangleROITool';\nconst {\n  transformWorldToIndex\n} = csUtils;\nclass RectangleROIStartEndThresholdTool extends RectangleROITool {\n  constructor(toolProps = {}, defaultToolProps = {\n    configuration: {\n      numSlicesToPropagate: 10\n    }\n  }) {\n    super(toolProps, defaultToolProps);\n    this.addNewAnnotation = evt => {\n      const eventDetail = evt.detail;\n      const {\n        currentPoints,\n        element\n      } = eventDetail;\n      const worldPos = currentPoints.world;\n      const enabledElement = getEnabledElement(element);\n      const {\n        viewport,\n        renderingEngine\n      } = enabledElement;\n      this.isDrawing = true;\n      const camera = viewport.getCamera();\n      const {\n        viewPlaneNormal,\n        viewUp\n      } = camera;\n      let referencedImageId, imageVolume, volumeId;\n      if (viewport instanceof StackViewport) {\n        throw new Error('Stack Viewport Not implemented');\n      } else {\n        const targetId = this.getTargetId(viewport);\n        volumeId = targetId.split('volumeId:')[1];\n        imageVolume = cache.getVolume(volumeId);\n        referencedImageId = csUtils.getClosestImageId(imageVolume, worldPos, viewPlaneNormal);\n      }\n      if (!referencedImageId) {\n        throw new Error('This tool does not work on non-acquisition planes');\n      }\n      const startIndex = viewport.getCurrentImageIdIndex();\n      const spacingInNormal = csUtils.getSpacingInNormalDirection(imageVolume, viewPlaneNormal);\n      const endIndex = this._getEndSliceIndex(imageVolume, worldPos, spacingInNormal, viewPlaneNormal);\n      const FrameOfReferenceUID = viewport.getFrameOfReferenceUID();\n      const annotation = {\n        highlighted: true,\n        invalidated: true,\n        metadata: {\n          viewPlaneNormal: [...viewPlaneNormal],\n          enabledElement,\n          viewUp: [...viewUp],\n          FrameOfReferenceUID,\n          referencedImageId,\n          toolName: this.getToolName(),\n          volumeId,\n          spacingInNormal\n        },\n        data: {\n          label: '',\n          startSlice: startIndex,\n          endSlice: endIndex,\n          cachedStats: {\n            projectionPoints: [],\n            projectionPointsImageIds: [referencedImageId]\n          },\n          handles: {\n            textBox: {\n              hasMoved: false,\n              worldPosition: null,\n              worldBoundingBox: null\n            },\n            points: [[...worldPos], [...worldPos], [...worldPos], [...worldPos]],\n            activeHandleIndex: null\n          },\n          labelmapUID: null\n        }\n      };\n      this._computeProjectionPoints(annotation, imageVolume);\n      addAnnotation(annotation, element);\n      const viewportIdsToRender = getViewportIdsWithToolToRender(element, this.getToolName());\n      this.editData = {\n        annotation,\n        viewportIdsToRender,\n        handleIndex: 3,\n        newAnnotation: true,\n        hasMoved: false\n      };\n      this._activateDraw(element);\n      hideElementCursor(element);\n      evt.preventDefault();\n      triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n      return annotation;\n    };\n    this.renderAnnotation = (enabledElement, svgDrawingHelper) => {\n      let renderStatus = false;\n      const {\n        viewport\n      } = enabledElement;\n      const annotations = getAnnotations(this.getToolName(), viewport.element);\n      if (!annotations?.length) {\n        return renderStatus;\n      }\n      const sliceIndex = viewport.getCurrentImageIdIndex();\n      const styleSpecifier = {\n        toolGroupId: this.toolGroupId,\n        toolName: this.getToolName(),\n        viewportId: enabledElement.viewport.id\n      };\n      for (let i = 0; i < annotations.length; i++) {\n        const annotation = annotations[i];\n        const {\n          annotationUID,\n          data\n        } = annotation;\n        const {\n          startSlice,\n          endSlice\n        } = data;\n        const {\n          points,\n          activeHandleIndex\n        } = data.handles;\n        const canvasCoordinates = points.map(p => viewport.worldToCanvas(p));\n        styleSpecifier.annotationUID = annotationUID;\n        const lineWidth = this.getStyle('lineWidth', styleSpecifier, annotation);\n        const lineDash = this.getStyle('lineDash', styleSpecifier, annotation);\n        const color = this.getStyle('color', styleSpecifier, annotation);\n        if (sliceIndex < Math.min(startSlice, endSlice) || sliceIndex > Math.max(startSlice, endSlice)) {\n          continue;\n        }\n        if (annotation.invalidated) {\n          this._throttledCalculateCachedStats(annotation, enabledElement);\n        }\n        let firstOrLastSlice = false;\n        if (sliceIndex === startSlice || sliceIndex === endSlice) {\n          firstOrLastSlice = true;\n        }\n        if (!viewport.getRenderingEngine()) {\n          console.warn('Rendering Engine has been destroyed');\n          return renderStatus;\n        }\n        let activeHandleCanvasCoords;\n        if (!isAnnotationVisible(annotationUID)) {\n          continue;\n        }\n        if (!isAnnotationLocked(annotation) && !this.editData && activeHandleIndex !== null && firstOrLastSlice) {\n          activeHandleCanvasCoords = [canvasCoordinates[activeHandleIndex]];\n        }\n        if (activeHandleCanvasCoords) {\n          const handleGroupUID = '0';\n          drawHandlesSvg(svgDrawingHelper, annotationUID, handleGroupUID, activeHandleCanvasCoords, {\n            color\n          });\n        }\n        let lineDashToUse = lineDash;\n        if (!firstOrLastSlice) {\n          lineDashToUse = 2;\n        }\n        const rectangleUID = '0';\n        drawRectSvg(svgDrawingHelper, annotationUID, rectangleUID, canvasCoordinates[0], canvasCoordinates[3], {\n          color,\n          lineDash: lineDashToUse,\n          lineWidth\n        });\n        renderStatus = true;\n      }\n      return renderStatus;\n    };\n    this._throttledCalculateCachedStats = throttle(this._calculateCachedStatsTool, 100, {\n      trailing: true\n    });\n  }\n  _computeProjectionPoints(annotation, imageVolume) {\n    const {\n      data,\n      metadata\n    } = annotation;\n    const {\n      viewPlaneNormal,\n      spacingInNormal\n    } = metadata;\n    const {\n      imageData\n    } = imageVolume;\n    const {\n      startSlice,\n      endSlice\n    } = data;\n    const {\n      points\n    } = data.handles;\n    const startIJK = transformWorldToIndex(imageData, points[0]);\n    if (startIJK[2] !== startSlice) {\n      throw new Error('Start slice does not match');\n    }\n    const endIJK = vec3.fromValues(startIJK[0], startIJK[1], endSlice);\n    const startWorld = vec3.create();\n    imageData.indexToWorldVec3(startIJK, startWorld);\n    const endWorld = vec3.create();\n    imageData.indexToWorldVec3(endIJK, endWorld);\n    const distance = vec3.distance(startWorld, endWorld);\n    const newProjectionPoints = [];\n    for (let dist = 0; dist < distance; dist += spacingInNormal) {\n      newProjectionPoints.push(points.map(point => {\n        const newPoint = vec3.create();\n        vec3.scaleAndAdd(newPoint, point, viewPlaneNormal, dist);\n        return Array.from(newPoint);\n      }));\n    }\n    data.cachedStats.projectionPoints = newProjectionPoints;\n    const projectionPointsImageIds = [];\n    for (const RectanglePoints of newProjectionPoints) {\n      const imageId = csUtils.getClosestImageId(imageVolume, RectanglePoints[0], viewPlaneNormal);\n      projectionPointsImageIds.push(imageId);\n    }\n    data.cachedStats.projectionPointsImageIds = projectionPointsImageIds;\n  }\n  _calculateCachedStatsTool(annotation, enabledElement) {\n    const data = annotation.data;\n    const {\n      viewportId,\n      renderingEngineId,\n      viewport\n    } = enabledElement;\n    const {\n      cachedStats\n    } = data;\n    const volumeId = this.getTargetId(viewport);\n    const imageVolume = cache.getVolume(volumeId.split('volumeId:')[1]);\n    this._computeProjectionPoints(annotation, imageVolume);\n    annotation.invalidated = false;\n    const eventType = Events.ANNOTATION_MODIFIED;\n    const eventDetail = {\n      annotation,\n      viewportId,\n      renderingEngineId\n    };\n    triggerEvent(eventTarget, eventType, eventDetail);\n    return cachedStats;\n  }\n  _getEndSliceIndex(imageVolume, worldPos, spacingInNormal, viewPlaneNormal) {\n    const numSlicesToPropagate = this.configuration.numSlicesToPropagate;\n    const endPos = vec3.create();\n    vec3.scaleAndAdd(endPos, worldPos, viewPlaneNormal, numSlicesToPropagate * spacingInNormal);\n    const halfSpacingInNormalDirection = spacingInNormal / 2;\n    const {\n      imageIds\n    } = imageVolume;\n    let imageIdIndex;\n    for (let i = 0; i < imageIds.length; i++) {\n      const imageId = imageIds[i];\n      const {\n        imagePositionPatient\n      } = metaData.get('imagePlaneModule', imageId);\n      const dir = vec3.create();\n      vec3.sub(dir, endPos, imagePositionPatient);\n      const dot = vec3.dot(dir, viewPlaneNormal);\n      if (Math.abs(dot) < halfSpacingInNormalDirection) {\n        imageIdIndex = i;\n      }\n    }\n    return imageIdIndex;\n  }\n}\nRectangleROIStartEndThresholdTool.toolName = 'RectangleROIStartEndThreshold';\nexport default RectangleROIStartEndThresholdTool;","map":{"version":3,"names":["getEnabledElement","cache","StackViewport","metaData","triggerEvent","eventTarget","utilities","csUtils","vec3","Events","addAnnotation","getAnnotations","isAnnotationLocked","drawHandles","drawHandlesSvg","drawRect","drawRectSvg","getViewportIdsWithToolToRender","throttle","isAnnotationVisible","hideElementCursor","triggerAnnotationRenderForViewportIds","RectangleROITool","transformWorldToIndex","RectangleROIStartEndThresholdTool","constructor","toolProps","defaultToolProps","configuration","numSlicesToPropagate","addNewAnnotation","evt","eventDetail","detail","currentPoints","element","worldPos","world","enabledElement","viewport","renderingEngine","isDrawing","camera","getCamera","viewPlaneNormal","viewUp","referencedImageId","imageVolume","volumeId","Error","targetId","getTargetId","split","getVolume","getClosestImageId","startIndex","getCurrentImageIdIndex","spacingInNormal","getSpacingInNormalDirection","endIndex","_getEndSliceIndex","FrameOfReferenceUID","getFrameOfReferenceUID","annotation","highlighted","invalidated","metadata","toolName","getToolName","data","label","startSlice","endSlice","cachedStats","projectionPoints","projectionPointsImageIds","handles","textBox","hasMoved","worldPosition","worldBoundingBox","points","activeHandleIndex","labelmapUID","_computeProjectionPoints","viewportIdsToRender","editData","handleIndex","newAnnotation","_activateDraw","preventDefault","renderAnnotation","svgDrawingHelper","renderStatus","annotations","length","sliceIndex","styleSpecifier","toolGroupId","viewportId","id","i","annotationUID","canvasCoordinates","map","p","worldToCanvas","lineWidth","getStyle","lineDash","color","Math","min","max","_throttledCalculateCachedStats","firstOrLastSlice","getRenderingEngine","console","warn","activeHandleCanvasCoords","handleGroupUID","lineDashToUse","rectangleUID","_calculateCachedStatsTool","trailing","imageData","startIJK","endIJK","fromValues","startWorld","create","indexToWorldVec3","endWorld","distance","newProjectionPoints","dist","push","point","newPoint","scaleAndAdd","Array","from","RectanglePoints","imageId","renderingEngineId","eventType","ANNOTATION_MODIFIED","endPos","halfSpacingInNormalDirection","imageIds","imageIdIndex","imagePositionPatient","get","dir","sub","dot","abs"],"sources":["../../../../src/tools/segmentation/RectangleROIStartEndThresholdTool.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}