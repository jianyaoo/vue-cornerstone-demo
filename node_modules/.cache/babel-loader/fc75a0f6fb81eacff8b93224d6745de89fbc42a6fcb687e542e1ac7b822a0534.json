{"ast":null,"code":"import { StackViewport, VolumeViewport, VideoViewport, utilities as csUtils } from '@cornerstonejs/core';\nimport filterAnnotationsWithinSlice from './filterAnnotationsWithinSlice';\nimport annotationFrameRange from '../annotationFrameRange';\nconst baseUrlExtractor = /(videoId:|imageId:|volumeId:)([a-zA-Z]*:)/;\nexport default function filterAnnotationsForDisplay(viewport, annotations) {\n  if (viewport instanceof StackViewport) {\n    const imageId = viewport.getCurrentImageId();\n    const colonIndex = imageId.indexOf(':');\n    const imageURI = imageId.substring(colonIndex + 1);\n    return annotations.filter(annotation => {\n      if (!annotation.isVisible) {\n        return false;\n      }\n      const imageId = annotation.metadata.referencedImageId;\n      if (imageId === undefined) {\n        return false;\n      }\n      const colonIndex = imageId.indexOf(':');\n      const referenceImageURI = imageId.substring(colonIndex + 1);\n      return referenceImageURI === imageURI;\n    });\n  } else if (viewport instanceof VideoViewport) {\n    const frameOfReferenceUID = viewport.getFrameOfReferenceUID();\n    return annotations.filter(annotation => {\n      if (!annotation.isVisible) {\n        return false;\n      }\n      if (annotation.metadata.FrameOfReferenceUID !== frameOfReferenceUID) {\n        return false;\n      }\n      const testURI = annotation.metadata.referencedImageId.replace(baseUrlExtractor, '');\n      if (!viewport.hasImageURI(testURI)) {\n        return false;\n      }\n      const range = annotationFrameRange.getFrameRange(annotation);\n      const frameNumber = viewport.getFrameNumber();\n      if (Array.isArray(range)) {\n        return frameNumber >= range[0] && frameNumber <= range[1];\n      }\n      return Math.abs(frameNumber - range) <= 5;\n    });\n  } else if (viewport instanceof VolumeViewport) {\n    const camera = viewport.getCamera();\n    const {\n      spacingInNormalDirection\n    } = csUtils.getTargetVolumeAndSpacingInNormalDir(viewport, camera);\n    return filterAnnotationsWithinSlice(annotations, camera, spacingInNormalDirection);\n  } else {\n    throw new Error(`Viewport Type ${viewport.type} not supported`);\n  }\n}","map":{"version":3,"names":["StackViewport","VolumeViewport","VideoViewport","utilities","csUtils","filterAnnotationsWithinSlice","annotationFrameRange","baseUrlExtractor","filterAnnotationsForDisplay","viewport","annotations","imageId","getCurrentImageId","colonIndex","indexOf","imageURI","substring","filter","annotation","isVisible","metadata","referencedImageId","undefined","referenceImageURI","frameOfReferenceUID","getFrameOfReferenceUID","FrameOfReferenceUID","testURI","replace","hasImageURI","range","getFrameRange","frameNumber","getFrameNumber","Array","isArray","Math","abs","camera","getCamera","spacingInNormalDirection","getTargetVolumeAndSpacingInNormalDir","Error","type"],"sources":["../../../../src/utilities/planar/filterAnnotationsForDisplay.ts"],"sourcesContent":[null],"mappings":"AAAA,SACEA,aAAa,EACbC,cAAc,EACdC,aAAa,EAEbC,SAAS,IAAIC,OAAO,QACf,qBAAqB;AAE5B,OAAOC,4BAA4B,MAAM,gCAAgC;AAEzE,OAAOC,oBAAoB,MAAM,yBAAyB;AAE1D,MAAMC,gBAAgB,GAAG,2CAA2C;AAQpE,eAAc,SAAUC,2BAA2BA,CACjDC,QAAyB,EACzBC,WAAwB;EAExB,IAAID,QAAQ,YAAYT,aAAa,EAAE;IAErC,MAAMW,OAAO,GAAGF,QAAQ,CAACG,iBAAiB,EAAE;IAK5C,MAAMC,UAAU,GAAGF,OAAO,CAACG,OAAO,CAAC,GAAG,CAAC;IACvC,MAAMC,QAAQ,GAAGJ,OAAO,CAACK,SAAS,CAACH,UAAU,GAAG,CAAC,CAAC;IAOlD,OAAOH,WAAW,CAACO,MAAM,CAAEC,UAAU,IAAI;MACvC,IAAI,CAACA,UAAU,CAACC,SAAS,EAAE;QACzB,OAAO,KAAK;;MAGd,MAAMR,OAAO,GAAGO,UAAU,CAACE,QAAQ,CAACC,iBAAiB;MAErD,IAAIV,OAAO,KAAKW,SAAS,EAAE;QAGzB,OAAO,KAAK;;MAGd,MAAMT,UAAU,GAAGF,OAAO,CAACG,OAAO,CAAC,GAAG,CAAC;MACvC,MAAMS,iBAAiB,GAAGZ,OAAO,CAACK,SAAS,CAACH,UAAU,GAAG,CAAC,CAAC;MAC3D,OAAOU,iBAAiB,KAAKR,QAAQ;IACvC,CAAC,CAAC;GACH,MAAM,IAAIN,QAAQ,YAAYP,aAAa,EAAE;IAC5C,MAAMsB,mBAAmB,GAAWf,QAAQ,CAACgB,sBAAsB,EAAE;IAErE,OAAOf,WAAW,CAACO,MAAM,CAAEC,UAAU,IAAI;MACvC,IAAI,CAACA,UAAU,CAACC,SAAS,EAAE;QACzB,OAAO,KAAK;;MAEd,IAAID,UAAU,CAACE,QAAQ,CAACM,mBAAmB,KAAKF,mBAAmB,EAAE;QACnE,OAAO,KAAK;;MAEd,MAAMG,OAAO,GAAGT,UAAU,CAACE,QAAQ,CAACC,iBAAiB,CAACO,OAAO,CAC3DrB,gBAAgB,EAChB,EAAE,CACH;MAED,IAAI,CAACE,QAAQ,CAACoB,WAAW,CAACF,OAAO,CAAC,EAAE;QAClC,OAAO,KAAK;;MAEd,MAAMG,KAAK,GAAGxB,oBAAoB,CAACyB,aAAa,CAACb,UAAU,CAAC;MAC5D,MAAMc,WAAW,GAAGvB,QAAQ,CAACwB,cAAc,EAAE;MAC7C,IAAIC,KAAK,CAACC,OAAO,CAACL,KAAK,CAAC,EAAE;QACxB,OAAOE,WAAW,IAAIF,KAAK,CAAC,CAAC,CAAC,IAAIE,WAAW,IAAIF,KAAK,CAAC,CAAC,CAAC;;MAM3D,OAAOM,IAAI,CAACC,GAAG,CAACL,WAAW,GAAGF,KAAK,CAAC,IAAI,CAAC;IAC3C,CAAC,CAAC;GACH,MAAM,IAAIrB,QAAQ,YAAYR,cAAc,EAAE;IAC7C,MAAMqC,MAAM,GAAG7B,QAAQ,CAAC8B,SAAS,EAAE;IAEnC,MAAM;MAAEC;IAAwB,CAAE,GAChCpC,OAAO,CAACqC,oCAAoC,CAAChC,QAAQ,EAAE6B,MAAM,CAAC;IAGhE,OAAOjC,4BAA4B,CACjCK,WAAW,EACX4B,MAAM,EACNE,wBAAwB,CACzB;GACF,MAAM;IACL,MAAM,IAAIE,KAAK,CAAC,iBAAiBjC,QAAQ,CAACkC,IAAI,gBAAgB,CAAC;;AAEnE"},"metadata":{},"sourceType":"module","externalDependencies":[]}