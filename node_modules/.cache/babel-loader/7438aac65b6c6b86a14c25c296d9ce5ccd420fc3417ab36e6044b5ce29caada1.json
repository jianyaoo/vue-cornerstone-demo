{"ast":null,"code":"import \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport vtkMath from '@kitware/vtk.js/Common/Core/Math';\nimport { getEnabledElement } from '@cornerstonejs/core';\nimport { mat4, vec3 } from 'gl-matrix';\nimport { BaseTool } from './base';\nclass TrackballRotateTool extends BaseTool {\n  constructor(toolProps = {}, defaultToolProps = {\n    supportedInteractionTypes: ['Mouse', 'Touch'],\n    configuration: {\n      rotateIncrementDegrees: 2\n    }\n  }) {\n    super(toolProps, defaultToolProps);\n    this.rotateCamera = (viewport, centerWorld, axis, angle) => {\n      const vtkCamera = viewport.getVtkActiveCamera();\n      const viewUp = vtkCamera.getViewUp();\n      const focalPoint = vtkCamera.getFocalPoint();\n      const position = vtkCamera.getPosition();\n      const newPosition = [0, 0, 0];\n      const newFocalPoint = [0, 0, 0];\n      const newViewUp = [0, 0, 0];\n      const transform = mat4.identity(new Float32Array(16));\n      mat4.translate(transform, transform, centerWorld);\n      mat4.rotate(transform, transform, angle, axis);\n      mat4.translate(transform, transform, [-centerWorld[0], -centerWorld[1], -centerWorld[2]]);\n      vec3.transformMat4(newPosition, position, transform);\n      vec3.transformMat4(newFocalPoint, focalPoint, transform);\n      mat4.identity(transform);\n      mat4.rotate(transform, transform, angle, axis);\n      vec3.transformMat4(newViewUp, viewUp, transform);\n      viewport.setCamera({\n        position: newPosition,\n        viewUp: newViewUp,\n        focalPoint: newFocalPoint\n      });\n    };\n    this.touchDragCallback = this._dragCallback.bind(this);\n    this.mouseDragCallback = this._dragCallback.bind(this);\n  }\n  _dragCallback(evt) {\n    const {\n      element,\n      currentPoints,\n      lastPoints\n    } = evt.detail;\n    const currentPointsCanvas = currentPoints.canvas;\n    const lastPointsCanvas = lastPoints.canvas;\n    const {\n      rotateIncrementDegrees\n    } = this.configuration;\n    const enabledElement = getEnabledElement(element);\n    const {\n      viewport\n    } = enabledElement;\n    const camera = viewport.getCamera();\n    const width = element.clientWidth;\n    const height = element.clientHeight;\n    const normalizedPosition = [currentPointsCanvas[0] / width, currentPointsCanvas[1] / height];\n    const normalizedPreviousPosition = [lastPointsCanvas[0] / width, lastPointsCanvas[1] / height];\n    const center = [width * 0.5, height * 0.5];\n    const centerWorld = viewport.canvasToWorld(center);\n    const normalizedCenter = [0.5, 0.5];\n    const radsq = (1.0 + Math.abs(normalizedCenter[0])) ** 2.0;\n    const op = [normalizedPreviousPosition[0], 0, 0];\n    const oe = [normalizedPosition[0], 0, 0];\n    const opsq = op[0] ** 2;\n    const oesq = oe[0] ** 2;\n    const lop = opsq > radsq ? 0 : Math.sqrt(radsq - opsq);\n    const loe = oesq > radsq ? 0 : Math.sqrt(radsq - oesq);\n    const nop = [op[0], 0, lop];\n    vtkMath.normalize(nop);\n    const noe = [oe[0], 0, loe];\n    vtkMath.normalize(noe);\n    const dot = vtkMath.dot(nop, noe);\n    if (Math.abs(dot) > 0.0001) {\n      const angleX = -2 * Math.acos(vtkMath.clampValue(dot, -1.0, 1.0)) * Math.sign(normalizedPosition[0] - normalizedPreviousPosition[0]) * rotateIncrementDegrees;\n      const upVec = camera.viewUp;\n      const atV = camera.viewPlaneNormal;\n      const rightV = [0, 0, 0];\n      const forwardV = [0, 0, 0];\n      vtkMath.cross(upVec, atV, rightV);\n      vtkMath.normalize(rightV);\n      vtkMath.cross(atV, rightV, forwardV);\n      vtkMath.normalize(forwardV);\n      vtkMath.normalize(upVec);\n      this.rotateCamera(viewport, centerWorld, forwardV, angleX);\n      const angleY = (normalizedPreviousPosition[1] - normalizedPosition[1]) * rotateIncrementDegrees;\n      this.rotateCamera(viewport, centerWorld, rightV, angleY);\n      viewport.render();\n    }\n  }\n}\nTrackballRotateTool.toolName = 'TrackballRotate';\nexport default TrackballRotateTool;","map":{"version":3,"names":["vtkMath","getEnabledElement","mat4","vec3","BaseTool","TrackballRotateTool","constructor","toolProps","defaultToolProps","supportedInteractionTypes","configuration","rotateIncrementDegrees","rotateCamera","viewport","centerWorld","axis","angle","vtkCamera","getVtkActiveCamera","viewUp","getViewUp","focalPoint","getFocalPoint","position","getPosition","newPosition","newFocalPoint","newViewUp","transform","identity","Float32Array","translate","rotate","transformMat4","setCamera","touchDragCallback","_dragCallback","bind","mouseDragCallback","evt","element","currentPoints","lastPoints","detail","currentPointsCanvas","canvas","lastPointsCanvas","enabledElement","camera","getCamera","width","clientWidth","height","clientHeight","normalizedPosition","normalizedPreviousPosition","center","canvasToWorld","normalizedCenter","radsq","Math","abs","op","oe","opsq","oesq","lop","sqrt","loe","nop","normalize","noe","dot","angleX","acos","clampValue","sign","upVec","atV","viewPlaneNormal","rightV","forwardV","cross","angleY","render","toolName"],"sources":["../../../src/tools/TrackballRotateTool.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}