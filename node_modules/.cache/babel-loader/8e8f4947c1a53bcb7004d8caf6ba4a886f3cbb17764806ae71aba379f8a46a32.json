{"ast":null,"code":"import { getEnabledElement } from '@cornerstonejs/core';\nimport { state } from '../../../store';\nimport { Events } from '../../../enums';\nimport { resetElementCursor, hideElementCursor } from '../../../cursors/elementCursor';\nimport { polyline } from '../../../utilities/math';\nimport { vec3, vec2 } from 'gl-matrix';\nimport { getInterpolatedPoints, shouldInterpolate } from '../../../utilities/planarFreehandROITool/interpolatePoints';\nimport triggerAnnotationRenderForViewportIds from '../../../utilities/triggerAnnotationRenderForViewportIds';\nconst {\n  getSubPixelSpacingAndXYDirections,\n  addCanvasPointsToArray,\n  calculateAreaOfPoints\n} = polyline;\nfunction activateClosedContourEdit(evt, annotation, viewportIdsToRender) {\n  this.isEditingClosed = true;\n  const eventDetail = evt.detail;\n  const {\n    currentPoints,\n    element\n  } = eventDetail;\n  const canvasPos = currentPoints.canvas;\n  const enabledElement = getEnabledElement(element);\n  const {\n    viewport\n  } = enabledElement;\n  const prevCanvasPoints = annotation.data.contour.polyline.map(viewport.worldToCanvas);\n  const {\n    spacing,\n    xDir,\n    yDir\n  } = getSubPixelSpacingAndXYDirections(viewport, this.configuration.subPixelResolution);\n  this.editData = {\n    prevCanvasPoints,\n    editCanvasPoints: [canvasPos],\n    startCrossingIndex: undefined,\n    editIndex: 0\n  };\n  this.commonData = {\n    annotation,\n    viewportIdsToRender,\n    spacing,\n    xDir,\n    yDir,\n    movingTextBox: false\n  };\n  state.isInteractingWithTool = true;\n  element.addEventListener(Events.MOUSE_UP, this.mouseUpClosedContourEditCallback);\n  element.addEventListener(Events.MOUSE_DRAG, this.mouseDragClosedContourEditCallback);\n  element.addEventListener(Events.MOUSE_CLICK, this.mouseUpClosedContourEditCallback);\n  element.addEventListener(Events.TOUCH_END, this.mouseUpClosedContourEditCallback);\n  element.addEventListener(Events.TOUCH_DRAG, this.mouseDragClosedContourEditCallback);\n  element.addEventListener(Events.TOUCH_TAP, this.mouseUpClosedContourEditCallback);\n  hideElementCursor(element);\n}\nfunction deactivateClosedContourEdit(element) {\n  state.isInteractingWithTool = false;\n  element.removeEventListener(Events.MOUSE_UP, this.mouseUpClosedContourEditCallback);\n  element.removeEventListener(Events.MOUSE_DRAG, this.mouseDragClosedContourEditCallback);\n  element.removeEventListener(Events.MOUSE_CLICK, this.mouseUpClosedContourEditCallback);\n  element.removeEventListener(Events.TOUCH_END, this.mouseUpClosedContourEditCallback);\n  element.removeEventListener(Events.TOUCH_DRAG, this.mouseDragClosedContourEditCallback);\n  element.removeEventListener(Events.TOUCH_TAP, this.mouseUpClosedContourEditCallback);\n  resetElementCursor(element);\n}\nfunction mouseDragClosedContourEditCallback(evt) {\n  const eventDetail = evt.detail;\n  const {\n    currentPoints,\n    element\n  } = eventDetail;\n  const worldPos = currentPoints.world;\n  const canvasPos = currentPoints.canvas;\n  const enabledElement = getEnabledElement(element);\n  const {\n    renderingEngine,\n    viewport\n  } = enabledElement;\n  const {\n    viewportIdsToRender,\n    xDir,\n    yDir,\n    spacing\n  } = this.commonData;\n  const {\n    editIndex,\n    editCanvasPoints,\n    startCrossingIndex\n  } = this.editData;\n  const lastCanvasPoint = editCanvasPoints[editCanvasPoints.length - 1];\n  const lastWorldPoint = viewport.canvasToWorld(lastCanvasPoint);\n  const worldPosDiff = vec3.create();\n  vec3.subtract(worldPosDiff, worldPos, lastWorldPoint);\n  const xDist = Math.abs(vec3.dot(worldPosDiff, xDir));\n  const yDist = Math.abs(vec3.dot(worldPosDiff, yDir));\n  if (xDist <= spacing[0] && yDist <= spacing[1]) {\n    return;\n  }\n  if (startCrossingIndex !== undefined) {\n    this.checkAndRemoveCrossesOnEditLine(evt);\n  }\n  const numPointsAdded = addCanvasPointsToArray(element, editCanvasPoints, canvasPos, this.commonData);\n  const currentEditIndex = editIndex + numPointsAdded;\n  this.editData.editIndex = currentEditIndex;\n  if (startCrossingIndex === undefined && editCanvasPoints.length > 1) {\n    this.checkForFirstCrossing(evt, true);\n  }\n  this.editData.snapIndex = this.findSnapIndex();\n  if (this.editData.snapIndex === -1) {\n    this.finishEditAndStartNewEdit(evt);\n    return;\n  }\n  this.editData.fusedCanvasPoints = this.fuseEditPointsWithClosedContour(evt);\n  if (startCrossingIndex !== undefined && this.checkForSecondCrossing(evt, true)) {\n    this.removePointsAfterSecondCrossing(true);\n    this.finishEditAndStartNewEdit(evt);\n  }\n  triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n}\nfunction finishEditAndStartNewEdit(evt) {\n  const eventDetail = evt.detail;\n  const {\n    element\n  } = eventDetail;\n  const enabledElement = getEnabledElement(element);\n  const {\n    viewport,\n    renderingEngine\n  } = enabledElement;\n  const {\n    annotation,\n    viewportIdsToRender\n  } = this.commonData;\n  const {\n    fusedCanvasPoints,\n    editCanvasPoints\n  } = this.editData;\n  const worldPoints = fusedCanvasPoints.map(canvasPoint => viewport.canvasToWorld(canvasPoint));\n  annotation.data.contour.polyline = worldPoints;\n  annotation.data.contour.closed = true;\n  this.triggerAnnotationModified(annotation, enabledElement);\n  const lastEditCanvasPoint = editCanvasPoints.pop();\n  this.editData = {\n    prevCanvasPoints: fusedCanvasPoints,\n    editCanvasPoints: [lastEditCanvasPoint],\n    startCrossingIndex: undefined,\n    editIndex: 0,\n    snapIndex: undefined\n  };\n  triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n}\nfunction fuseEditPointsWithClosedContour(evt) {\n  const {\n    prevCanvasPoints,\n    editCanvasPoints,\n    startCrossingIndex,\n    snapIndex\n  } = this.editData;\n  if (startCrossingIndex === undefined || snapIndex === undefined) {\n    return;\n  }\n  const eventDetail = evt.detail;\n  const {\n    element\n  } = eventDetail;\n  const augmentedEditCanvasPoints = [...editCanvasPoints];\n  addCanvasPointsToArray(element, augmentedEditCanvasPoints, prevCanvasPoints[snapIndex], this.commonData);\n  if (augmentedEditCanvasPoints.length > editCanvasPoints.length) {\n    augmentedEditCanvasPoints.pop();\n  }\n  let lowIndex;\n  let highIndex;\n  if (startCrossingIndex > snapIndex) {\n    lowIndex = snapIndex;\n    highIndex = startCrossingIndex;\n  } else {\n    lowIndex = startCrossingIndex;\n    highIndex = snapIndex;\n  }\n  const distanceBetweenLowAndFirstPoint = vec2.distance(prevCanvasPoints[lowIndex], augmentedEditCanvasPoints[0]);\n  const distanceBetweenLowAndLastPoint = vec2.distance(prevCanvasPoints[lowIndex], augmentedEditCanvasPoints[augmentedEditCanvasPoints.length - 1]);\n  const distanceBetweenHighAndFirstPoint = vec2.distance(prevCanvasPoints[highIndex], augmentedEditCanvasPoints[0]);\n  const distanceBetweenHighAndLastPoint = vec2.distance(prevCanvasPoints[highIndex], augmentedEditCanvasPoints[augmentedEditCanvasPoints.length - 1]);\n  const pointSet1 = [];\n  for (let i = 0; i < lowIndex; i++) {\n    const canvasPoint = prevCanvasPoints[i];\n    pointSet1.push([canvasPoint[0], canvasPoint[1]]);\n  }\n  let inPlaceDistance = distanceBetweenLowAndFirstPoint + distanceBetweenHighAndLastPoint;\n  let reverseDistance = distanceBetweenLowAndLastPoint + distanceBetweenHighAndFirstPoint;\n  if (inPlaceDistance < reverseDistance) {\n    for (let i = 0; i < augmentedEditCanvasPoints.length; i++) {\n      const canvasPoint = augmentedEditCanvasPoints[i];\n      pointSet1.push([canvasPoint[0], canvasPoint[1]]);\n    }\n  } else {\n    for (let i = augmentedEditCanvasPoints.length - 1; i >= 0; i--) {\n      const canvasPoint = augmentedEditCanvasPoints[i];\n      pointSet1.push([canvasPoint[0], canvasPoint[1]]);\n    }\n  }\n  for (let i = highIndex; i < prevCanvasPoints.length; i++) {\n    const canvasPoint = prevCanvasPoints[i];\n    pointSet1.push([canvasPoint[0], canvasPoint[1]]);\n  }\n  const pointSet2 = [];\n  for (let i = lowIndex; i < highIndex; i++) {\n    const canvasPoint = prevCanvasPoints[i];\n    pointSet2.push([canvasPoint[0], canvasPoint[1]]);\n  }\n  inPlaceDistance = distanceBetweenHighAndFirstPoint + distanceBetweenLowAndLastPoint;\n  reverseDistance = distanceBetweenHighAndLastPoint + distanceBetweenLowAndFirstPoint;\n  if (inPlaceDistance < reverseDistance) {\n    for (let i = 0; i < augmentedEditCanvasPoints.length; i++) {\n      const canvasPoint = augmentedEditCanvasPoints[i];\n      pointSet2.push([canvasPoint[0], canvasPoint[1]]);\n    }\n  } else {\n    for (let i = augmentedEditCanvasPoints.length - 1; i >= 0; i--) {\n      const canvasPoint = augmentedEditCanvasPoints[i];\n      pointSet2.push([canvasPoint[0], canvasPoint[1]]);\n    }\n  }\n  const areaPointSet1 = calculateAreaOfPoints(pointSet1);\n  const areaPointSet2 = calculateAreaOfPoints(pointSet2);\n  const pointsToRender = areaPointSet1 > areaPointSet2 ? pointSet1 : pointSet2;\n  return pointsToRender;\n}\nfunction mouseUpClosedContourEditCallback(evt) {\n  const eventDetail = evt.detail;\n  const {\n    element\n  } = eventDetail;\n  this.completeClosedContourEdit(element);\n}\nfunction completeClosedContourEdit(element) {\n  const enabledElement = getEnabledElement(element);\n  const {\n    viewport,\n    renderingEngine\n  } = enabledElement;\n  const {\n    annotation,\n    viewportIdsToRender\n  } = this.commonData;\n  const {\n    fusedCanvasPoints,\n    prevCanvasPoints\n  } = this.editData;\n  if (fusedCanvasPoints) {\n    const updatedPoints = shouldInterpolate(this.configuration) ? getInterpolatedPoints(this.configuration, fusedCanvasPoints, prevCanvasPoints) : fusedCanvasPoints;\n    const worldPoints = updatedPoints.map(canvasPoint => viewport.canvasToWorld(canvasPoint));\n    annotation.data.contour.polyline = worldPoints;\n    annotation.data.contour.closed = true;\n    annotation.invalidated = true;\n    this.triggerAnnotationModified(annotation, enabledElement);\n  }\n  this.isEditingClosed = false;\n  this.editData = undefined;\n  this.commonData = undefined;\n  triggerAnnotationRenderForViewportIds(renderingEngine, viewportIdsToRender);\n  this.deactivateClosedContourEdit(element);\n}\nfunction cancelClosedContourEdit(element) {\n  this.completeClosedContourEdit(element);\n}\nfunction registerClosedContourEditLoop(toolInstance) {\n  toolInstance.activateClosedContourEdit = activateClosedContourEdit.bind(toolInstance);\n  toolInstance.deactivateClosedContourEdit = deactivateClosedContourEdit.bind(toolInstance);\n  toolInstance.mouseDragClosedContourEditCallback = mouseDragClosedContourEditCallback.bind(toolInstance);\n  toolInstance.mouseUpClosedContourEditCallback = mouseUpClosedContourEditCallback.bind(toolInstance);\n  toolInstance.finishEditAndStartNewEdit = finishEditAndStartNewEdit.bind(toolInstance);\n  toolInstance.fuseEditPointsWithClosedContour = fuseEditPointsWithClosedContour.bind(toolInstance);\n  toolInstance.cancelClosedContourEdit = cancelClosedContourEdit.bind(toolInstance);\n  toolInstance.completeClosedContourEdit = completeClosedContourEdit.bind(toolInstance);\n}\nexport default registerClosedContourEditLoop;","map":{"version":3,"names":["getEnabledElement","state","Events","resetElementCursor","hideElementCursor","polyline","vec3","vec2","getInterpolatedPoints","shouldInterpolate","triggerAnnotationRenderForViewportIds","getSubPixelSpacingAndXYDirections","addCanvasPointsToArray","calculateAreaOfPoints","activateClosedContourEdit","evt","annotation","viewportIdsToRender","isEditingClosed","eventDetail","detail","currentPoints","element","canvasPos","canvas","enabledElement","viewport","prevCanvasPoints","data","contour","map","worldToCanvas","spacing","xDir","yDir","configuration","subPixelResolution","editData","editCanvasPoints","startCrossingIndex","undefined","editIndex","commonData","movingTextBox","isInteractingWithTool","addEventListener","MOUSE_UP","mouseUpClosedContourEditCallback","MOUSE_DRAG","mouseDragClosedContourEditCallback","MOUSE_CLICK","TOUCH_END","TOUCH_DRAG","TOUCH_TAP","deactivateClosedContourEdit","removeEventListener","worldPos","world","renderingEngine","lastCanvasPoint","length","lastWorldPoint","canvasToWorld","worldPosDiff","create","subtract","xDist","Math","abs","dot","yDist","checkAndRemoveCrossesOnEditLine","numPointsAdded","currentEditIndex","checkForFirstCrossing","snapIndex","findSnapIndex","finishEditAndStartNewEdit","fusedCanvasPoints","fuseEditPointsWithClosedContour","checkForSecondCrossing","removePointsAfterSecondCrossing","worldPoints","canvasPoint","closed","triggerAnnotationModified","lastEditCanvasPoint","pop","augmentedEditCanvasPoints","lowIndex","highIndex","distanceBetweenLowAndFirstPoint","distance","distanceBetweenLowAndLastPoint","distanceBetweenHighAndFirstPoint","distanceBetweenHighAndLastPoint","pointSet1","i","push","inPlaceDistance","reverseDistance","pointSet2","areaPointSet1","areaPointSet2","pointsToRender","completeClosedContourEdit","updatedPoints","invalidated","cancelClosedContourEdit","registerClosedContourEditLoop","toolInstance","bind"],"sources":["../../../../../src/tools/annotation/planarFreehandROITool/closedContourEditLoop.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}