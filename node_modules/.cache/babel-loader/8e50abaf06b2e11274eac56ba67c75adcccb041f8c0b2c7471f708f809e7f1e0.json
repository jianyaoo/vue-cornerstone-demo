{"ast":null,"code":"import { Transform } from './transform';\nexport default function (enabledElement, scale) {\n  const transform = new Transform();\n  if (!enabledElement.viewport.displayedArea) {\n    return transform;\n  }\n  transform.translate(enabledElement.canvas.width / 2, enabledElement.canvas.height / 2);\n  const angle = enabledElement.viewport.rotation;\n  if (angle !== 0) {\n    transform.rotate(angle * Math.PI / 180);\n  }\n  let widthScale = enabledElement.viewport.scale;\n  let heightScale = enabledElement.viewport.scale;\n  const width = enabledElement.viewport.displayedArea.brhc.x - (enabledElement.viewport.displayedArea.tlhc.x - 1);\n  const height = enabledElement.viewport.displayedArea.brhc.y - (enabledElement.viewport.displayedArea.tlhc.y - 1);\n  if (enabledElement.viewport.displayedArea.presentationSizeMode === 'NONE') {\n    if (enabledElement.image.rowPixelSpacing < enabledElement.image.columnPixelSpacing) {\n      widthScale *= enabledElement.image.columnPixelSpacing / enabledElement.image.rowPixelSpacing;\n    } else if (enabledElement.image.columnPixelSpacing < enabledElement.image.rowPixelSpacing) {\n      heightScale *= enabledElement.image.rowPixelSpacing / enabledElement.image.columnPixelSpacing;\n    }\n  } else {\n    widthScale = enabledElement.viewport.displayedArea.columnPixelSpacing;\n    heightScale = enabledElement.viewport.displayedArea.rowPixelSpacing;\n    if (enabledElement.viewport.displayedArea.presentationSizeMode === 'SCALE TO FIT') {\n      const verticalScale = enabledElement.canvas.height / (height * heightScale);\n      const horizontalScale = enabledElement.canvas.width / (width * widthScale);\n      widthScale = heightScale = Math.min(horizontalScale, verticalScale);\n      if (enabledElement.viewport.displayedArea.rowPixelSpacing < enabledElement.viewport.displayedArea.columnPixelSpacing) {\n        widthScale *= enabledElement.viewport.displayedArea.columnPixelSpacing / enabledElement.viewport.displayedArea.rowPixelSpacing;\n      } else if (enabledElement.viewport.displayedArea.columnPixelSpacing < enabledElement.viewport.displayedArea.rowPixelSpacing) {\n        heightScale *= enabledElement.viewport.displayedArea.rowPixelSpacing / enabledElement.viewport.displayedArea.columnPixelSpacing;\n      }\n    }\n  }\n  transform.scale(widthScale, heightScale);\n  if (angle !== 0) {\n    transform.rotate(-angle * Math.PI / 180);\n  }\n  transform.translate(enabledElement.viewport.translation.x, enabledElement.viewport.translation.y);\n  if (angle !== 0) {\n    transform.rotate(angle * Math.PI / 180);\n  }\n  if (scale !== undefined) {\n    transform.scale(scale, scale);\n  }\n  if (enabledElement.viewport.hflip) {\n    transform.scale(-1, 1);\n  }\n  if (enabledElement.viewport.vflip) {\n    transform.scale(1, -1);\n  }\n  transform.translate(-width / 2, -height / 2);\n  return transform;\n}","map":{"version":3,"names":["Transform","enabledElement","scale","transform","viewport","displayedArea","translate","canvas","width","height","angle","rotation","rotate","Math","PI","widthScale","heightScale","brhc","x","tlhc","y","presentationSizeMode","image","rowPixelSpacing","columnPixelSpacing","verticalScale","horizontalScale","min","translation","undefined","hflip","vflip"],"sources":["../../../../../../src/RenderingEngine/helpers/cpuFallback/rendering/calculateTransform.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,SAAS,QAAQ,aAAa;AAavC,eAAc,UACZC,cAAyC,EACzCC,KAAc;EAEd,MAAMC,SAAS,GAAG,IAAIH,SAAS,EAAE;EAEjC,IAAI,CAACC,cAAc,CAACG,QAAQ,CAACC,aAAa,EAAE;IAC1C,OAAOF,SAAS;;EAIlBA,SAAS,CAACG,SAAS,CACjBL,cAAc,CAACM,MAAM,CAACC,KAAK,GAAG,CAAC,EAC/BP,cAAc,CAACM,MAAM,CAACE,MAAM,GAAG,CAAC,CACjC;EAGD,MAAMC,KAAK,GAAGT,cAAc,CAACG,QAAQ,CAACO,QAAQ;EAE9C,IAAID,KAAK,KAAK,CAAC,EAAE;IACfP,SAAS,CAACS,MAAM,CAAEF,KAAK,GAAGG,IAAI,CAACC,EAAE,GAAI,GAAG,CAAC;;EAI3C,IAAIC,UAAU,GAAGd,cAAc,CAACG,QAAQ,CAACF,KAAK;EAC9C,IAAIc,WAAW,GAAGf,cAAc,CAACG,QAAQ,CAACF,KAAK;EAE/C,MAAMM,KAAK,GACTP,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACY,IAAI,CAACC,CAAC,IAC3CjB,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACc,IAAI,CAACD,CAAC,GAAG,CAAC,CAAC;EACpD,MAAMT,MAAM,GACVR,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACY,IAAI,CAACG,CAAC,IAC3CnB,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACc,IAAI,CAACC,CAAC,GAAG,CAAC,CAAC;EAEpD,IAAInB,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACgB,oBAAoB,KAAK,MAAM,EAAE;IACzE,IACEpB,cAAc,CAACqB,KAAK,CAACC,eAAe,GACpCtB,cAAc,CAACqB,KAAK,CAACE,kBAAkB,EACvC;MACAT,UAAU,IACRd,cAAc,CAACqB,KAAK,CAACE,kBAAkB,GACvCvB,cAAc,CAACqB,KAAK,CAACC,eAAe;KACvC,MAAM,IACLtB,cAAc,CAACqB,KAAK,CAACE,kBAAkB,GACvCvB,cAAc,CAACqB,KAAK,CAACC,eAAe,EACpC;MACAP,WAAW,IACTf,cAAc,CAACqB,KAAK,CAACC,eAAe,GACpCtB,cAAc,CAACqB,KAAK,CAACE,kBAAkB;;GAE5C,MAAM;IAELT,UAAU,GAAGd,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACmB,kBAAkB;IACrER,WAAW,GAAGf,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACkB,eAAe;IAEnE,IACEtB,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACgB,oBAAoB,KAC1D,cAAc,EACd;MAEA,MAAMI,aAAa,GACjBxB,cAAc,CAACM,MAAM,CAACE,MAAM,IAAIA,MAAM,GAAGO,WAAW,CAAC;MACvD,MAAMU,eAAe,GACnBzB,cAAc,CAACM,MAAM,CAACC,KAAK,IAAIA,KAAK,GAAGO,UAAU,CAAC;MAGpDA,UAAU,GAAGC,WAAW,GAAGH,IAAI,CAACc,GAAG,CAACD,eAAe,EAAED,aAAa,CAAC;MAEnE,IACExB,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACkB,eAAe,GACrDtB,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACmB,kBAAkB,EACxD;QACAT,UAAU,IACRd,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACmB,kBAAkB,GACxDvB,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACkB,eAAe;OACxD,MAAM,IACLtB,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACmB,kBAAkB,GACxDvB,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACkB,eAAe,EACrD;QACAP,WAAW,IACTf,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACkB,eAAe,GACrDtB,cAAc,CAACG,QAAQ,CAACC,aAAa,CAACmB,kBAAkB;;;;EAKhErB,SAAS,CAACD,KAAK,CAACa,UAAU,EAAEC,WAAW,CAAC;EAGxC,IAAIN,KAAK,KAAK,CAAC,EAAE;IACfP,SAAS,CAACS,MAAM,CAAE,CAACF,KAAK,GAAGG,IAAI,CAACC,EAAE,GAAI,GAAG,CAAC;;EAI5CX,SAAS,CAACG,SAAS,CACjBL,cAAc,CAACG,QAAQ,CAACwB,WAAW,CAACV,CAAC,EACrCjB,cAAc,CAACG,QAAQ,CAACwB,WAAW,CAACR,CAAC,CACtC;EAGD,IAAIV,KAAK,KAAK,CAAC,EAAE;IACfP,SAAS,CAACS,MAAM,CAAEF,KAAK,GAAGG,IAAI,CAACC,EAAE,GAAI,GAAG,CAAC;;EAG3C,IAAIZ,KAAK,KAAK2B,SAAS,EAAE;IAEvB1B,SAAS,CAACD,KAAK,CAACA,KAAK,EAAEA,KAAK,CAAC;;EAI/B,IAAID,cAAc,CAACG,QAAQ,CAAC0B,KAAK,EAAE;IACjC3B,SAAS,CAACD,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;;EAGxB,IAAID,cAAc,CAACG,QAAQ,CAAC2B,KAAK,EAAE;IACjC5B,SAAS,CAACD,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;;EAIxBC,SAAS,CAACG,SAAS,CAAC,CAACE,KAAK,GAAG,CAAC,EAAE,CAACC,MAAM,GAAG,CAAC,CAAC;EAE5C,OAAON,SAAS;AAClB"},"metadata":{},"sourceType":"module","externalDependencies":[]}