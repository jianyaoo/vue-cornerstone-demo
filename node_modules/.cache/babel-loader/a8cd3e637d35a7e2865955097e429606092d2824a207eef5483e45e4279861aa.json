{"ast":null,"code":"const DEFAULT_SETTINGS = Symbol('DefaultSettings');\nconst RUNTIME_SETTINGS = Symbol('RuntimeSettings');\nconst OBJECT_SETTINGS_MAP = Symbol('ObjectSettingsMap');\nconst DICTIONARY = Symbol('Dictionary');\nexport default class Settings {\n  constructor(base) {\n    const dictionary = Object.create(base instanceof Settings && DICTIONARY in base ? base[DICTIONARY] : null);\n    Object.seal(Object.defineProperty(this, DICTIONARY, {\n      value: dictionary\n    }));\n  }\n  set(key, value) {\n    return set(this[DICTIONARY], key, value, null);\n  }\n  get(key) {\n    return get(this[DICTIONARY], key);\n  }\n  unset(key) {\n    return unset(this[DICTIONARY], key + '');\n  }\n  forEach(callback) {\n    iterate(this[DICTIONARY], callback);\n  }\n  extend() {\n    return new Settings(this);\n  }\n  import(root) {\n    if (isPlainObject(root)) {\n      Object.keys(root).forEach(key => {\n        set(this[DICTIONARY], key, root[key], null);\n      });\n    }\n  }\n  dump() {\n    const context = {};\n    iterate(this[DICTIONARY], (key, value) => {\n      if (typeof value !== 'undefined') {\n        deepSet(context, key, value);\n      }\n    });\n    return context;\n  }\n  static assert(subject) {\n    return subject instanceof Settings ? subject : Settings.getRuntimeSettings();\n  }\n  static getDefaultSettings(subfield = null) {\n    let defaultSettings = Settings[DEFAULT_SETTINGS];\n    if (!(defaultSettings instanceof Settings)) {\n      defaultSettings = new Settings();\n      Settings[DEFAULT_SETTINGS] = defaultSettings;\n    }\n    if (subfield) {\n      const settingObj = {};\n      defaultSettings.forEach(name => {\n        if (name.startsWith(subfield)) {\n          const setting = name.split(`${subfield}.`)[1];\n          settingObj[setting] = defaultSettings.get(name);\n        }\n      });\n      return settingObj;\n    }\n    return defaultSettings;\n  }\n  static getRuntimeSettings() {\n    let runtimeSettings = Settings[RUNTIME_SETTINGS];\n    if (!(runtimeSettings instanceof Settings)) {\n      runtimeSettings = new Settings(Settings.getDefaultSettings());\n      Settings[RUNTIME_SETTINGS] = runtimeSettings;\n    }\n    return runtimeSettings;\n  }\n  static getObjectSettings(subject, from) {\n    let settings = null;\n    if (subject instanceof Settings) {\n      settings = subject;\n    } else if (typeof subject === 'object' && subject !== null) {\n      let objectSettingsMap = Settings[OBJECT_SETTINGS_MAP];\n      if (!(objectSettingsMap instanceof WeakMap)) {\n        objectSettingsMap = new WeakMap();\n        Settings[OBJECT_SETTINGS_MAP] = objectSettingsMap;\n      }\n      settings = objectSettingsMap.get(subject);\n      if (!(settings instanceof Settings)) {\n        settings = new Settings(Settings.assert(Settings.getObjectSettings(from)));\n        objectSettingsMap.set(subject, settings);\n      }\n    }\n    return settings;\n  }\n  static extendRuntimeSettings() {\n    return Settings.getRuntimeSettings().extend();\n  }\n}\nfunction unset(dictionary, name) {\n  if (name.endsWith('.')) {\n    let deleteCount = 0;\n    const namespace = name;\n    const base = namespace.slice(0, -1);\n    const deleteAll = base.length === 0;\n    for (const key in dictionary) {\n      if (Object.prototype.hasOwnProperty.call(dictionary, key) && (deleteAll || key.startsWith(namespace) || key === base)) {\n        delete dictionary[key];\n        ++deleteCount;\n      }\n    }\n    return deleteCount > 0;\n  }\n  return delete dictionary[name];\n}\nfunction iterate(dictionary, callback) {\n  for (const key in dictionary) {\n    callback(key, dictionary[key]);\n  }\n}\nfunction setAll(dictionary, prefix, record, references) {\n  let failCount;\n  if (references.has(record)) {\n    return set(dictionary, prefix, null, references);\n  }\n  references.add(record);\n  failCount = 0;\n  for (const field in record) {\n    if (Object.prototype.hasOwnProperty.call(record, field)) {\n      const key = field.length === 0 ? prefix : `${prefix}.${field}`;\n      if (!set(dictionary, key, record[field], references)) {\n        ++failCount;\n      }\n    }\n  }\n  references.delete(record);\n  return failCount === 0;\n}\nfunction set(dictionary, key, value, references) {\n  if (isValidKey(key)) {\n    if (isPlainObject(value)) {\n      return setAll(dictionary, key, value, references instanceof WeakSet ? references : new WeakSet());\n    }\n    dictionary[key] = value;\n    return true;\n  }\n  return false;\n}\nfunction get(dictionary, key) {\n  return dictionary[key];\n}\nfunction isValidKey(key) {\n  let last, current, previous;\n  if (typeof key !== 'string' || (last = key.length - 1) < 0) {\n    return false;\n  }\n  previous = -1;\n  while ((current = key.indexOf('.', previous + 1)) >= 0) {\n    if (current - previous < 2 || current === last) {\n      return false;\n    }\n    previous = current;\n  }\n  return true;\n}\nfunction isPlainObject(subject) {\n  if (typeof subject === 'object' && subject !== null) {\n    const prototype = Object.getPrototypeOf(subject);\n    if (prototype === Object.prototype || prototype === null) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction deepSet(context, key, value) {\n  const separator = key.indexOf('.');\n  if (separator >= 0) {\n    const subKey = key.slice(0, separator);\n    let subContext = context[subKey];\n    if (typeof subContext !== 'object' || subContext === null) {\n      const subContextValue = subContext;\n      subContext = {};\n      if (typeof subContextValue !== 'undefined') {\n        subContext[''] = subContextValue;\n      }\n      context[subKey] = subContext;\n    }\n    deepSet(subContext, key.slice(separator + 1, key.length), value);\n  } else {\n    context[key] = value;\n  }\n}\nSettings.getDefaultSettings().set('useCursors', true);","map":{"version":3,"names":["DEFAULT_SETTINGS","Symbol","RUNTIME_SETTINGS","OBJECT_SETTINGS_MAP","DICTIONARY","Settings","constructor","base","dictionary","Object","create","seal","defineProperty","value","set","key","get","unset","forEach","callback","iterate","extend","import","root","isPlainObject","keys","dump","context","deepSet","assert","subject","getRuntimeSettings","getDefaultSettings","subfield","defaultSettings","settingObj","name","startsWith","setting","split","runtimeSettings","getObjectSettings","from","settings","objectSettingsMap","WeakMap","extendRuntimeSettings","endsWith","deleteCount","namespace","slice","deleteAll","length","prototype","hasOwnProperty","call","setAll","prefix","record","references","failCount","has","add","field","delete","isValidKey","WeakSet","last","current","previous","indexOf","getPrototypeOf","separator","subKey","subContext","subContextValue"],"sources":["../../src/Settings.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}