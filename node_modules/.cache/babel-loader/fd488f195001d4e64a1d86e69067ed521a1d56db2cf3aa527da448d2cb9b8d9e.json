{"ast":null,"code":"import { Enums, imageLoader, imageLoadPoolManager, utilities as csUtils } from '@cornerstonejs/core';\nimport StreamingImageVolume from './StreamingImageVolume';\nfunction cornerstoneStreamingImageVolumeLoader(volumeId, options) {\n  if (!options || !options.imageIds || !options.imageIds.length) {\n    throw new Error('ImageIds must be provided to create a streaming image volume');\n  }\n  async function getStreamingImageVolume() {\n    if (options.imageIds[0].split(':')[0] === 'wadouri') {\n      const [middleImageIndex, lastImageIndex] = [Math.floor(options.imageIds.length / 2), options.imageIds.length - 1];\n      const indexesToPrefetch = [0, middleImageIndex, lastImageIndex];\n      await Promise.all(indexesToPrefetch.map(index => {\n        return new Promise((resolve, reject) => {\n          const imageId = options.imageIds[index];\n          imageLoadPoolManager.addRequest(async () => {\n            imageLoader.loadImage(imageId).then(() => {\n              console.log(`Prefetched imageId: ${imageId}`);\n              resolve(true);\n            }).catch(err => {\n              reject(err);\n            });\n          }, Enums.RequestType.Prefetch, {\n            volumeId\n          }, 1);\n        });\n      })).catch(console.error);\n    }\n    const {\n      dimensions,\n      spacing,\n      origin,\n      scalarData,\n      direction,\n      sizeInBytes,\n      metadata,\n      imageIds\n    } = csUtils.generateVolumePropsFromImageIds(options.imageIds, volumeId);\n    const streamingImageVolume = new StreamingImageVolume({\n      volumeId,\n      metadata,\n      dimensions,\n      spacing,\n      origin,\n      direction,\n      scalarData,\n      sizeInBytes,\n      imageIds\n    }, {\n      imageIds,\n      loadStatus: {\n        loaded: false,\n        loading: false,\n        cancelled: false,\n        cachedFrames: [],\n        callbacks: []\n      }\n    });\n    return streamingImageVolume;\n  }\n  const streamingImageVolumePromise = getStreamingImageVolume();\n  return {\n    promise: streamingImageVolumePromise,\n    decache: () => {\n      streamingImageVolumePromise.then(streamingImageVolume => {\n        streamingImageVolume.destroy();\n        streamingImageVolume = null;\n      });\n    },\n    cancel: () => {\n      streamingImageVolumePromise.then(streamingImageVolume => {\n        streamingImageVolume.cancelLoading();\n      });\n    }\n  };\n}\nexport default cornerstoneStreamingImageVolumeLoader;","map":{"version":3,"names":["Enums","imageLoader","imageLoadPoolManager","utilities","csUtils","StreamingImageVolume","cornerstoneStreamingImageVolumeLoader","volumeId","options","imageIds","length","Error","getStreamingImageVolume","split","middleImageIndex","lastImageIndex","Math","floor","indexesToPrefetch","Promise","all","map","index","resolve","reject","imageId","addRequest","loadImage","then","console","log","catch","err","RequestType","Prefetch","error","dimensions","spacing","origin","scalarData","direction","sizeInBytes","metadata","generateVolumePropsFromImageIds","streamingImageVolume","loadStatus","loaded","loading","cancelled","cachedFrames","callbacks","streamingImageVolumePromise","promise","decache","destroy","cancel","cancelLoading"],"sources":["../../src/cornerstoneStreamingImageVolumeLoader.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}