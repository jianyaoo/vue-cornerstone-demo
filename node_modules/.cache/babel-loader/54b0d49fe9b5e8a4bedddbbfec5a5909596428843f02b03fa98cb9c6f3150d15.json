{"ast":null,"code":"export class PromiseIterator extends Promise {}\nexport default class ProgressiveIterator {\n  constructor(name) {\n    this.name = name || 'unknown';\n  }\n  static as(promise) {\n    if (promise.iterator) {\n      return promise.iterator;\n    }\n    const iterator = new ProgressiveIterator('as iterator');\n    promise.then(v => {\n      try {\n        iterator.add(v, true);\n      } catch (e) {\n        iterator.reject(e);\n      }\n    }, reason => iterator.reject(reason));\n    return iterator;\n  }\n  add(x, done = false) {\n    this.nextValue = x;\n    this.done ||= done;\n    if (this.waiting) {\n      this.waiting.resolve(x);\n      this.waiting = undefined;\n    }\n  }\n  resolve() {\n    this.done = true;\n    if (this.waiting) {\n      this.waiting.resolve(this.nextValue);\n      this.waiting = undefined;\n    }\n  }\n  reject(reason) {\n    this.rejectReason = reason;\n    this.waiting?.reject(reason);\n  }\n  getRecent() {\n    if (this.rejectReason) {\n      throw this.rejectReason;\n    }\n    return this.nextValue;\n  }\n  async *[Symbol.asyncIterator]() {\n    while (!this.done) {\n      if (this.rejectReason) {\n        throw this.rejectReason;\n      }\n      if (this.nextValue !== undefined) {\n        yield this.nextValue;\n        if (this.done) {\n          break;\n        }\n      }\n      if (!this.waiting) {\n        this.waiting = {};\n        this.waiting.promise = new Promise((resolve, reject) => {\n          this.waiting.resolve = resolve;\n          this.waiting.reject = reject;\n        });\n      }\n      await this.waiting.promise;\n    }\n    yield this.nextValue;\n  }\n  async forEach(callback, errorCallback) {\n    let index = 0;\n    try {\n      for await (const value of this) {\n        const {\n          done\n        } = this;\n        try {\n          await callback(value, done, index);\n          index++;\n        } catch (e) {\n          if (!done) {\n            console.warn('Caught exception in intermediate value', e);\n            continue;\n          }\n          if (errorCallback) {\n            errorCallback(e, done);\n          } else {\n            throw e;\n          }\n        }\n      }\n    } catch (e) {\n      if (errorCallback) {\n        errorCallback(e, true);\n      } else {\n        throw e;\n      }\n    }\n  }\n  generate(processFunction, errorCallback) {\n    return processFunction(this, this.reject.bind(this)).then(() => {\n      if (!this.done) {\n        this.resolve();\n      }\n    }, reason => {\n      this.reject(reason);\n      if (errorCallback) {\n        errorCallback(reason);\n      } else {\n        console.warn(\"Couldn't process because\", reason);\n      }\n    });\n  }\n  async nextPromise() {\n    for await (const i of this) {\n      if (i) {\n        return i;\n      }\n    }\n    return this.nextValue;\n  }\n  async donePromise() {\n    for await (const i of this) {}\n    return this.nextValue;\n  }\n  getNextPromise() {\n    const promise = this.nextPromise();\n    promise.iterator = this;\n    return promise;\n  }\n  getDonePromise() {\n    const promise = this.donePromise();\n    promise.iterator = this;\n    return promise;\n  }\n}","map":{"version":3,"names":["PromiseIterator","Promise","ProgressiveIterator","constructor","name","as","promise","iterator","then","v","add","e","reject","reason","x","done","nextValue","waiting","resolve","undefined","rejectReason","getRecent","Symbol","asyncIterator","forEach","callback","errorCallback","index","value","console","warn","generate","processFunction","bind","nextPromise","i","donePromise","getNextPromise","getDonePromise"],"sources":["../../../src/utilities/ProgressiveIterator.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}